CLASS ZCL_COC_COMM DEFINITION
  PUBLIC
  CREATE PUBLIC .

PUBLIC SECTION.

	TYPES: TY_CFIELDS TYPE TKKV_ICOPA.
	TYPES: 
		TY_CFIELDS_T TYPE TABLE OF TY_CFIELDS.
  TYPES:
    BEGIN OF TY_PERIOD,
        GJAHR TYPE V_COSP_VIEW-GJAHR,
        PERIO TYPE COEP-PERIO,
      END OF TY_PERIOD .
  TYPES:
    TY_PERIOD_T TYPE TABLE OF TY_PERIOD .
  TYPES:
    BEGIN OF TY_BP_JOB_STEP_S,
             JOBNAME    TYPE BTCJOB,
             CPROG      TYPE CPROG,
             T_RSPARAMS TYPE TY_RSPARAMS,
           END OF TY_BP_JOB_STEP_S .
  TYPES:
    TY_BP_JOB_STEP_T TYPE TABLE OF TY_BP_JOB_STEP_S .
  TYPES:
    BEGIN OF TY_FORMULA_S,
        FIELD TYPE FIELDNAME,
        VALUE TYPE F,
      END OF TY_FORMULA_S .
  TYPES:
    TY_FORMULA_T TYPE TABLE OF TY_FORMULA_S .
  TYPES:
    BEGIN OF TY_HEADINFO_S,
        ICON TYPE ICON_D,
        SEQ  TYPE I,
        PARA TYPE SDYDO_TEXT_ELEMENT,
        VALU TYPE SDYDO_TEXT_ELEMENT,
        TEXT TYPE TEXTPOOLTX,
      END OF TY_HEADINFO_S .
  TYPES:
    TY_HEADINFO_T TYPE TABLE OF TY_HEADINFO_S .
  TYPES:
    TY_RSEL_INFO TYPE TABLE OF RSEL_INFO .
  TYPES:
    TY_TABLE     TYPE TABLE OF W3TEXT .
  TYPES:
    TY_DATA      TYPE TABLE OF CHAR4000 .
  TYPES:
    TY_PRCTR     TYPE RANGE OF PRCTR .

	CLASS-DATA MV_PERCENT TYPE INT4.
	
    CLASS-METHODS GET_PRE_PERIOD
    IMPORTING
      !I_SPMON TYPE SPMON OPTIONAL
      !I_PERIO TYPE JAHRPER OPTIONAL
    RETURNING
      VALUE(R_PERIOD)     TYPE CHAR7.
      CLASS-METHODS GET_CHARACTERISTIC_TEXT
      IMPORTING
        !IV_CHARACTERISTIC TYPE RKE_CHARACTERISTIC
        !IV_VALUE 				 TYPE RKE_COND_VALUE
      RETURNING
        VALUE(RV_TEXT)     TYPE RKE_TEXTLG.
    CLASS-METHODS BACKGROUND_JOB_PROCESS
    IMPORTING
      !IV_CPROG TYPE CPROG DEFAULT SY-CPROG
      !IT_RSPARAMS TYPE TY_RSPARAMS OPTIONAL
    CHANGING
      VALUE(CV_JOBNAME) TYPE BTCJOB OPTIONAL
    RETURNING
      VALUE(RV_SUBRC) TYPE SY-SUBRC .
  CLASS-METHODS BACKGROUND_JOB_PROCESS_STEP
    IMPORTING
      VALUE(IT_BPJOB_LIST) TYPE TY_BP_JOB_STEP_T OPTIONAL
    RETURNING
      VALUE(RV_SUBRC) TYPE SY-SUBRC .
  CLASS-METHODS CALC_FORMULA
    IMPORTING
      !IV_FORMULA TYPE QEIFFORMEL
      VALUE(IT_DATA) TYPE TY_FORMULA_T OPTIONAL
    CHANGING
      !CV_SUBRC TYPE SY-SUBRC OPTIONAL
    RETURNING
      VALUE(EV_RESULT) TYPE F .
  CLASS-METHODS CALL_TRANSACTION
    IMPORTING
      !IV_TCODE TYPE TCODE
      VALUE(IV_NEW_SESSION) TYPE CHAR01 DEFAULT 'X'
      !IV_MODE TYPE CHAR01 DEFAULT 'N'
      !IV_UPDATE TYPE CHAR01 DEFAULT 'A'
      !IS_CTU_PARAMS TYPE CTU_PARAMS OPTIONAL
      !IT_BDCDATA TYPE TAB_BDCDATA OPTIONAL
      !IT_PARAMETER_IDS TYPE TAB_BDCDATA OPTIONAL
    RETURNING
      VALUE(RT_BDCMESSAGES) TYPE TAB_BDCMSGCOLL .
  CLASS-METHODS CALL_TRANSACTION2
    IMPORTING
      !IV_TCODE TYPE TCODE.
  CLASS-METHODS CLEAR_SELECTION_SCREEN
    IMPORTING
      !IV_CPROG TYPE SY-CPROG
      !IV_KIND TYPE RSSCR_KIND OPTIONAL .
  CLASS-METHODS CONVERSION_EXIT_VALUE
    IMPORTING
      !IV_INPUT TYPE ANY
      !IV_CONVEXIT TYPE CONVEXIT OPTIONAL
      !IV_CONVERT_TYPE TYPE CHAR01 DEFAULT 'I'
      !IV_DBFIELD TYPE ROLLNAME OPTIONAL
    EXPORTING
      !EV_OUTPUT TYPE ANY .
  CLASS-METHODS CONVERT_CELL_TO_TABLE
    IMPORTING
      !IT_CELLS TYPE YPJO_XXL_DW_T
      !IT_DFIES TYPE DDFIELDS
    EXPORTING
      !EV_CONV_ROW TYPE I
    CHANGING
      !CT_CONV_TABLE TYPE STANDARD TABLE
    RETURNING
      VALUE(CT_RETURN) TYPE BAPIRET2_T .
  CLASS-METHODS CONVERT_DECIMALS_FOR_CURRENCY
    IMPORTING
      !IT_DFIES TYPE DDFIELDS
    CHANGING
      !CS_ITEM TYPE ANY .
  CLASS-METHODS CONVERT_STR_TO_LINE
    IMPORTING
      !IS_STR TYPE ANY
      !IT_DDFIELDS TYPE DDFIELDS
    CHANGING
      !CS_ROW_DATA TYPE USMD_CHARLINE .
  CLASS-METHODS CONV_ITAB_TO_DATA
    IMPORTING
      !IT_ITAB TYPE STANDARD TABLE
      !IV_WITH TYPE STRING OPTIONAL
    RETURNING
      VALUE(RV_VALUE) TYPE STRING .
  CLASS-METHODS CORRECT_FORMAT_CONVERSION
    IMPORTING
      VALUE(IV_SOURCE) TYPE TEXT4096
      VALUE(IS_DESC) TYPE DFIES
    EXPORTING
      !EV_TARGET TYPE ANY
    RETURNING
      VALUE(RS_RETURN) TYPE BAPIRET2 .
  CLASS-METHODS CREATE_TOP_OF_PAGE
    IMPORTING
      !IO_PARENTS TYPE REF TO CL_GUI_CONTAINER
      !IO_DOCU TYPE REF TO CL_DD_DOCUMENT
      !IV_REPID TYPE REPID DEFAULT SY-CPROG
      !IT_EXCLU TYPE MGV_LAMA_RSLDBSELOP_TT OPTIONAL
      !IT_INCLU TYPE TY_HEADINFO_T OPTIONAL
      !IV_CONV TYPE CHAR1 OPTIONAL
    CHANGING
      !CO_SPLITTER TYPE REF TO CL_GUI_SPLITTER_CONTAINER
    RETURNING
      VALUE(RV_SUBRC) TYPE SUBRC .
  CLASS-METHODS CURRENCY_CONV_TO_EXTERNAL
    IMPORTING
      !IV_CURR TYPE WAERS
      !IV_AMT_INT TYPE ANY
    EXPORTING
      VALUE(EV_AMT_EXT) TYPE ANY
    RETURNING
      VALUE(RV_AMT_EXT) TYPE BAPICURR_D.
  CLASS-METHODS CURRENCY_CONV_TO_INTERNAL
    IMPORTING
      !IV_CURR TYPE WAERS
      !IV_AMT_EXT TYPE ANY
    EXPORTING
      VALUE(EV_AMT_INT) TYPE ANY
    RETURNING
      VALUE(RV_AMT_INT) TYPE BAPICURR_D.
  CLASS-METHODS CURRENCY_CONV_TO_TEXT
    IMPORTING
      !IV_CURR TYPE WAERS
      !IV_WITH_COMMA TYPE CHAR1 DEFAULT ' '
      !IV_AMT_INT TYPE ANY
    RETURNING
      VALUE(RV_AMT_EXT) TYPE CHAR20.
  CLASS-METHODS DATA_COUNT_MESSAGE
    IMPORTING
      !IT_TABLE TYPE STANDARD TABLE
      !IV_AUTHO TYPE C OPTIONAL
    EXPORTING
      !EV_COUNT TYPE I.
  CLASS-METHODS DEL_IF_ITEM
    IMPORTING
      !IV_ZIFID TYPE ZCOIFID. "CHAR10 I/F ID 
  CLASS-METHODS DYNAMIC_SQL
    IMPORTING
      !IV_SOURCE_TAB TYPE STRING
      VALUE(IV_SQL_FIELDS) TYPE STRING
      VALUE(IV_SQL_COND) TYPE STRING OPTIONAL
      VALUE(IV_SQL_GROUPBY) TYPE STRING OPTIONAL
      VALUE(IV_SQL_HAVING) TYPE STRING OPTIONAL
    EXPORTING
      !ET_DATA TYPE STANDARD TABLE
    RETURNING
      VALUE(RV_SUBRC) TYPE SY-SUBRC .
  CLASS-METHODS FILE_SAVE_DIALOG
    IMPORTING
      !IV_FILENAME TYPE STRING
      VALUE(IV_FILE_FILTER) TYPE STRING OPTIONAL
      !IV_INITIAL_DIRECTORY TYPE STRING OPTIONAL
    RETURNING
      VALUE(RV_FULLPATH) TYPE STRING .
  CLASS-METHODS GET_AVACP_TEXT
    IMPORTING
      !IV_AVACP TYPE ZCOAVACP "CHAR1 통제기간"
    EXPORTING
      !EV_SUBRC TYPE SYSUBRC
    RETURNING
    	VALUE(RV_AVACP_T) TYPE CHAR20.
  CLASS-METHODS GET_AVAC_PRIOD_INFO
    IMPORTING
      !I_KOKRS TYPE KOKRS
      !I_MONAT TYPE MONAT
      !I_SAKNR TYPE SAKNR
    EXPORTING
      !E_AVACT TYPE ZCOAVACT "X 통제여부"
      !E_AVACP TYPE ZCOAVACP "CHAR1 통제기간"
      !E_AVAPR TYPE ZCOAVAPR "CHAR3 해당 통제기간"1Y/1H/2H/1Q/2Q/3Q/4Q/1M.../12M
      !E_MONFR TYPE MONAT
      !E_MONTO TYPE MONAT.
  CLASS-METHODS GET_AWTYP_TEXT
    IMPORTING
      !IV_AWTYP TYPE AWTYP
    EXPORTING
      !EV_SUBRC TYPE SYSUBRC
    RETURNING
    	VALUE(RV_AWTYPT) TYPE TEXT_TYP.
  CLASS-METHODS GET_BKLAS_TEXT
    IMPORTING
      !IV_BKLAS TYPE BKLAS
    EXPORTING
      !EV_SUBRC TYPE SYSUBRC
    RETURNING
    	VALUE(RV_BKLAST) TYPE BKBEZ.
  CLASS-METHODS GET_BNAME_TEXT
    IMPORTING
      !IV_BNAME TYPE XUBNAME
    RETURNING
    	VALUE(RV_BNAMET) TYPE CHAR20.
  CLASS-METHODS GET_ERKRS_FRO_KOKRS
    IMPORTING
      !IV_KOKRS TYPE KOKRS
    RETURNING
      VALUE(RV_ERKRS) TYPE ERKRS .
  CLASS-METHODS GET_BUKRS_FROM_KOKRS
    IMPORTING
      !IV_KOKRS TYPE KOKRS
    RETURNING
      VALUE(RV_BUKRS) TYPE BUKRS .
  CLASS-METHODS GET_BUKRS_TEXT
    IMPORTING
      !I_BUKRS TYPE BUKRS
    RETURNING
      VALUE(E_BTEXT) TYPE BUTXT .
  CLASS-METHODS GET_BWART_TEXT
    IMPORTING
      !IV_BWART TYPE BWART
    EXPORTING
      !EV_SUBRC TYPE SYSUBRC
    RETURNING
    	VALUE(RV_BWARTT) TYPE BWTXT.
  CLASS-METHODS GET_CHNNL_TEXT
    IMPORTING
      !IV_CHNNL TYPE ZCOCHNNL "CHAR02 유통경로"
    EXPORTING
      !EV_SUBRC TYPE SYSUBRC
    RETURNING
    	VALUE(RV_CHNNL_T) TYPE CHAR20.
  CLASS-METHODS GET_CHNNL_TEXT2
    IMPORTING
      !IV_CHNNL TYPE ZCOCHNNL "CHAR02 유통경로"
    EXPORTING
      !EV_SUBRC TYPE SYSUBRC
    RETURNING
    	VALUE(RV_CHNNL_T) TYPE CHAR20.
  CLASS-METHODS GET_CURTP_TEXT
    IMPORTING
      !I_CURTP TYPE FINS_CURTYPE
    RETURNING
      VALUE(E_NAME) TYPE FINS_CURTYPET .
  CLASS-METHODS GET_DOMAIN_TEXT
    IMPORTING
      !IV_DOMNAME TYPE DD07L-DOMNAME
      !IV_DOMVALUE TYPE ANY
    EXPORTING
      !EV_SUBRC TYPE SYSUBRC
    RETURNING
      VALUE(RV_DDTEXT) TYPE DDTEXT .
  CLASS-METHODS GET_DSTTY_TEXT
    IMPORTING
      !IV_DSTTY TYPE ZCODSTTY "CHAR02 유통구분"
    EXPORTING
      !EV_SUBRC TYPE SYSUBRC
    RETURNING
    	VALUE(RV_DSTTY_T) TYPE CHAR20.
  CLASS-METHODS GET_DYNP_VALUE
    IMPORTING
      !I_FIELD TYPE DYNPREAD-FIELDNAME
      !I_REPID TYPE SYST-REPI2 DEFAULT SY-CPROG
      !I_DYNNR TYPE SYST-DYNNR DEFAULT SY-DYNNR
    RETURNING
      VALUE(E_VALUE) TYPE DYNPREAD-FIELDVALUE .
  CLASS-METHODS GET_ELEHK_TEXT
    IMPORTING
      !I_ELEHK TYPE CK_ELESMHK
    RETURNING
      VALUE(E_TXT) TYPE CK_TXSCH .
  CLASS-METHODS GET_ERKRS_TEXT
    IMPORTING
      !I_ERKRS TYPE ERKRS
    RETURNING
      VALUE(E_TEXT) TYPE ERKRS_BZ .
  CLASS-METHODS GET_FUNC_AREA
    IMPORTING
      !IV_KOSAR TYPE KOSAR OPTIONAL
    RETURNING
      VALUE(RV_FKBER) TYPE FKBER .
  CLASS-METHODS GET_HIERARCHY_GROUP_CODE
    IMPORTING
      !IV_KOKRS TYPE KOKRS OPTIONAL
      !IV_SETCLASS TYPE SETCLASS
      !IV_GROUP_CODE TYPE ANY
    RETURNING
      VALUE(RV_SETID) TYPE SETID .
  CLASS-METHODS GET_HIERARCHY_GROUP_LIST
    IMPORTING
      !IV_KOKRS TYPE KOKRS OPTIONAL
      !IV_SETCLASS TYPE SETCLASS OPTIONAL
      !IV_SETID TYPE SETID OPTIONAL
      !IV_GROUP_CODE TYPE ANY OPTIONAL
    EXPORTING
      !ET_RANGE TYPE STANDARD TABLE
      !ET_NODES TYPE GSETH_NODE_TAB
      !ET_VALUES TYPE GSETH_VAL_TAB
    RETURNING
      VALUE(RT_RANGEVALUE) TYPE DRF_T_SELOPT .
  CLASS-METHODS GET_IF_INFO
    IMPORTING
      !IV_ZIFID TYPE ZCOIFID "CHAR10 I/F ID"
    RETURNING
      VALUE(RS_IF_INFO) TYPE ZCOCT005 . "I/F 로그관리 테이블"
  CLASS-METHODS GET_INCREMENTAL_TIMESTAMP
    CHANGING
      !C_TIMESTAMP TYPE TIMESTAMP.
  CLASS-METHODS GET_KOKRS_TEXT
    IMPORTING
      !I_KOKRS TYPE KOKRS
    RETURNING
      VALUE(E_KTEXT) TYPE BEZEI .
  CLASS-METHODS GET_KOSTL_TEXT
    IMPORTING
      !IV_KOKRS TYPE KOKRS
      !IV_KOSTL TYPE KOSTL
      !IV_DATBI TYPE DATS DEFAULT '99991231'
      !IV_SPRAS TYPE SPRAS DEFAULT '3'
    EXPORTING
      !EV_SUBRC TYPE SYSUBRC
    RETURNING
      VALUE(RV_KOSTLT) TYPE KLTXT .
  CLASS-METHODS GET_KSGRU_TEXT
    IMPORTING
      !I_KOKRS TYPE KOKRS
      !I_KSGRU TYPE RKSB1-KSGRU
    EXPORTING
      !EV_SUBRC TYPE SYSUBRC
    RETURNING
      VALUE(E_DESCRIPT) TYPE SETTEXT .
  CLASS-METHODS GET_LAST_DATS
    IMPORTING
      !IV_DATE TYPE ANY
    RETURNING
      VALUE(RV_DATE) TYPE DATS .
  CLASS-METHODS GET_MATKL_TEXT
    IMPORTING
      !IV_MATKL TYPE MATKL
    EXPORTING
      !EV_SUBRC TYPE SYSUBRC
    RETURNING
      VALUE(RV_WGBEZ) TYPE WGBEZ .
  CLASS-METHODS GET_MATNR_TEXT
    IMPORTING
      !IV_MATNR TYPE MATNR
    EXPORTING
      !EV_SUBRC TYPE SYSUBRC
    RETURNING
      VALUE(RV_MAKTX) TYPE MAKTX .
  CLASS-METHODS GET_MATNR_TEXT2
    IMPORTING
      !IV_GJAHR TYPE GJAHR
      !IV_MATNR TYPE MATNR
    EXPORTING
      !EV_SUBRC TYPE SYSUBRC
    RETURNING
      VALUE(RV_MAKTX) TYPE MAKTX .
  CLASS-METHODS GET_MATNR_TEXT3
    IMPORTING
      !IV_MATNR TYPE MATNR
    EXPORTING
      !EV_SUBRC TYPE SYSUBRC
    RETURNING
      VALUE(RV_MAKTX) TYPE MAKTX .
  CLASS-METHODS GET_MONTH_COUNT
    IMPORTING
      !IV_SPMON_FR TYPE SPMON
      !IV_SPMON_TO TYPE SPMON
    RETURNING
      VALUE(RV_COUNT) TYPE I .
  CLASS-METHODS GET_MON_TEXT
    IMPORTING
      !IV_MON TYPE FCMNR
    RETURNING
      VALUE(RV_TXT) TYPE FCLTX.
  CLASS-METHODS GET_NEXT_NUMBER
    IMPORTING
      !IV_OBJECT TYPE NROBJ
      !IV_NR_RANGE_NR TYPE NRNR
      !IV_BUKRS TYPE BUKRS OPTIONAL
      !IV_GJAHR TYPE NRYEAR OPTIONAL
    RETURNING
      VALUE(RV_NUMBER) TYPE CHAR10.
  CLASS-METHODS GET_NEXT_YYYYMM
    IMPORTING
      !IV_SPMON TYPE SPMON
    RETURNING
      VALUE(RV_SPMON) TYPE SPMON.
  CLASS-METHODS GET_PGM_PARAMETER
    IMPORTING
      VALUE(IV_REPID) TYPE REPID DEFAULT SY-CPROG
    EXPORTING
      !ET_SELTAB TYPE TY_RSPARAMS
      !ET_SELINFO TYPE TY_RSEL_INFO
      !ET_SELTEXT TYPE FC00_T_SEL_SCREEN_TEXTPOOL
    RETURNING
      VALUE(RV_SUBRC) TYPE SUBRC .
  CLASS-METHODS GET_PLAN_ACC
    IMPORTING
      !IV_KOKRS TYPE KOKRS
    RETURNING
      VALUE(RT_SAKNR) TYPE FKKID_TAB_HKONT_RNG.
  CLASS-METHODS GET_PLAN_VERSN
    IMPORTING
      !IV_KOKRS TYPE KOKRS
      !IV_GJAHR TYPE GJAHR
      !IV_CLASS TYPE ZECLASS DEFAULT 'A04' "CHAR5 코드 클래스"
    RETURNING
      VALUE(RV_VERSN) TYPE VERSN.
  CLASS-METHODS GET_PRCTR_TEXT
    IMPORTING
      !I_KOKRS TYPE KOKRS
      !I_PRCTR TYPE PRCTR
    RETURNING
      VALUE(E_KTEXT) TYPE KTEXT .
  CLASS-METHODS GET_PRGRU_TEXT
    IMPORTING
      !I_KOKRS TYPE KOKRS
      !I_PRGRU TYPE RKSB1-PRGRU
    RETURNING
      VALUE(E_DESCRIPT) TYPE SETTEXT .
  CLASS-METHODS GET_PTYP_TEXT
    IMPORTING
      !IV_PTYP TYPE CK_PTYP_BVALT
    EXPORTING
      !EV_SUBRC TYPE SYSUBRC
    RETURNING
      VALUE(RV_PTYPT) TYPE CKML_CHAR40 .
  CLASS-METHODS GET_SAKNR_TEXT
    IMPORTING
      !IV_KTOPL TYPE KTOPL DEFAULT ZCOC_KTOPL
      !IV_SAKNR TYPE SAKNR
    EXPORTING
      !EV_SUBRC TYPE SYSUBRC
    RETURNING
      VALUE(RV_SAKNRT) TYPE TXT20_SKAT .
  CLASS-METHODS GET_SALTY_TEXT
    IMPORTING
      !IV_SALTY TYPE ZCOSALTY "CHAR1 판매형식"
    EXPORTING
      !EV_SUBRC TYPE SYSUBRC
    RETURNING
      VALUE(RV_SALTY_T) TYPE CHAR20 .
  CLASS-METHODS GET_SALTY_TEXT2
    IMPORTING
      !IV_SALTY TYPE ZCOSALTY "CHAR1 판매형식"
    EXPORTING
      !EV_SUBRC TYPE SYSUBRC
    RETURNING
      VALUE(RV_SALTY_T) TYPE CHAR20 .
  CLASS-METHODS GET_STAGR_TEXT
    IMPORTING
      !I_KOKRS TYPE KOKRS
      !I_STAGR TYPE STAGR
    EXPORTING
      !EV_SUBRC TYPE SYSUBRC
    RETURNING
      VALUE(R_BEZEI) TYPE LTEXT .
  CLASS-METHODS GET_TEXT_ELEMENT
    IMPORTING
      !IV_FIELD TYPE FIELDNAME
      !IV_VALUE TYPE SDYDO_TEXT_ELEMENT
    RETURNING
      VALUE(RV_TEXT) TYPE TEXTPOOLTX .
  CLASS-METHODS GET_USER_PARAM
    IMPORTING
      VALUE(IV_PARID) TYPE USER05-PARID
    RETURNING
      VALUE(RV_VALUE) TYPE XUVALUE .
  CLASS-METHODS GET_VERSN_TEXT
    IMPORTING
      !I_VERSN TYPE COVERSI
    RETURNING
      VALUE(E_VTEXT) TYPE VERSITXT .
  CLASS-METHODS GET_WERKS_TEXT
    IMPORTING
      !IV_WERKS TYPE WERKS_D
    EXPORTING
      !EV_SUBRC TYPE SYSUBRC
    RETURNING
      VALUE(RV_WERKS_T) TYPE NAME1 .
  CLASS-METHODS K_KOKRS_SET
    IMPORTING
      !I_KOKRS TYPE KOKRS OPTIONAL
      !I_POPUP TYPE ANY DEFAULT SPACE
    RETURNING
      VALUE(E_KOKRS) TYPE KOKRS .
  CLASS-METHODS MAKE_PUT_SIGN
    CHANGING
      !CV_VARI TYPE ANY OPTIONAL .
  CLASS-METHODS MAKE_TOP_OF_PAGE
    IMPORTING
      VALUE(IO_DOCU) TYPE REF TO CL_DD_DOCUMENT
      !IO_PARENTS TYPE REF TO CL_GUI_CONTAINER
      !IT_INFO TYPE TY_HEADINFO_T
    RETURNING
      VALUE(RV_SUBRC) TYPE SUBRC .
  CLASS-METHODS POPUP_ATTACH
    IMPORTING
      !IV_INSTID TYPE SRGBTBREL-INSTID_A
      !IV_TYPEID TYPE SRGBTBREL-TYPEID_A
      !IV_MODE TYPE CHAR01 DEFAULT 'D'
      !IV_COMMIT TYPE COSE_COMMIT DEFAULT 'X'.
  CLASS-METHODS POPUP_TO_CONFIRM
    IMPORTING
      !IV_TITLE TYPE STRING OPTIONAL
      !IV_QUESTION TYPE STRING
      !IV_DEFAULT_BUTTON TYPE CHAR01 DEFAULT '2'
      !IV_WINDOW_TYPE TYPE CHAR01 DEFAULT 'A'
    RETURNING
      VALUE(RV_RETURN) TYPE CHAR01 .
  CLASS-METHODS PV
    IMPORTING
      !IV_AMT_DEC TYPE DEC015
      !IV_RATE TYPE ZCOIRATE "DEC 13.10 이자율"
      !IV_EXPPR TYPE NUMC2 "약정기간"
    RETURNING
      VALUE(RV_RESULT) TYPE DEC015 .
  CLASS-METHODS SAVE_IF_HEADER
    IMPORTING
      !IV_ZIFID TYPE ZCOIFID "CHAR10 I/F ID"
      !IV_LOGTY TYPE C
      !IV_IFDAT TYPE ZCOIFDAT OPTIONAL "DATS I/F 생성일"
      !IV_INFNO TYPE ZCOIFSEQ OPTIONAL "NUMC10 I/F 순번"
      !IV_IFRLT TYPE ZCOIFRST OPTIONAL "CHAR1 I/F 결과(S,E)"
      !IV_IFMSG TYPE BAPI_MSG OPTIONAL
      !IV_IFCNT TYPE ZCOIFCNT OPTIONAL "DEC15 I/F 건수"
    EXPORTING
    	!EV_IFDAT TYPE ZCOIFDAT
    	!EV_INFNO TYPE ZCOIFSEQ.
  CLASS-METHODS SAVE_IF_ITEM
    IMPORTING
      !IV_ZIFID TYPE ZCOIFID "CHAR10 I/F ID"
      !IV_IFDAT TYPE ZCOIFDAT "DATS I/F 생성일"
      !IV_INFNO TYPE ZCOIFSEQ "NUMC10 I/F 순번"
      !IV_IFRLT TYPE ZCOIFRST OPTIONAL "CHAR1 I/F 결과(S,E)"
      !IV_IFMSG TYPE BAPI_MSG OPTIONAL
      !IV_DO_NOT_UPDATE_MESSAGE TYPE CHAR01 OPTIONAL
      !IT_DATA TYPE STANDARD TABLE.
  CLASS-METHODS SET_DYNP_VALUE
    IMPORTING
      !I_FIELD TYPE DYNPREAD-FIELDNAME
      !I_VALUE TYPE DYNPREAD-FIELDVALUE
      !I_REPID TYPE SYST-REPI2 DEFAULT SY-CPROG
      !I_DYNNR TYPE SYST-DYNNR DEFAULT SY-DYNNR .
  CLASS-METHODS GET_KEY_FIELDS
    IMPORTING
      !IV_TABNAME TYPE TABNAME
      !IV_WITH_MANDT TYPE C DEFAULT ' '
    RETURNING
      VALUE(RT_FIELDS) TYPE FIELDNAME_T .
  CLASS-METHODS SET_FIELDS_STYLE
    IMPORTING
      !IT_FIELDS TYPE FIELDNAME_T
      !IV_STYLE TYPE LVC_STYLE
    CHANGING
      !CT_TABLE TYPE ANY TABLE.
  CLASS-METHODS SET_TIMESTAMP
    IMPORTING
      !IV_TYPE TYPE CHAR01 DEFAULT 'I'
    CHANGING
      !CS_WA TYPE ANY .
  CLASS-METHODS SHOW_BAPI_MESSAGE
    IMPORTING
      !IT_RETURN TYPE BAPIRET2_T
    RETURNING
      VALUE(RS_RETURN) TYPE BAL_S_EXCM .
  CLASS-METHODS SHOW_PROGRESS_PERCENTAGE
    IMPORTING
      !IV_TOTAL_LINES TYPE INT4 OPTIONAL
      !IV_COUNT TYPE INT4 OPTIONAL
      !IV_TEXT TYPE TEXT100 .
  CLASS-METHODS SHOW_STRING_MESSAGE
    IMPORTING
      !IV_STRING TYPE STRING
      !IV_MSGTYP TYPE SYST_MSGTY DEFAULT 'E'.
  CLASS-METHODS SIMPLE_ALV
    IMPORTING
      VALUE(IT_HDTXT) TYPE STANDARD TABLE OPTIONAL
      VALUE(IT_ITAB) TYPE STANDARD TABLE 
      VALUE(IT_NOOUT) TYPE FIELDNAME_T OPTIONAL
      VALUE(IT_KFIELDS) TYPE FIELDNAME_T OPTIONAL
      VALUE(IT_AGGRFIELDS) TYPE FIELDNAME_T OPTIONAL
      VALUE(IT_SORTFIELDS) TYPE FIELDNAME_T OPTIONAL
      VALUE(IT_QFIELDS) TYPE TY_CFIELDS_T OPTIONAL
      VALUE(IT_CFIELDS) TYPE TY_CFIELDS_T OPTIONAL
      VALUE(IV_TITLE) TYPE LVC_TITLE OPTIONAL
      VALUE(IV_TOOLBAR) TYPE BOOLEAN OPTIONAL
      VALUE(IV_START_COLUMN) TYPE INT4 OPTIONAL
      VALUE(IV_END_COLUMN) TYPE INT4 OPTIONAL
      VALUE(IV_START_LINE) TYPE INT4 OPTIONAL
      VALUE(IV_END_LINE) TYPE INT4 OPTIONAL
      VALUE(IV_TOOLTIP) TYPE C OPTIONAL.
  CLASS-METHODS WWW_DOWNLOAD
    IMPORTING
      VALUE(IV_OBJID) TYPE W3OBJID.
  CLASS-METHODS XXL_DOWNLOAD
    IMPORTING
      VALUE(IV_FILENAME) TYPE STRING OPTIONAL
      VALUE(IV_START_LINE) TYPE INT4 DEFAULT 2
      VALUE(IV_COUNT) TYPE INT4 DEFAULT 10000
      VALUE(IS_HEADER_STR) TYPE ANY
      VALUE(IT_FDCAT) TYPE LVC_T_FCAT OPTIONAL
      VALUE(IT_DATA) TYPE STANDARD TABLE
      VALUE(IT_EXCLUDE_FIELD) TYPE FIELDNAME_T OPTIONAL .
  CLASS-METHODS XXL_DOWNLOAD2
    IMPORTING
      VALUE(IV_FILENAME) TYPE STRING OPTIONAL
      VALUE(IV_START_LINE) TYPE INT4 DEFAULT 2
      VALUE(IV_COUNT) TYPE INT4 DEFAULT 10000
      VALUE(IS_HEADER_STR) TYPE ANY
      VALUE(IT_FDCAT) TYPE LVC_T_FCAT OPTIONAL
      VALUE(IT_DATA) TYPE STANDARD TABLE OPTIONAL
      VALUE(IT_EXCLUDE_FIELD) TYPE FIELDNAME_T OPTIONAL .
  CLASS-METHODS XXL_UPLOAD
    IMPORTING
      !IV_FILENAME TYPE STRING
      !IV_SHEETNO TYPE INT4 DEFAULT 1
      !IV_START_ROW TYPE INT4 DEFAULT 2
      !IV_SPLIT_ROW TYPE INT4 DEFAULT 10000
    EXPORTING
      !ET_TAB_CONVERTED_DATA TYPE STANDARD TABLE
    RETURNING
      VALUE(RT_RETURN) TYPE BAPIRET2_T .
  CLASS-METHODS XXL_UPLOAD2
    IMPORTING
      !IV_FILENAME TYPE STRING
      !IV_SHEETNO TYPE INT4 DEFAULT 1
      !IV_START_ROW TYPE INT4 DEFAULT 2
      !IV_SPLIT_ROW TYPE INT4 DEFAULT 20000
    EXPORTING
      !ET_TAB_CONVERTED_DATA TYPE STANDARD TABLE
    RETURNING
      VALUE(RT_RETURN) TYPE BAPIRET2_T .
  CLASS-METHODS GET_IF_PATH_FILENAME
    IMPORTING
      !IV_IF_ID TYPE CHAR02
      !IV_PARAM1 TYPE STRING OPTIONAL
      !IV_PARAM2 TYPE STRING OPTIONAL
    EXPORTING
      !EV_PATH TYPE STRING
      !EV_FILE TYPE STRING
    RETURNING
      VALUE(RV_FULLPATH) TYPE STRING .
  CLASS-METHODS GET_IF_LATEST_FILENAME
    IMPORTING
      !IV_IF_ID TYPE CHAR02
    EXPORTING
      !EV_PATH TYPE STRING
      !EV_FILE TYPE STRING
    RETURNING
      VALUE(RV_FULLPATH) TYPE STRING .
  CLASS-METHODS MOVE_SERVER_FILE
    IMPORTING
      !IV_FROM TYPE STRING
      !IV_TO TYPE STRING
      !IV_COPY TYPE CHAR01 OPTIONAL.
  CLASS-METHODS CALL_RESTFUL_SERVICE
    IMPORTING
      !URL TYPE STRING OPTIONAL
      !USERNAME TYPE STRING OPTIONAL
      !PASSWORD TYPE STRING OPTIONAL
      !DESTINATION TYPE C OPTIONAL
      !I_DATA TYPE DATA
    EXPORTING
      !RETURN TYPE BAPIRET2
      !E_DATA TYPE DATA.
  CLASS-METHODS GET_DD_INFO
    IMPORTING
      !IV_OBJNM TYPE TABNAME OPTIONAL
    RETURNING
      VALUE(RT_DD03P) TYPE DD03PTAB .
  CLASS-METHODS DISPLAY_TABLE_DATA
    IMPORTING
      !IV_TABNAME TYPE TABNAME
      !IV_TITLE TYPE LVC_TITLE OPTIONAL.
  CLASS-METHODS DISPLAY_TABLE_DATA3
    IMPORTING
      !IV_TABNAME TYPE TABNAME OPTIONAL
      !IV_TITLE TYPE LVC_TITLE OPTIONAL
      !IT_DEFAULT TYPE FINB_T_FIELD_VAL OPTIONAL.
  CLASS-METHODS DISPLAY_TABLE_DATA2
    IMPORTING
      !IV_TABNAME TYPE TABNAME
      !IV_TITLE TYPE LVC_TITLE OPTIONAL.
  CLASS-METHODS CALL_S_M_3_7
    IMPORTING
      !IV_PRRAMS TYPE BTCSELECT OPTIONAL.
  CLASS-METHODS REPLACE_NUM_FIELD
    IMPORTING
      !IV_FIELD TYPE ANY
    EXPORTING
      !EV_FIELD TYPE ANY.
  PROTECTED SECTION.
  PRIVATE SECTION.

  CLASS-DATA MO_ROOT TYPE REF TO CX_ROOT .
  CLASS-DATA MV_ROWNO TYPE INT4 .
  CLASS-DATA MS_IF_INFO TYPE ZCOCT005 . "I/F 로그관리 테이블"

  CLASS-METHODS MESSAGE_HEADLING
    IMPORTING
      !IV_MSG_TEXT TYPE STRING
      !IV_MESSAGE_TYPE TYPE CHAR01 OPTIONAL
      !IV_ERR_POPUP TYPE CHAR01 OPTIONAL
    RETURNING
      VALUE(RS_MSG_RETURN) TYPE BAPIRET2 .
ENDCLASS.



CLASS ZCL_COC_COMM IMPLEMENTATION.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_LAST_DATS
* +-------------------------------------------------------------------------------------------------+
* | [--->] IV_DATE                        TYPE        ANY
* | [<-()] RV_DATE                        TYPE        DATS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_LAST_DATS.

    DATA(LV_LEN) = STRLEN( IV_DATE ).

    IF IV_DATE CN '0123456789'.
      EXIT.
    ENDIF.

    CASE LV_LEN.
      WHEN 6. "YYYYMM
        RV_DATE = CONV DATS( IV_DATE && '01' ).
      WHEN 7. "YYYYMMM
        RV_DATE = CONV DATS( IV_DATE(4) && IV_DATE+5(2) && '01' ).
      WHEN 8. "YYYYMMDD
        RV_DATE = CONV DATS( IV_DATE ).
    ENDCASE.

    CALL FUNCTION 'LAST_DAY_OF_MONTHS'
      EXPORTING
        DAY_IN            = RV_DATE
      IMPORTING
        LAST_DAY_OF_MONTH = RV_DATE
      EXCEPTIONS
        DAY_IN_NO_DATE    = 1
        OTHERS            = 2.

    IF SY-SUBRC IS NOT INITIAL.
      CLEAR RV_DATE.
    ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_PGM_PARAMETER
* +-------------------------------------------------------------------------------------------------+
* | [--->] IV_REPID                       TYPE        REPID (DEFAULT =SY-CPROG)
* | [<---] ET_SELTAB                      TYPE        TY_RSPARAMS
* | [<---] ET_SELINFO                     TYPE        TY_RSEL_INFO
* | [<---] ET_SELTEXT                     TYPE        FC00_T_SEL_SCREEN_TEXTPOOL
* | [<-()] RV_SUBRC                       TYPE        SUBRC
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_PGM_PARAMETER.
*----------------------------------------------------------------------*
* DESCRIPTION      : SCREEN 1000의 화면 값을 가져온다.
* TECH. SCRIPT     : SCREEN 1000의 화면 값을 가져온다.
*----------------------------------------------------------------------*

    DATA: LS_SELTEXT TYPE TEXTPOOL,
          LT_SELTEXT LIKE TABLE OF LS_SELTEXT,
          LT_SELTAB  TYPE TABLE OF RSPARAMS,
          LT_SELINFO TYPE TABLE OF RSEL_INFO,
          LV_REPID   TYPE REPID,
          LV_INDEX   TYPE I.

    LV_REPID = IV_REPID.

    CLEAR: LT_SELINFO,
           LT_SELTEXT,
           LT_SELTAB.

    "PARAMETER LIST
    CALL FUNCTION 'RS_REPORTSELECTIONS_INFO'
      EXPORTING
        REPORT              = LV_REPID
      TABLES
        FIELD_INFO          = LT_SELINFO
      EXCEPTIONS
        NO_SELECTIONS       = 1
        REPORT_NOT_EXISTENT = 2
        SUBROUTINE_POOL     = 3
        OTHERS              = 4.
    IF SY-SUBRC <> 0.
      RV_SUBRC = SY-SUBRC.
      RETURN.
    ENDIF.

    "PARAMETER TEXT
    CALL FUNCTION 'RS_TEXTPOOL_READ'
      EXPORTING
        OBJECTNAME           = LV_REPID
        ACTION               = SPACE
      TABLES
        TPOOL                = LT_SELTEXT
      EXCEPTIONS
        OBJECT_NOT_FOUND     = 1
        PERMISSION_FAILURE   = 2
        INVALID_PROGRAM_TYPE = 3
        ERROR_OCCURED        = 4
        ACTION_CANCELLED     = 5
        OTHERS               = 6.
    IF SY-SUBRC <> 0.
      RV_SUBRC = SY-SUBRC.
      RETURN.
    ELSE.
      LOOP AT LT_SELTEXT INTO LS_SELTEXT.
        LV_INDEX = SY-TABIX.
        IF LS_SELTEXT-ID NE 'S'.
          DELETE LT_SELTEXT INDEX LV_INDEX.
          CONTINUE.
        ENDIF.

        LS_SELTEXT-ENTRY = LS_SELTEXT-ENTRY+8(247).
        MODIFY LT_SELTEXT FROM LS_SELTEXT INDEX LV_INDEX TRANSPORTING ENTRY.
      ENDLOOP.
      DELETE LT_SELTEXT WHERE ID NE 'S'.
    ENDIF.

    "PARAMETER VALUE
    CALL FUNCTION 'RS_REFRESH_FROM_SELECTOPTIONS'
      EXPORTING
        CURR_REPORT     = LV_REPID
      TABLES
        SELECTION_TABLE = LT_SELTAB
      EXCEPTIONS
        NOT_FOUND       = 1
        NO_REPORT       = 2
        OTHERS          = 3.
    IF SY-SUBRC <> 0.
      RV_SUBRC = SY-SUBRC.
      RETURN.
    ENDIF.

    ET_SELINFO = LT_SELINFO.
    ET_SELTAB  = LT_SELTAB.
    ET_SELTEXT = LT_SELTEXT.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_PRCTR_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_PRCTR                        TYPE        PRCTR
* | [<-()] E_KTEXT                        TYPE        KTEXT
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_PRCTR_TEXT.

    CHECK I_PRCTR IS NOT INITIAL.

    SELECT SINGLE KTEXT
      INTO E_KTEXT
      FROM CEPCT
     WHERE SPRAS = SY-LANGU
       AND PRCTR = I_PRCTR
       AND DATBI >= SY-DATLO
       AND KOKRS = I_KOKRS.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_PRGRU_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_PRGRU                        TYPE        RKSB1-PRGRU
* | [<-()] E_DESCRIPT                     TYPE        SETTEXT
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_PRGRU_TEXT.

    SELECT SINGLE DESCRIPT
      INTO E_DESCRIPT
      FROM SETHEADERT
     WHERE SETCLASS = '0106'
       AND SUBCLASS = I_KOKRS
       AND SETNAME  = I_PRGRU
       AND LANGU    = SY-LANGU.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_STAGR_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_STAGR                        TYPE        STAGR
* | [<-()] E_BEZEI                        TYPE        LTEXT
* | [<-()] E_BEZEI                        TYPE        LTEXT
* | [<-()] E_BEZEI                        TYPE        LTEXT
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_STAGR_TEXT.

		CLEAR: EV_SUBRC, R_BEZEI.
		
    SELECT SINGLE STAGR
      FROM TKT03
     WHERE KOKRS = @I_KOKRS
       AND STAGR = @I_STAGR
      INTO @DATA(LV_STAGR).

		IF SY-SUBRC = 0.
		
    SELECT SINGLE BEZEI
      FROM TKT03
     WHERE SPRAS = @SY-LANGU
       AND KOKRS = @I_KOKRS
       AND STAGR = @I_STAGR
      INTO @R_BEZEI.

		ELSE.
	
			EV_SUBRC = 4.
	
		ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_TEXT_ELEMENT
* +-------------------------------------------------------------------------------------------------+
* | [--->] IV_FIELD                       TYPE        FIELDNAME
* | [--->] IV_VALUE                       TYPE        SDYDO_TEXT_ELEMENT
* | [<-()] RV_TEXT                        TYPE        TEXTPOOLTX
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_TEXT_ELEMENT.


    DATA: LS_PTAB        TYPE ABAP_PARMBIND,
          LT_PTAB        TYPE ABAP_PARMBIND_TAB,
          LS_SEOCMPKEY   TYPE SEOCMPKEY,
          LT_PARM        TYPE SEOS_PARAMETERS_R,
          LV_METHOD_NAME TYPE TMDIR-METHODNAME,
          LV_CLS_NAME    TYPE CLASSNAME VALUE 'ZCL_COC_COMM'.

    LV_METHOD_NAME = 'GET_' && IV_FIELD && '_TEXT'.

    "CHECK METHOD EXIST
    CALL FUNCTION 'RPY_EXISTENCE_CHECK_METH'
      EXPORTING
        CLASS     = LV_CLS_NAME
        METHOD    = LV_METHOD_NAME
      EXCEPTIONS
        NOT_EXIST = 1
        OTHERS    = 2.
    IF SY-SUBRC <> 0.
      EXIT.
    ENDIF.

    "GET METHOD PARAMETER
    LS_SEOCMPKEY-CLSNAME = LV_CLS_NAME.
    LS_SEOCMPKEY-CMPNAME = LV_METHOD_NAME.

    CALL FUNCTION 'SEO_PARAMETER_READ_ALL'
      EXPORTING
        CMPKEY                 = LS_SEOCMPKEY
      IMPORTING
        PARAMETERS             = LT_PARM
      EXCEPTIONS
        COMPONENT_NOT_EXISTING = 1
        OTHERS                 = 2.
    IF SY-SUBRC <> 0.
      EXIT.
    ENDIF.

    "SET METHOD PARAMETER
    LOOP AT LT_PARM REFERENCE INTO DATA(LS_PARM).

      CHECK LS_PARM->PAROPTIONL IS INITIAL.

      LS_PTAB-NAME = LS_PARM->SCONAME.

      CASE LS_PARM->PARDECLTYP.
        WHEN 0. "IMPORTING PARAMETER
          LS_PTAB-KIND = CL_ABAP_OBJECTDESCR=>EXPORTING.

          CONCATENATE 'I_' IV_FIELD INTO DATA(LV_IMPORT).

          CASE LS_PTAB-NAME.
            WHEN 'I_LANGU' OR 'I_SPRAS'.
              LS_PTAB-VALUE = REF #( SY-LANGU ).
            WHEN LV_IMPORT.
              CREATE DATA LS_PTAB-VALUE TYPE (LS_PARM->TYPE).
              ASSIGN LS_PTAB-VALUE->* TO FIELD-SYMBOL(<LV_VALUE>).
              <LV_VALUE> = IV_VALUE.
            WHEN OTHERS.
              CLEAR LS_PTAB.
              CONTINUE.
          ENDCASE.

          INSERT LS_PTAB INTO TABLE  LT_PTAB.

        WHEN 1. "EXPORTING PARAMETER
          LS_PTAB-KIND  = CL_ABAP_OBJECTDESCR=>IMPORTING.
          LS_PTAB-VALUE = REF #( RV_TEXT ).

          INSERT LS_PTAB INTO TABLE  LT_PTAB.

        WHEN 2. "CHANGING PARAMETER

        WHEN 3. "RETURNING PARAMETER
          LS_PTAB-KIND  = CL_ABAP_OBJECTDESCR=>RETURNING.

          LS_PTAB-VALUE = REF #( RV_TEXT ).

          INSERT LS_PTAB INTO TABLE  LT_PTAB.

      ENDCASE.

      CLEAR LS_PTAB.

    ENDLOOP.

    "DYNAMIC CALL METHOD
    CHECK LT_PTAB IS NOT INITIAL.

    TRY.

        CALL METHOD (LV_CLS_NAME)=>(LV_METHOD_NAME)
          PARAMETER-TABLE LT_PTAB.

      CATCH CX_SY_DYN_CALL_ILLEGAL_TYPE INTO DATA(LO_ROOT).
        DATA(LV_MSG) = LO_ROOT->GET_TEXT( ).
        EXIT.

      CATCH CX_SY_DYN_CALL_PARAM_MISSING INTO DATA(LO_ROOT_1).
        LV_MSG = LO_ROOT_1->GET_TEXT( ).
        EXIT.

    ENDTRY.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_USER_PARAM
* +-------------------------------------------------------------------------------------------------+
* | [--->] IV_PARID                       TYPE        USER05-PARID
* | [<-()] RV_VALUE                       TYPE        XUVALUE
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_USER_PARAM.

    CALL FUNCTION 'TPM_THX_USER_PARAMETER_GET'
      EXPORTING
        I_PARAM_ID    = IV_PARID
      IMPORTING
        E_PARAM_VALUE = RV_VALUE.

    IF RV_VALUE IS INITIAL.
      GET PARAMETER ID IV_PARID FIELD RV_VALUE.
    ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_VERSN_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_VERSN                        TYPE        COVERSI
* | [<-()] E_VTEXT                        TYPE        VERSITXT
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_VERSN_TEXT.

    CHECK I_VERSN IS NOT INITIAL.

    SELECT SINGLE VTEXT
      INTO E_VTEXT
      FROM TKVST
     WHERE SPRAS = SY-LANGU
       AND VERSI = I_VERSN.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_WERKS_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_WERKS                        TYPE        WERKS_D
* | [<-()] E_NAME1                        TYPE        NAME1
* | [<-()] E_NAME1                        TYPE        NAME1
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_WERKS_TEXT.

    CLEAR: EV_SUBRC, RV_WERKS_T.

    SELECT SINGLE NAME1
      FROM T001W
     WHERE WERKS = @IV_WERKS
      INTO @RV_WERKS_T.

		IF SY-SUBRC <> 0.
			EV_SUBRC = 4.
		ENDIF.
			
  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>K_KOKRS_SET
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS (DEFAULT ='L000')
* | [<-()] E_KOKRS                        TYPE        KOKRS
* | [<-()] E_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD K_KOKRS_SET.

    	"없으면 팝업
      CALL FUNCTION 'K_KOKRS_SET'
        EXPORTING
          I_KOKRS       = I_KOKRS
          POPUP         = I_POPUP
        IMPORTING
        	E_KOKRS       = E_KOKRS
        EXCEPTIONS
          ERROR_MESSAGE = 1.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>MAKE_PUT_SIGN
* +-------------------------------------------------------------------------------------------------+
* | [<-->] CV_VARI                        TYPE        ANY(OPTIONAL)
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD MAKE_PUT_SIGN.

    CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
      CHANGING
        VALUE = CV_VARI.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>MAKE_TOP_OF_PAGE
* +-------------------------------------------------------------------------------------------------+
* | [--->] IO_DOCU                        TYPE REF TO CL_DD_DOCUMENT
* | [--->] IO_PARENTS                     TYPE REF TO CL_GUI_CONTAINER
* | [--->] IT_INFO                        TYPE        TY_HEADINFO_T
* | [<-()] RV_SUBRC                       TYPE        SUBRC
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD MAKE_TOP_OF_PAGE.

*-- CREATE HEADER BOX
    DATA: LS_INFO TYPE TY_HEADINFO_S,
          LT_INFO LIKE TABLE OF LS_INFO.

    DATA: LO_TABLE    TYPE REF TO CL_DD_TABLE_ELEMENT,
          LO_COL_PARA TYPE REF TO CL_DD_AREA,
          LO_COL_VALU TYPE REF TO CL_DD_AREA,
          LO_COL_TEXT TYPE REF TO CL_DD_AREA.

    DATA: LV_ICON TYPE ICONNAME,
          LV_1ST  TYPE W3_QVALUE,
          LV_2ST  TYPE W3_QVALUE,
          LV_3ST  TYPE W3_QVALUE,
          LV_FULL TYPE W3_QVALUE,
          LV_BLNK TYPE I.

    CONSTANTS: LC_STRO TYPE SDYDO_ATTRIBUTE VALUE 'STRONG',
               LC_0    TYPE W3_QVALUE       VALUE '0',
               LC_X    TYPE C               VALUE 'X'.

*-- CHECK INITIAL
    IF IT_INFO[] IS INITIAL.
      RV_SUBRC = 4.
      RETURN.
    ELSE.
      LT_INFO[] = IT_INFO[].
    ENDIF.

    LOOP AT LT_INFO INTO LS_INFO.
      IF LV_1ST < STRLEN( LS_INFO-PARA ).
        LV_1ST = STRLEN( LS_INFO-PARA ).
      ENDIF.
      IF LV_2ST < STRLEN( LS_INFO-VALU ).
        LV_2ST = STRLEN( LS_INFO-VALU ).
      ENDIF.
      IF LV_3ST < STRLEN( LS_INFO-TEXT ).
        LV_3ST = STRLEN( LS_INFO-TEXT ).
      ENDIF.
    ENDLOOP.

    LV_1ST = ( LV_1ST * 15 ) + 10.
    LV_2ST = ( LV_2ST * 10 ) + 10.
    LV_3ST = ( LV_3ST * 10 ) + 10.

    IF LV_1ST < 90.
      LV_1ST = 100.
    ENDIF.
    IF LV_2ST < 90.
      LV_2ST = 100.
    ENDIF.
    IF LV_3ST < 90.
      LV_3ST = 100.
    ENDIF.

    LV_FULL = LV_1ST + LV_2ST + LV_3ST + 10.

    CONDENSE: LV_1ST, LV_2ST, LV_3ST, LV_FULL.

*-- DOCUMENT OBJECT INITIALIZATION
    CALL METHOD IO_DOCU->INITIALIZE_DOCUMENT( ).

*-- MAKE HEADER
    CALL METHOD IO_DOCU->ADD_TABLE
      EXPORTING
        NO_OF_COLUMNS = 4
        WITH_HEADING  = SPACE
        WIDTH         = LV_FULL
        BORDER        = LC_0
      IMPORTING
        TABLE         = LO_TABLE.

*-- FRAME COLUMN 1
    CALL METHOD LO_TABLE->ADD_COLUMN
      EXPORTING
        WIDTH  = LV_1ST
      IMPORTING
        COLUMN = LO_COL_PARA.

*-- FRAME COLUMN 2
    CALL METHOD LO_TABLE->ADD_COLUMN
      EXPORTING
        WIDTH  = LV_2ST
      IMPORTING
        COLUMN = LO_COL_VALU.

*-- FRAME COLUMN 3
    CALL METHOD LO_TABLE->ADD_COLUMN
      EXPORTING
        WIDTH  = LV_3ST
      IMPORTING
        COLUMN = LO_COL_TEXT.

    LOOP AT LT_INFO INTO LS_INFO.

*-- ADD ICON
      IF LS_INFO-ICON IS NOT INITIAL.
        LV_ICON = LS_INFO-ICON.
        CALL METHOD LO_COL_PARA->ADD_ICON
          EXPORTING
            SAP_ICON = LV_ICON
            SAP_SIZE = CL_DD_AREA=>SMALL.
      ENDIF.

*-- COLUMN 1
      IF LS_INFO-PARA IS NOT INITIAL.
        IF LS_INFO-PARA(1) = SPACE.
          CALL METHOD LO_COL_PARA->ADD_GAP
            EXPORTING
              WIDTH = 1.
        ENDIF.

        CALL METHOD LO_COL_PARA->ADD_TEXT
          EXPORTING
            TEXT         = LS_INFO-PARA
            SAP_FONTSIZE = 'SMALL'
            SAP_EMPHASIS = LC_STRO.

        CALL METHOD LO_COL_PARA->NEW_LINE.

      ELSE.
        ADD 1 TO LV_BLNK.
      ENDIF.

*-- COLUMN 2
      IF LS_INFO-VALU IS NOT INITIAL.

        CALL METHOD LO_COL_VALU->ADD_TEXT
          EXPORTING
            SAP_FONTSIZE = 'SMALL'
            TEXT         = LS_INFO-VALU.

        CALL METHOD LO_COL_VALU->NEW_LINE.

      ELSE.
        ADD 1 TO LV_BLNK.
      ENDIF.

*-- COLUMN 3
      IF LS_INFO-TEXT IS NOT INITIAL.

        IF LV_BLNK = 2.
          CALL METHOD LO_TABLE->SPAN_COLUMNS
            EXPORTING
              COL_START_SPAN = LO_COL_PARA
              NO_OF_COLS     = 3.

          CALL METHOD LO_COL_PARA->ADD_TEXT
            EXPORTING
              TEXT         = LS_INFO-TEXT
              SAP_FONTSIZE = 'SMALL'
              SAP_EMPHASIS = LC_STRO.

          CALL METHOD LO_COL_PARA->NEW_LINE.

        ELSE.

          CALL METHOD LO_COL_TEXT->ADD_TEXT
            EXPORTING
              TEXT         = LS_INFO-TEXT
              SAP_FONTSIZE = 'SMALL'.

          CALL METHOD LO_COL_TEXT->NEW_LINE.

        ENDIF.
      ELSE.
        ADD 1 TO LV_BLNK.
      ENDIF.

      AT LAST.
        EXIT.
      ENDAT.

      IF LV_BLNK = 3.
        CALL METHOD LO_COL_TEXT->NEW_LINE.
      ENDIF.

      CALL METHOD LO_TABLE->NEW_ROW.

      CLEAR LV_BLNK.

    ENDLOOP.

    CALL METHOD IO_DOCU->MERGE_DOCUMENT( ).

*-- DISPLAY DOCUMENTS
    CALL METHOD IO_DOCU->DISPLAY_DOCUMENT
      EXPORTING
        REUSE_CONTROL      = LC_X
        REUSE_REGISTRATION = LC_X
        PARENT             = IO_PARENTS
      EXCEPTIONS
        HTML_DISPLAY_ERROR = 1.

    IF SY-SUBRC <> 0.
      RV_SUBRC = SY-SUBRC.
      RETURN.
    ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PRIVATE METHOD ZCL_COC_COMM=>MESSAGE_HEADLING
* +-------------------------------------------------------------------------------------------------+
* | [--->] IV_MSG_TEXT                    TYPE        STRING
* | [--->] IV_MESSAGE_TYPE                TYPE        CHAR01(OPTIONAL)
* | [--->] IV_ERR_POPUP                   TYPE        CHAR01(OPTIONAL)
* | [<-()] RS_MSG_RETURN                  TYPE        BAPIRET2
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD MESSAGE_HEADLING.

    DATA: LT_LINE  TYPE TABLE OF SYMSGV,
          LS_LINE  TYPE SYMSGV,

          LS_MSG   TYPE BAPIRET2,
          LV_MSG   TYPE STRING,
          LV_FNAME TYPE FIELDNAME,
          LV_CNT   TYPE N VALUE 1.

    FIELD-SYMBOLS <LV_VALUE> TYPE ANY.

    IF IV_MSG_TEXT IS INITIAL.
      EXIT.
    ELSE.
      LV_MSG = IV_MSG_TEXT.
    ENDIF.

*-- SPLIT LONG TEXT MESSAGE
    IF LV_MSG IS NOT INITIAL.

      SPLIT LV_MSG AT SPACE INTO TABLE LT_LINE.
      CLEAR LV_MSG.

      LOOP AT LT_LINE INTO LS_LINE.

        IF LV_MSG IS INITIAL.
          CONCATENATE LV_MSG LS_LINE INTO LV_MSG.
        ELSE.
          CONCATENATE LV_MSG LS_LINE INTO LV_MSG SEPARATED BY SPACE.
        ENDIF.


*-- ASSIGN MESSAGE VALUE FIELD
        CLEAR LV_FNAME. UNASSIGN <LV_VALUE>.
        CONCATENATE 'LS_MSG_MESSAGE_V' LV_CNT INTO LV_FNAME.
        ASSIGN (LV_FNAME) TO <LV_VALUE>.
        CHECK <LV_VALUE> IS ASSIGNED.

        CALL METHOD CL_ABAP_LIST_UTILITIES=>DYNAMIC_OUTPUT_LENGTH
          EXPORTING
            FIELD = LV_MSG
          RECEIVING
            LEN   = DATA(LV_LEN).

*-- CHECK OVER LENGTH
        IF LV_LEN >= 50.
          LV_MSG = LS_LINE.
          ADD 1 TO LV_CNT.
          CLEAR LV_FNAME. UNASSIGN <LV_VALUE>.
          CONCATENATE 'LS_MSG_MESSAGE_V' LV_CNT INTO LV_FNAME.
          ASSIGN (LV_FNAME) TO <LV_VALUE>.
        ENDIF.

*-- CONCATENATE SPLIT MESSAGE
        CHECK <LV_VALUE> IS ASSIGNED.
        IF <LV_VALUE> IS INITIAL.
          CONCATENATE <LV_VALUE> LS_LINE ' ' INTO <LV_VALUE>.
        ELSE.
          CONCATENATE <LV_VALUE> LS_LINE ' ' INTO <LV_VALUE> SEPARATED BY SPACE.
        ENDIF.

      ENDLOOP.

    ENDIF.

    IF LS_MSG IS NOT INITIAL.
      MOVE-CORRESPONDING LS_MSG TO RS_MSG_RETURN.
    ENDIF.

**-- DISPLAY MESSAGE OPTION
*    IF IV_MESSAGE_TYPE IS NOT INITIAL.
*
*      IF IV_ERR_POPUP = ABAP_TRUE.
*
*        DATA(LV_ANS) = ZCL_COC_COMM=>POPUP_TO_CONFIRM(
*                                           IV_TITLE    = '메시지 확인'
*                                           IV_QUESTION = '메시지를 확인 하시겠습니까?' ).
*      ELSE.
*        LV_ANS = 'Y'.
*      ENDIF.
*
*      IF LV_ANS = 'Y'.
*        "메세지띄우기
*      ENDIF.
*
*    ENDIF.


  ENDMETHOD.











  METHOD POPUP_TO_CONFIRM.

    CASE IV_WINDOW_TYPE.

      WHEN 'A'.

        CALL FUNCTION 'POPUP_TO_CONFIRM'
          EXPORTING
            TITLEBAR              = IV_TITLE
            TEXT_QUESTION         = IV_QUESTION
            DEFAULT_BUTTON        = IV_DEFAULT_BUTTON
            DISPLAY_CANCEL_BUTTON = SPACE
          IMPORTING
            ANSWER                = RV_RETURN
          EXCEPTIONS
            TEXT_NOT_FOUND        = 1
            OTHERS                = 2.

      WHEN 'B'.
      
        DATA(LV_TEXTLINE) = CONV CHAR200( IV_QUESTION ).

        CALL FUNCTION 'POPUP_TO_CONFIRM_STEP'
          EXPORTING
            DEFAULTOPTION = 'N'
            TEXTLINE1     = LV_TEXTLINE(70)
            TEXTLINE2     = LV_TEXTLINE+70
            TITEL         = IV_TITLE
          IMPORTING
            ANSWER                = RV_RETURN.

        RV_RETURN = SWITCH #( RV_RETURN WHEN ZCOC_YES THEN '1' ).

    ENDCASE.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>SET_DYNP_VALUE
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_FIELD                        TYPE        DYNPREAD-FIELDNAME
* | [--->] I_VALUE                        TYPE        DYNPREAD-FIELDVALUE
* | [--->] I_REPID                        TYPE        SYST-REPI2 (DEFAULT =SY-CPROG)
* | [--->] I_DYNNR                        TYPE        SYST-DYNNR (DEFAULT =SY-DYNNR)
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD SET_DYNP_VALUE.

*    TRY.
*
*        CALL FUNCTION 'SET_DYNP_VALUE'
*          EXPORTING
*            I_FIELD = I_FIELD
*            I_REPID = I_REPID
*            I_DYNNR = I_DYNNR
*            I_VALUE = I_VALUE.
*
*      CATCH CX_ROOT INTO DATA(LX_ROOT).
*    ENDTRY.

    DATA: LS_DYNPREAD TYPE DYNPREAD,
          LT_DYNPREAD TYPE TABLE OF DYNPREAD.

    LT_DYNPREAD = VALUE #( ( FIELDNAME = I_FIELD FIELDVALUE = I_VALUE ) ).

    TRY.

        CALL FUNCTION 'DYNP_VALUES_UPDATE'
          EXPORTING
            DYNAME               = I_REPID
            DYNUMB               = I_DYNNR
          TABLES
            DYNPFIELDS           = LT_DYNPREAD
          EXCEPTIONS
            INVALID_ABAPWORKAREA = 1
            INVALID_DYNPROFIELD  = 2
            INVALID_DYNPRONAME   = 3
            INVALID_DYNPRONUMMER = 4
            INVALID_REQUEST      = 5
            NO_FIELDDESCRIPTION  = 6
            UNDEFIND_ERROR       = 7
            OTHERS               = 8.


      CATCH CX_ROOT INTO DATA(LX_ROOT).

        DATA(LV_ERROR_TEXT) = LX_ROOT->GET_TEXT( ).
        MESSAGE E000(0K) WITH LV_ERROR_TEXT.

    ENDTRY.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>SET_TIMESTAMP
* +-------------------------------------------------------------------------------------------------+
* | [--->] IV_TYPE                        TYPE        CHAR01 (DEFAULT ='I')
* | [<-->] CS_WA                          TYPE        ANY
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD SET_TIMESTAMP.

    DATA LS_ZCOTS TYPE ZCOTS.

    IF IV_TYPE = 'A'.

      ASSIGN COMPONENT 'ERDAT' OF STRUCTURE CS_WA TO FIELD-SYMBOL(<FS_FIELD>).

      IF <FS_FIELD> IS NOT INITIAL.
        DATA(LV_TYPE) = 'U'.
      ELSE.
        LV_TYPE = 'I'.
      ENDIF.

    ELSE.
      LV_TYPE = IV_TYPE.
    ENDIF.

    CASE LV_TYPE.

      WHEN'I'.

        LS_ZCOTS = VALUE *( ERDAT = SY-DATUM
                            ERZET = SY-UZEIT
                            ERNAM = SY-UNAME
                            "AEDAT = SY-DATUM
                            "AEZET = SY-UZEIT
                            "AENAM = SY-UNAME 
                          ).

      WHEN 'U'.

        LS_ZCOTS = CORRESPONDING #( CS_WA ). "MOVE-CORRESPONDING CS_WA TO LS_ZCOTS.

        LS_ZCOTS = VALUE ( BASE LS_ZCOTS AEDAT = SY-DATUM
                                         AEZET = SY-UZEIT
                                         AENAM = SY-UNAME  ).

    ENDCASE.

    CS_WA = CORRESPONDING #( BASE ( CS_WA ) LS_ZCOTS ). "MOVE-CORRESPONDING LS_ZCOTS TO CS_WA.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>SHOW_BAPI_MESSAGE
* +-------------------------------------------------------------------------------------------------+
* | [--->] IT_RETURN                      TYPE        BAPIRET2_T
* | [<-()] RS_RETURN                      TYPE        BAL_S_EXCM
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD SHOW_BAPI_MESSAGE.

    DATA: LS_RETURN TYPE BAPIRET2,
          LV_TEXT   TYPE C LENGTH 10,
          LV_ZEILE  TYPE I.


    CONSTANTS LC_TEXT TYPE C LENGTH 10 VALUE 'ROW NO.'.

    CHECK IT_RETURN[] IS NOT INITIAL.

    CALL FUNCTION 'MESSAGES_INITIALIZE'
      EXCEPTIONS
        LOG_NOT_ACTIVE       = 1
        WRONG_IDENTIFICATION = 2
        OTHERS               = 3.

    LOOP AT IT_RETURN INTO LS_RETURN.
      IF LS_RETURN-ROW IS INITIAL.
        LV_ZEILE = SY-TABIX.
      ELSE.
        LV_TEXT = LC_TEXT.
        LV_ZEILE = LS_RETURN-ROW.
      ENDIF.

      IF LS_RETURN-TYPE IS INITIAL.
        LS_RETURN-TYPE = 'S'.
      ENDIF.

      IF LS_RETURN-ID IS INITIAL.
        LS_RETURN-ID = '00'.
      ENDIF.

      CALL FUNCTION 'MESSAGE_STORE'
        EXPORTING
          ARBGB                  = LS_RETURN-ID
          MSGTY                  = LS_RETURN-TYPE
          MSGV1                  = LS_RETURN-MESSAGE_V1
          MSGV2                  = LS_RETURN-MESSAGE_V2
          MSGV3                  = LS_RETURN-MESSAGE_V3
          MSGV4                  = LS_RETURN-MESSAGE_V4
          TXTNR                  = LS_RETURN-NUMBER
          ZEILE                  = LV_ZEILE
        EXCEPTIONS
          MESSAGE_TYPE_NOT_VALID = 1
          NOT_ACTIVE             = 2
          OTHERS                 = 3.

      CLEAR LS_RETURN.

    ENDLOOP.

    CALL FUNCTION 'MESSAGES_SHOW'
      EXPORTING
        SHOW_LINNO_TEXT     = LV_TEXT
        SHOW_LINNO_TEXT_LEN = 5
      IMPORTING
        E_EXIT_COMMAND      = RS_RETURN
      EXCEPTIONS
        INCONSISTENT_RANGE  = 1
        NO_MESSAGES         = 2
        OTHERS              = 3.



  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>SHOW_PROGRESS_PERCENTAGE
* +-------------------------------------------------------------------------------------------------+
* | [--->] IV_TOTAL_LINES                 TYPE        INT4(OPTIONAL)
* | [--->] IV_COUNT                       TYPE        INT4(OPTIONAL)
* | [--->] IV_TEXT                        TYPE        TEXT100
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD SHOW_PROGRESS_PERCENTAGE.

    DATA: LV_PERCENT TYPE P DECIMALS 2,
          LV_TEXT    TYPE STRING.

    IF IV_TOTAL_LINES IS NOT INITIAL AND IV_COUNT IS NOT INITIAL.

      TRY.
          LV_PERCENT = TRUNC( ( IV_COUNT / IV_TOTAL_LINES ) * 100 ).
        CATCH CX_SY_ARITHMETIC_OVERFLOW.
          EXIT.
      ENDTRY.

      IF LV_PERCENT <> MV_PERCENT. "EXCEPT DUPLICATE MESSAGE
        MV_PERCENT = LV_PERCENT.

        DATA(LV_PERCENTT) = CONV CHAR6( LV_PERCENT ).
        CONCATENATE IV_TEXT LV_PERCENTT '%' INTO LV_TEXT.

        CALL FUNCTION 'SAPGUI_PROGRESS_INDICATOR'
          EXPORTING
            PERCENTAGE = MV_PERCENT
            TEXT       = LV_TEXT.

      ENDIF.

    ELSE.

      CALL FUNCTION 'SAPGUI_PROGRESS_INDICATOR'
        EXPORTING
          TEXT = LV_TEXT.

    ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>SHOW_STRING_MESSAGE
* +-------------------------------------------------------------------------------------------------+
* | [--->] IV_CPROG                       TYPE        CPROG (DEFAULT =SY-CPROG)
* | [--->] IT_RSPARAMS                    TYPE        TY_RSPARAMS(OPTIONAL)
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD SHOW_STRING_MESSAGE.
		
		CALL FUNCTION 'BUS_MESSAGE_INIT'.
		
		CALL FUNCTION 'BUS_MESSAGE_STATUS_SET'
		  EXPORTING
		  	MSG_COLL_STATUS = '2'.
		  	
		SPLIT IV_STRING AT ZCOC_SEPERATOR INTO TABLE DATA(LT_MSG).
			
	  LOOP AT LT_MSG INTO DATA(LV_MSG).
	  	
			CALL FUNCTION 'BUS_MESSAGE_STORE'
			  EXPORTING
			  	ARBGB = '0K'
			  	MSGTY = IV_MSGTYP
			  	TXTNR = 000
			  	MSGV1 = LV_MSG.
			  	
		ENDLOOP.
		
		CALL FUNCTION 'BUS_MESSAGE_SHOW'.


  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>SIMPLE_ALV
* +-------------------------------------------------------------------------------------------------+
* | [--->] IT_HDTXT                       TYPE        STANDARD TABLE(OPTIONAL)
* | [--->] IT_ITAB                        TYPE        STANDARD TABLE
* | [--->] IT_NOOUT                       TYPE        FIELDNAME_T(OPTIONAL)
* | [--->] IV_TITLE                       TYPE        LVC_TITLE(OPTIONAL)
* | [--->] IV_TOOLBAR                     TYPE        BOOLEAN(OPTIONAL)
* | [--->] IV_START_COLUMN                TYPE        INT4(OPTIONAL)
* | [--->] IV_END_COLUMN                  TYPE        INT4(OPTIONAL)
* | [--->] IV_END_COLUMN                  TYPE        INT4(OPTIONAL)
* | [--->] IV_END_COLUMN                  TYPE        INT4(OPTIONAL)
* | [--->] IV_END_COLUMN                  TYPE        INT4(OPTIONAL)
* | [--->] IV_END_COLUMN                  TYPE        INT4(OPTIONAL)
* | [--->] IV_END_COLUMN                  TYPE        INT4(OPTIONAL)
* | [--->] IV_START_LINE                  TYPE        INT4(OPTIONAL)
* | [--->] IV_END_LINE                    TYPE        INT4(OPTIONAL)
* | [--->] IV_TOOLTIP                     TYPE        C(OPTIONAL)
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD SIMPLE_ALV.
*---------------------------------------------------------------------*
*IV_TITLE        : 세션창 제목 PARAMETER 값이 없을 시 메인 프로그램 제목 사용
*IV_TOOLBAR      : 기본 툴바 제공, PARAMETER값이 없을 시 확인 버튼만 존재
*IT_NOOUT        : IT_TAB 필드 중 필요 없는 필드 등록
*IT_KFIELDS      : KEY 적용 필드 추가
*IT_CFIELDS      : 통화 적용 필드 추가
*IT_QFIELDS      : 단위 적용 필드 추가
*IT_HDTXT        : ALV HEADER TEXT
*IV_START_COLUMN : 팝업 시 위치
*IV_END_COLUMN   : 팝업 시 위치
*IV_START_LINE   : 팝업 시 위치
*IV_END_LINE     : 팝업 시 위치
*---------------------------------------------------------------------*
*EX)
*SELECT *
*  FROM SFLIGHT
*  INTO TABLE @DATA(LT_SFLIGHT).
*
*DATA(LT_NO_OUT) = VALUE FIELDNAME_T( ( CONV #( |MANDT| ) )
*                                     ( CONV #( |PRICE| ) ) ).
*
*DATA(LT_HDTXT) = VALUE SPERS_XMLT( ( CONV #( |CLIENT| ) )
*                                   ( CONV #( |AIRLINE CODE| ) )
*                                   ( CONV #( |FLIGHT CONNECTION NUMBER| ) )
*                                   ( CONV #( |FLIGHT DATE| ) )
*                                   ( CONV #( |AIRFARE| ) )
*                                   ( CONV #( |LOCAL CURRENCY OF AIRLINE| ) )
*                                   ( CONV #( |AIRCRAFT TYPE| ) )
*                                   ( CONV #( |MAXIMUM CAPACITY IN ECONOMY CLASS| ) )
*                                   ( CONV #( |OCCUPIED SEATS IN ECONOMY CLASS| ) )
*                                   ( CONV #( |TOTAL OF CURRENT BOOKINGS| ) )
*                                   ( CONV #( |MAXIMUM CAPACITY IN BUSINESS CLASS| ) )
*                                   ( CONV #( |OCCUPIED SEATS IN BUSINESS CLASS| ) )
*                                   ( CONV #( |MAXIMUM CAPACITY IN FIRST CLASS| ) )
*                                   ( CONV #( |OCCUPIED SEATS IN FIRST CLASS| ) ) ).
*
*ZCL_COC_COMM=>SIMPLE_ALV( EXPORTING IV_TITLE        = 'SFLIGHT'
*                                    IV_TOOLBAR      = ABAP_ON
*                                    IT_ITAB         = LT_SFLIGHT[]
*                                    IT_NOOUT        = LT_NO_OUT
*                                    IT_HDTXT        = LT_HDTXT
*                                    IV_START_COLUMN = 10
*                                    IV_START_LINE   = 3
*                                    IV_END_COLUMN   = 120
*                                    IV_END_LINE     = 30 ) .
*---------------------------------------------------------------------*
		DATA: LO_COLUMN TYPE REF TO CL_SALV_COLUMN_TABLE.
		
    TRY.
        CL_SALV_TABLE=>FACTORY( IMPORTING R_SALV_TABLE = DATA(LR_TABLE)
                                CHANGING  T_TABLE      = IT_ITAB[] ).
      CATCH CX_SALV_MSG.
    ENDTRY.

    DATA(LR_FUNCTIONS) = LR_TABLE->GET_FUNCTIONS( ).
    DATA(LR_COLUMNS)   = LR_TABLE->GET_COLUMNS( ).
    DATA(LR_DISP_SET)  = LR_TABLE->GET_DISPLAY_SETTINGS( ).
    DATA(LR_AGGR)  = LR_TABLE->GET_AGGREGATIONS( ).
    DATA(LR_SORT)  = LR_TABLE->GET_SORTS( ).

    "SELECTION LINE
    LR_TABLE->GET_SELECTIONS( )->SET_SELECTION_MODE( IF_SALV_C_SELECTIONA_MODE=>CELL ).
    
    "FUNCTIONS
    IF IV_TOOLBAR = ABAP_ON.
      LR_FUNCTIONS->SET_ALL( ).
    ENDIF.

    "SET OPTIMIZE
    LR_COLUMNS->SET_OPTIMIZE( ABAP_TRUE ).

    "SET POPUP
    IF IV_START_COLUMN IS NOT INITIAL.
      LR_TABLE->SET_SCREEN_POPUP( START_COLUMN = IV_START_COLUMN
                                  END_COLUMN   = IV_END_COLUMN
                                  START_LINE   = IV_START_LINE
                                  END_LINE     = IV_END_LINE ) .
    ENDIF.

    "SET TITLE
    IF IV_TITLE IS NOT INITIAL.
      LR_DISP_SET->SET_LIST_HEADER( IV_TITLE ).
    ENDIF.

		"SET SORT
		LOOP AT IT_SORTFIELDS ASSIGNING FIELD-SYMBOL(<FS_SORT>).
			TRY.
				CALL METHOD LR_SORT->ADD_SORT
				  EXPORTING
				  	COLUMNNAME = CONV #( <FS_SORT> )
				  	SUBTOTAL   = IF_SALV_C_BOOL_SAP=>TRUE.
					CATCH CX_SALV_NOT_FOUND.
					CATCH CX_SALV_EXISTING.
					CATCH CX_SALV_DATA_ERROR.
				ENDTRY.
		ENDLOOP.
		
		"SET AGGREGATION, TOTAL
		LOOP AT IT_AGGRFIELDS ASSIGNING FIELD-SYMBOL(<FS_AGGR>).
			TRY.
				CALL METHOD LR_AGGR->ADD_AGGREGATION
				  EXPORTING
				  	COLUMNNAME  = CONV #( <FS_AGGR> )
				  	AGGREGATION = IF_SALV_C_AGGREGATION=>TOTAL.
					CATCH CX_SALV_NOT_FOUND.
					CATCH CX_SALV_EXISTING.
					CATCH CX_SALV_DATA_ERROR.
				ENDTRY.
		ENDLOOP.
		
    LOOP AT LR_COLUMNS->GET( ) INTO DATA(LS_COLUMNS).

      "SET HEADER TEXT
      IF IT_HDTXT IS NOT INITIAL.
        READ TABLE IT_HDTXT ASSIGNING FIELD-SYMBOL(<FS_HDTXT>) INDEX SY-TABIX.
        IF SY-SUBRC  = 0.
          LR_COLUMNS->GET_COLUMN( LS_COLUMNS-COLUMNNAME )->SET_SHORT_TEXT( CONV #( <FS_HDTXT> ) ).
          LR_COLUMNS->GET_COLUMN( LS_COLUMNS-COLUMNNAME )->SET_MEDIUM_TEXT( CONV #( <FS_HDTXT> ) ).
          LR_COLUMNS->GET_COLUMN( LS_COLUMNS-COLUMNNAME )->SET_LONG_TEXT( CONV #( <FS_HDTXT> ) ).
        ENDIF.
      ENDIF.

      "SET NO OUT FIELDS
      IF IT_NOOUT IS NOT INITIAL.
        READ TABLE IT_NOOUT ASSIGNING FIELD-SYMBOL(<FS_NOOUT>) WITH KEY TABLE_LINE = LS_COLUMNS-COLUMNNAME.
        IF SY-SUBRC = 0.
          LR_COLUMNS->GET_COLUMN( LS_COLUMNS-COLUMNNAME )->SET_TECHNICAL( ABAP_ON ).
        ENDIF.
      ENDIF.
      
      "KEY FIELDS
      IF IT_KFIELDS IS NOT INITIAL.
        READ TABLE IT_KFIELDS ASSIGNING FIELD-SYMBOL(<FS_KFIELDS>) WITH KEY TABLE_LINE = LS_COLUMNS-COLUMNNAME.
        IF SY-SUBRC = 0.
          LO_COLUMN ?= LR_COLUMNS->GET_COLUMN( LS_COLUMNS-COLUMNNAME ).
          LO_COLUMN->SET_KEY( ABAP_ON ).
        ENDIF.
      ENDIF.
      
      "CURRENCY FIELDS
      IF IT_CFIELDS IS NOT INITIAL.
        READ TABLE IT_CFIELDS ASSIGNING FIELD-SYMBOL(<FS_CFIELDS>) WITH KEY FIELDN_1 = LS_COLUMNS-COLUMNNAME.
        IF SY-SUBRC = 0.
          LR_COLUMNS->GET_COLUMN( LS_COLUMNS-COLUMNNAME )->SET_CURRENCY_COLUMN( <FS_CFIELDS>-FIELDN_2 ).
        ENDIF.
      ENDIF.
      
      "QUANTITY FIELDS
      IF IT_QFIELDS IS NOT INITIAL.
        READ TABLE IT_QFIELDS ASSIGNING FIELD-SYMBOL(<FS_QFIELDS>) WITH KEY FIELDN_1 = LS_COLUMNS-COLUMNNAME.
        IF SY-SUBRC = 0.
          LR_COLUMNS->GET_COLUMN( LS_COLUMNS-COLUMNNAME )->SET_QUANTITY_COLUMN( <FS_QFIELDS>-FIELDN_2 ).
        ENDIF.
      ENDIF.
      
      "ICON
      IF LS_COLUMNS-COLUMNNAME CS 'ICON'.
        LO_COLUMN ?= LR_COLUMNS->GET_COLUMN( LS_COLUMNS-COLUMNNAME ).
        LO_COLUMN->SET_ICON( ABAP_ON ).
        LO_COLUMN->SET_LONG_TEXT( 'ICON' ).
      ENDIF.
      
      IF IV_TOOLTIP = ABAP_ON.
        LR_COLUMNS->GET_COLUMN( LS_COLUMNS-COLUMNNAME )->SET_TOOLTIP( VALUE = CONV #( LS_COLUMNS-COLUMNNAME ) ).
      ENDIF.
      
    ENDLOOP.

		"레이아웃 저장 제한 해제
	  DATA: LR_LAYOUT TYPE REF TO CL_SALV_LAYOUT.
	  DATA: LS_KEY TYPE SALV_S_LAYOUT_KEY.
	  LR_LAYOUT = LR_TABLE->GET_LAYOUT( ).
	  LS_KEY-REPORT = SY-REPID.
	  LR_LAYOUT->SET_KEY( LS_KEY ).
	  LR_LAYOUT->SET_SAVE_RESTRICTION( IF_SALV_C_LAYOUT=>RESTRICT_NONE ).
	  
	  "ALV 출력
    LR_TABLE->DISPLAY( ).

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>WWW_DOWNLOAD
* +-------------------------------------------------------------------------------------------------+
* | [--->] IV_CPROG                       TYPE        CPROG (DEFAULT =SY-CPROG)
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD WWW_DOWNLOAD.

		CALL FUNCTION 'ZCOCCM_DOWNLOAD_FORM_SMW0'
		  EXPORTING
		    I_OBJID = IV_OBJID
		  EXCEPTIONS
		    NO_FILE_FOUNDED = 1
		    OTHERS          = 2.
		    
		CASE SY-SUBRC.
		  WHEN 1.
		    MESSAGE S026 DISPLAY LIKE ZCOC_E.
		ENDCASE.

  ENDMETHOD.
  
  
* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>XXL_DOWNLOAD
* +-------------------------------------------------------------------------------------------------+
* | [--->] IV_FILENAME                    TYPE        STRING(OPTIONAL)
* | [--->] IV_START_LINE                  TYPE        INT4 (DEFAULT =2)
* | [--->] IV_COUNT                       TYPE        INT4 (DEFAULT =10000)
* | [--->] IS_HEADER_STR                  TYPE        ANY
* | [--->] IT_FDCAT                       TYPE        LVC_T_FCAT(OPTIONAL)
* | [--->] IT_DATA                        TYPE        STANDARD TABLE
* | [--->] IT_EXCLUDE_FIELD               TYPE        FIELDNAME_T(OPTIONAL)
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD XXL_DOWNLOAD.
*&-------------------------------------------------------------------&*
* DESCRIPTION : EXCEL DOWNLOAD
* DEVELOPER :
* CREATION DATE :
* TECH. SCRIPT :
*&-------------------------------------------------------------------&*
* IV_FILENAME   : 파일경로
* IV_START_LINE : 시작라인 지정
* IV_COUNT      : 양이 많을 경우, 잘라서 읽어 오기 위한 라인 수
* IS_HEADER_STR : 헤더 텍스트
* IT_FDCAT      : 미구현
* IT_DATA       : 미구현
*&-------------------------------------------------------------------&*

    DATA: LO_APPLICATION TYPE OLE2_OBJECT,
          LO_WORKBOOKS   TYPE OLE2_OBJECT,
          LO_WORKBOOK    TYPE OLE2_OBJECT,
          LO_WORKSHEET   TYPE OLE2_OBJECT,
          LO_RANGE       TYPE OLE2_OBJECT,
          LO_INTERIOR    TYPE OLE2_OBJECT,
          LO_FONT        TYPE OLE2_OBJECT,
          LO_CELL        TYPE OLE2_OBJECT,
          LO_BEGIN_CELL  TYPE OLE2_OBJECT,
          LO_END_CELL    TYPE OLE2_OBJECT.

    DATA: LV_RC     TYPE I,
          LV_NAME   TYPE DDTEXT,
          LV_LIMIT  TYPE I,
          LV_COUNT  TYPE I,
          LV_APPEND TYPE I,
          LV_BEGIN  TYPE I,
          LV_END    TYPE I,
          LV_COL    TYPE I,
          LV_TOTAL  TYPE I,
          LV_PASTE  TYPE C.

    DATA: LO_DREF     TYPE REF TO DATA,
          LR_TABDESCR TYPE REF TO CL_ABAP_STRUCTDESCR,
          LT_DFIES    TYPE DDFIELDS,
          LS_ROW_DATA TYPE USMD_CHARLINE,
          LT_ROW_DATA TYPE TABLE OF USMD_CHARLINE.

*-- GET COLUMNS INFO
    CREATE DATA LO_DREF LIKE LINE OF IT_DATA[].
    LR_TABDESCR ?= CL_ABAP_STRUCTDESCR=>DESCRIBE_BY_DATA_REF( LO_DREF ).
    LT_DFIES = CL_SALV_DATA_DESCR=>READ_STRUCTDESCR( LR_TABDESCR ).

*-- SET ROW LIMIT
    IF LV_COUNT BETWEEN 500 AND 50000.
      LV_LIMIT = IV_COUNT.
    ELSE.
      LV_LIMIT = 50000.
    ENDIF.

    DATA(LV_FILEPATH) = ZCL_COC_COMM=>FILE_SAVE_DIALOG( IV_FILENAME    = CONV #( IV_FILENAME )
                                                        IV_FILE_FILTER = CONV #( 'Microsoft Excel(*.XLSX;*.XLS)|*.XLSX;*.XLS' ) ). "CL_GUI_FRONTEND_SERVICES=>FILETYPE_EXCEL ). "CONV #( 'Excel(*.XLS;*.XLSX)|*.XLS;*.XLSX' ) ).
    CHECK LV_FILEPATH IS NOT INITIAL.

*---------------------------------------------------------------------*
*-- OPEN EXCEL OLE PROCESS
*---------------------------------------------------------------------*
    DATA LV_VISIBLE TYPE I.

*-- EXECUTE EXCEL LO_APPLICATION
    IF LO_APPLICATION-HEADER = SPACE OR LO_APPLICATION-HANDLE = -1.
      CREATE OBJECT LO_APPLICATION 'EXCEL.APPLICATION'.
    ENDIF.

*-- DISPLAY ON SCREEN(1: DISPLAY)
*    SET PROPERTY OF LO_APPLICATION 'VISIBLE' = 1.

**-- SET WORKBOOKS
    CALL METHOD OF LO_APPLICATION 'WORKBOOKS' = LO_WORKBOOKS.
    CALL METHOD OF LO_WORKBOOKS 'ADD' = LO_WORKBOOK.
    CALL METHOD OF LO_APPLICATION 'WORKSHEETS' = LO_WORKSHEET.
    CALL METHOD OF LO_APPLICATION 'WORKSHEETS' = LO_WORKSHEET
      EXPORTING
        #1 = 1.

    CALL METHOD OF LO_WORKSHEET 'ACTIVATE'.


*---------------------------------------------------------------------*
*-- MAKE HEADER LINE
*---------------------------------------------------------------------*
    IF IT_EXCLUDE_FIELD[] IS NOT INITIAL.
      SORT IT_EXCLUDE_FIELD BY TABLE_LINE.
    ENDIF.

    LOOP AT LT_DFIES REFERENCE INTO DATA(LS_DFIES).

      READ TABLE IT_EXCLUDE_FIELD WITH KEY TABLE_LINE = LS_DFIES->FIELDNAME TRANSPORTING NO FIELDS.
      IF SY-SUBRC IS INITIAL.
        DELETE LT_DFIES.
        CONTINUE.
      ENDIF.

      ADD 1 TO LV_COL.

      IF IS_HEADER_STR IS INITIAL.
        IF LS_DFIES->REPTEXT IS INITIAL.
          LS_DFIES->REPTEXT = LS_DFIES->FIELDTEXT.
        ENDIF.
        LV_NAME = LS_DFIES->REPTEXT.
      ELSE.
        ASSIGN COMPONENT LS_DFIES->FIELDNAME OF STRUCTURE IS_HEADER_STR TO FIELD-SYMBOL(<FS_NAME>).
        IF <FS_NAME> IS ASSIGNED.
          LV_NAME = <FS_NAME>.
        ENDIF.
      ENDIF.

*-- SET HEADER CELL STYLE & VALUE
      IF LV_NAME IS NOT INITIAL.
        CALL METHOD OF LO_WORKSHEET 'CELLS' = LO_CELL
          EXPORTING #1 = LV_COL.
        CALL METHOD OF LO_CELL 'BORDERAROUND'
          EXPORTING
            #1 = 1
            #2 = 2.
        GET PROPERTY OF LO_CELL 'INTERIOR' = LO_INTERIOR.
        SET PROPERTY OF LO_INTERIOR 'COLORINDEX' = 15.
        GET PROPERTY OF LO_CELL 'FONT' = LO_FONT.
        SET PROPERTY OF LO_FONT 'SIZE' = 10.

        SET PROPERTY OF LO_CELL 'VALUE' = LV_NAME.
      ENDIF.

      CLEAR LV_NAME.

    ENDLOOP.

    LV_COL   = LINES( LT_DFIES ). "CLUMN COUNT
    LV_TOTAL = LINES( IT_DATA ).  "TOTAL LINES

    ADD 1 TO LV_COUNT.
    ADD 1 TO LV_TOTAL.

*---------------------------------------------------------------------*
*-- COPY & PASTE
*---------------------------------------------------------------------*
    LOOP AT IT_DATA ASSIGNING FIELD-SYMBOL(<LS_DATA>).

      ADD 1 TO LV_COUNT.
      ADD 1 TO LV_APPEND.

      IF LV_COUNT = LV_LIMIT.
        LV_PASTE = ABAP_TRUE.
      ENDIF.

      AT LAST.
        LV_PASTE = ABAP_TRUE.
      ENDAT.

*-- CONVERT COLUMNS TO ROW DATA
      CALL METHOD ZCL_COC_COMM=>CONVERT_STR_TO_LINE
        EXPORTING
          IS_STR      = <LS_DATA>
          IT_DDFIELDS = LT_DFIES
        CHANGING
          CS_ROW_DATA = LS_ROW_DATA.

      APPEND LS_ROW_DATA TO LT_ROW_DATA.
      CLEAR LS_ROW_DATA.

*-- COPY TO CLIPBOARD
      IF LV_PASTE IS NOT INITIAL.
        IF LV_BEGIN IS INITIAL.
          LV_BEGIN = 2.
        ELSE.
          LV_BEGIN = LV_END + 1.
        ENDIF.

        LV_END = LV_END + LV_COUNT.

        CALL METHOD CL_GUI_FRONTEND_SERVICES=>CLIPBOARD_EXPORT
          IMPORTING
            DATA                 = LT_ROW_DATA
          CHANGING
            RC                   = LV_RC
          EXCEPTIONS
            CNTL_ERROR           = 1
            ERROR_NO_GUI         = 2
            NOT_SUPPORTED_BY_GUI = 3
            OTHERS               = 4.

        IF SY-SUBRC IS NOT INITIAL.
          CALL METHOD OF LO_APPLICATION 'QUIT'.
          MESSAGE X001(KX).
        ENDIF.

*-- SET SELECT RANGE
        CALL METHOD OF LO_WORKSHEET 'CELLS' = LO_BEGIN_CELL
          EXPORTING
            #1 = LV_BEGIN
            #2 = 1.          "START CELL POINT

        CALL METHOD OF LO_WORKSHEET 'CELLS' = LO_END_CELL
          EXPORTING
            #1 = LV_END
            #2 = LV_COL.     "END CELL POINT

        CALL METHOD OF LO_WORKSHEET 'RANGE' = LO_RANGE
          EXPORTING
            #1 = LO_BEGIN_CELL
            #2 = LO_END_CELL.

        CALL METHOD OF LO_RANGE 'SELECT'.

*-- SET FONT SIZE
        GET PROPERTY OF LO_RANGE 'FONT' = LO_FONT.
        SET PROPERTY OF LO_FONT 'SIZE' = 10.
        SET PROPERTY OF LO_RANGE 'NumberFormat' = '@'.

*-- PASTE DATA
        CALL METHOD OF LO_WORKSHEET 'PASTE'.
        CALL FUNCTION 'FLUSH'
          EXCEPTIONS
            OTHERS = 0.

        CLEAR: LT_ROW_DATA, LV_COUNT, LV_PASTE.

      ENDIF.

      ZCL_COC_COMM=>SHOW_PROGRESS_PERCENTAGE(
        IV_TOTAL_LINES = LV_TOTAL
        IV_COUNT       = LV_APPEND
        IV_TEXT        = CONV #( `DOWNLOAD IN PROGRESS... `) ) .

    ENDLOOP.

*---------------------------------------------------------------------*
*-- CLOSE OLE PROGRESS
*---------------------------------------------------------------------*
    CALL METHOD OF LO_WORKSHEET 'CELLS' = LO_BEGIN_CELL
      EXPORTING
        #1 = 1
        #2 = 1.

    CALL METHOD OF LO_WORKSHEET 'CELLS' = LO_END_CELL
      EXPORTING
        #1 = 1
        #2 = 1.

    CALL METHOD OF LO_WORKSHEET 'RANGE' = LO_RANGE
      EXPORTING
        #1 = LO_BEGIN_CELL
        #2 = LO_END_CELL.

    CALL METHOD OF LO_RANGE 'SELECT'.

*-- INITIALIZE CLIPBOARD MEMORY
    CLEAR LT_ROW_DATA.
    CL_GUI_FRONTEND_SERVICES=>CLIPBOARD_EXPORT( IMPORTING DATA       = LT_ROW_DATA
                                                 CHANGING RC         = LV_RC
                                               EXCEPTIONS CNTL_ERROR = 1
                                                          OTHERS     = 4 ).

*-- COLUMNS WIDTH OPTIMIZE
    CALL METHOD OF LO_WORKSHEET 'COLUMNS' = LO_CELL.
    CALL METHOD OF LO_CELL 'AUTOFIT'.

    IF LV_FILEPATH IS INITIAL.
      CALL METHOD OF LO_WORKSHEET 'SAVEAS'.
    ELSE.
      CALL METHOD OF LO_WORKSHEET 'SAVEAS'
        EXPORTING
          #1 = LV_FILEPATH.
    ENDIF.

    CALL METHOD OF LO_APPLICATION 'QUIT'.

    WAIT UP TO 1 SECONDS.

    CALL METHOD CL_GUI_FRONTEND_SERVICES=>EXECUTE
      EXPORTING
        DOCUMENT               = LV_FILEPATH
      EXCEPTIONS
        CNTL_ERROR             = 1
        ERROR_NO_GUI           = 2
        BAD_PARAMETER          = 3
        FILE_NOT_FOUND         = 4
        PATH_NOT_FOUND         = 5
        FILE_EXTENSION_UNKNOWN = 6
        ERROR_EXECUTE_FAILED   = 7
        SYNCHRONOUS_FAILED     = 8
        NOT_SUPPORTED_BY_GUI   = 9
        OTHERS                 = 10.

    FREE OBJECT: LO_RANGE,
                 LO_WORKSHEET,
                 LO_WORKBOOK,
                 LO_WORKBOOKS,
                 LO_APPLICATION.


  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>XXL_DOWNLOAD2
* +-------------------------------------------------------------------------------------------------+
* | [--->] IV_FILENAME                    TYPE        STRING(OPTIONAL)
* | [--->] IV_START_LINE                  TYPE        INT4 (DEFAULT =2)
* | [--->] IV_COUNT                       TYPE        INT4 (DEFAULT =10000)
* | [--->] IS_HEADER_STR                  TYPE        ANY
* | [--->] IT_FDCAT                       TYPE        LVC_T_FCAT(OPTIONAL)
* | [--->] IT_DATA                        TYPE        STANDARD TABLE
* | [--->] IT_EXCLUDE_FIELD               TYPE        FIELDNAME_T(OPTIONAL)
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD XXL_DOWNLOAD2.
*&-------------------------------------------------------------------&*
* DESCRIPTION : EXCEL DOWNLOAD
* DEVELOPER :
* CREATION DATE :
* TECH. SCRIPT :
*&-------------------------------------------------------------------&*
* IV_FILENAME : FILE PATH
* IV_START_LINE : START LINE
* IV_COUNT : IF MASS DATA, IT IS A BUNCH OF UNIT AT ONCE
* IS_HEADER_STR : HEADER TEXT
* IT_FDCAT :
* IT_DATA :
*&-------------------------------------------------------------------&*

    DATA: LV_RC     TYPE I,
          LV_NAME   TYPE DDTEXT,
          LV_LIMIT  TYPE I,
          LV_COUNT  TYPE I,
          LV_APPEND TYPE I,
          LV_BEGIN  TYPE I,
          LV_END    TYPE I,
          LV_COL    TYPE I,
          LV_TOTAL  TYPE I,
          LV_PASTE  TYPE C.

    DATA: LO_DREF     TYPE REF TO DATA,
          LR_TABDESCR TYPE REF TO CL_ABAP_STRUCTDESCR,
          LT_DFIES    TYPE DDFIELDS,
          LS_ROW_DATA TYPE USMD_CHARLINE,
          LT_ROW_DATA TYPE TABLE OF USMD_CHARLINE.

*-- GET COLUMNS INFO
    CREATE DATA LO_DREF LIKE LINE OF IT_DATA[].
    LR_TABDESCR ?= CL_ABAP_STRUCTDESCR=>DESCRIBE_BY_DATA_REF( LO_DREF ).
    LT_DFIES = CL_SALV_DATA_DESCR=>READ_STRUCTDESCR( LR_TABDESCR ).

*---------------------------------------------------------------------*
*-- OPEN EXCEL OLE PROCESS
*---------------------------------------------------------------------*
    DATA: EXCEL    TYPE OLE2_OBJECT,
          BOOKS    TYPE OLE2_OBJECT,
          BOOK     TYPE OLE2_OBJECT,
          CELL     TYPE OLE2_OBJECT,
          FONT     TYPE OLE2_OBJECT,
          INTERIOR TYPE OLE2_OBJECT.

    "엑셀 초기화
    CALL FUNCTION 'FLUSH'
      EXCEPTIONS
        CNTL_SYSTEM_ERROR = 1
        CNTL_ERROR        = 2
        OTHERS            = 3.
    IF SY-SUBRC <> 0.
      MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
                 WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
    ENDIF.

    "엑셀 시작
    CREATE OBJECT EXCEL 'EXCEL.APPLICATION'.
    IF SY-SUBRC <>  0.
      FREE OBJECT EXCEL.
      MESSAGE S000(0K) WITH 'ERROR OPENING EXCEL.APPLICATION' DISPLAY LIKE 'E'.
    ENDIF.

    CALL METHOD OF EXCEL 'WORKBOOKS' = BOOKS.

    CALL METHOD OF BOOKS 'ADD' = BOOK.

*---------------------------------------------------------------------*
*-- MAKE HEADER LINE
*---------------------------------------------------------------------*
    IF IT_EXCLUDE_FIELD[] IS NOT INITIAL.
      SORT IT_EXCLUDE_FIELD BY TABLE_LINE.
    ENDIF.

    LOOP AT LT_DFIES REFERENCE INTO DATA(LS_DFIES).

      READ TABLE IT_EXCLUDE_FIELD WITH KEY TABLE_LINE = LS_DFIES->FIELDNAME TRANSPORTING NO FIELDS.
      IF SY-SUBRC IS INITIAL.
        DELETE LT_DFIES.
        CONTINUE.
      ENDIF.

      ADD 1 TO LV_COL.

      IF IS_HEADER_STR IS INITIAL.
        IF LS_DFIES->REPTEXT IS INITIAL.
          LS_DFIES->REPTEXT = LS_DFIES->FIELDTEXT.
        ENDIF.
        LV_NAME = LS_DFIES->REPTEXT.
      ELSE.
        ASSIGN COMPONENT LS_DFIES->FIELDNAME OF STRUCTURE IS_HEADER_STR TO FIELD-SYMBOL(<FS_NAME>).
        IF <FS_NAME> IS ASSIGNED.
          LV_NAME = <FS_NAME>.
        ENDIF.
      ENDIF.

*-- SET HEADER CELL STYLE & VALUE
      IF LV_NAME IS NOT INITIAL.

        "필드
        CALL METHOD OF EXCEL
            'CELLS' = CELL
            EXPORTING
              #1 = 1
              #2 = LV_COL.

        SET PROPERTY OF CELL 'VALUE'          = LV_NAME.
        GET PROPERTY OF CELL 'INTERIOR'       = INTERIOR.
        SET PROPERTY OF INTERIOR 'COLORINDEX' = 6.
        GET PROPERTY OF CELL 'FONT' = FONT.
        SET PROPERTY OF FONT 'SIZE' = 10.

        CALL METHOD OF CELL 'BORDERAROUND'
          EXPORTING
            #1 = 1
            #2 = 2.
      ENDIF.

      CLEAR LV_NAME.

    ENDLOOP.

    "엑셀 출력
    SET PROPERTY OF EXCEL 'VISIBLE' = 1.

    "엑셀 초기화
    CALL FUNCTION 'FLUSH'
      EXCEPTIONS
        CNTL_SYSTEM_ERROR = 1
        CNTL_ERROR        = 2
        OTHERS            = 3.

    FREE OBJECT: INTERIOR,
                 FONT,
                 CELL,
                 BOOK,
                 BOOKS,
                 EXCEL.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>XXL_UPLOAD
* +-------------------------------------------------------------------------------------------------+
* | [--->] IV_FILENAME                    TYPE        STRING
* | [--->] IV_SHEETNO                     TYPE        INT4 (DEFAULT =1)
* | [--->] IV_START_ROW                   TYPE        INT4 (DEFAULT =2)
* | [--->] IV_SPLIT_ROW                   TYPE        INT4 (DEFAULT =10000)
* | [<---] ET_TAB_CONVERTED_DATA          TYPE        STANDARD TABLE
* | [<-()] RT_RETURN                      TYPE        BAPIRET2_T
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD XXL_UPLOAD.
*&-------------------------------------------------------------------&*
* DESCRIPTION : EXCEL UPLOAD
* DEVELOPER :
* CREATION DATE :
* TECH. SCRIPT :
*&-------------------------------------------------------------------&*
*IV_FILENAME  : 파일경로
*IV_START_ROW : 시작라인 지정
*IV_SPLIT_ROW : 양이 많을 경우, 잘라서 읽어오는 라인 수
*&-------------------------------------------------------------------&*
    DATA: LT_FILE        TYPE FILETABLE,
          LT_DFIES       TYPE DDFIELDS,
          LS_FILE        TYPE LINE OF FILETABLE,
          LV_USER_ACTION TYPE I,
          LV_BEGIN       TYPE I VALUE 1,
          LV_END         TYPE I,
          LV_CONV_ROW    TYPE I,
          LV_SUBRC       TYPE SY-SUBRC,
          LT_ROW         TYPE USMD_T_CHARLINE,
          LT_CELLS       TYPE YPJO_XXL_DW_T,
          LO_SREF        TYPE REF TO DATA,
          LR_DESCR       TYPE REF TO CL_ABAP_STRUCTDESCR.

    FIELD-SYMBOLS <LT_DATA> TYPE STANDARD TABLE.

    DEFINE _PROG.
      CALL FUNCTION 'SAPGUI_PROGRESS_INDICATOR'
       EXPORTING
         PERCENTAGE       = &1
         TEXT             = &2.
    END-OF-DEFINITION.

    CLEAR: MV_ROWNO.  "EXCEL ROW NUMBER

*-- GET FILENAME
    IF IV_FILENAME IS INITIAL.

      CALL METHOD CL_GUI_FRONTEND_SERVICES=>FILE_OPEN_DIALOG
        EXPORTING
          WINDOW_TITLE            = 'SELECT FILE'
*          DEFAULT_EXTENSION       = '*.XLSX,*.XLS'
          FILE_FILTER             = CL_GUI_FRONTEND_SERVICES=>FILETYPE_EXCEL
          MULTISELECTION          = SPACE
        CHANGING
          FILE_TABLE              = LT_FILE
          RC                      = LV_SUBRC
          USER_ACTION             = LV_USER_ACTION
        EXCEPTIONS
          FILE_OPEN_DIALOG_FAILED = 1
          CNTL_ERROR              = 2
          ERROR_NO_GUI            = 3
          NOT_SUPPORTED_BY_GUI    = 4
          OTHERS                  = 5.

      IF SY-SUBRC IS NOT INITIAL.
        EXIT.
      ENDIF.

      IF LV_USER_ACTION = CL_GUI_FRONTEND_SERVICES=>ACTION_CANCEL.
        MESSAGE S161(ALVHT).
        RETURN.
      ENDIF.

      LS_FILE = LT_FILE[ 1 ].

    ELSE.

      LS_FILE-FILENAME = IV_FILENAME.

    ENDIF.

    CHECK LS_FILE-FILENAME IS NOT INITIAL.

*-- SET ROW, COLUMN RANGE
    IF IV_START_ROW > 0.
      LV_BEGIN = IV_START_ROW.
    ENDIF.

*-- GET TABLE DDIC INFO.
    ASSIGN ET_TAB_CONVERTED_DATA TO <LT_DATA>.
    IF <LT_DATA> IS ASSIGNED.
      CREATE DATA LO_SREF LIKE LINE OF <LT_DATA>.
      LR_DESCR ?= CL_ABAP_STRUCTDESCR=>DESCRIBE_BY_DATA_REF( LO_SREF ).
      LT_DFIES  = CL_SALV_DATA_DESCR=>READ_STRUCTDESCR( LR_DESCR ).
    ELSE.
      EXIT.
    ENDIF.

*-- COLUMN COUNT
*    DESCRIBE TABLE LT_DFIES LINES DATA(LV_COL).
    DATA(LV_COL) = LINES( LT_DFIES ).

*-- SET SPLIT ROW
    IF IV_SPLIT_ROW BETWEEN 500 AND 50000.
      LV_END = IV_SPLIT_ROW.
    ELSE.
      LV_END = 50000.
    ENDIF.

    DO.

*-- GET EXCEL ROW DATA
*      DATA LV_FILENAME TYPE STRING.
*      LV_FILENAME = LS_FILE-FILENAME.
      DATA(LV_FILENAME) = CONV STRING( LS_FILE-FILENAME ).

      CLEAR: LT_CELLS, LT_ROW.

      CALL FUNCTION 'Z_CO_XXL_TO_INT'
        EXPORTING
          IV_FILENAME              = LV_FILENAME
          IV_BEGIN_COL             = 1
          IV_BEGIN_ROW             = LV_BEGIN
          IV_END_COL               = LV_COL
          IV_END_ROW               = LV_END
        TABLES
          T_INTERN                 = LT_CELLS
        EXCEPTIONS
          INCONSISTENT_PARAMETERS = 1
          UPLOAD_OLE              = 2
          OTHERS                  = 3.

      IF SY-SUBRC <> 0.
        EXIT.
      ENDIF.

*-- CONVERT TO TARGET INTERNAL TABLE
      IF LT_CELLS IS NOT INITIAL.

        RT_RETURN = ZCL_COC_COMM=>CONVERT_CELL_TO_TABLE(
                                  EXPORTING IT_CELLS = LT_CELLS
                                            IT_DFIES = LT_DFIES
                                  IMPORTING EV_CONV_ROW = LV_CONV_ROW
                                  CHANGING  CT_CONV_TABLE = ET_TAB_CONVERTED_DATA ).
      ENDIF.

      IF ( LV_END - LV_BEGIN ) > LV_CONV_ROW.
        DATA(LV_CNT) = CONV STRING( LINES( ET_TAB_CONVERTED_DATA ) ).
        CONCATENATE LV_CNT ` LINES CONVERTED.` INTO DATA(LV_TEXT).
        _PROG 100 LV_TEXT.
        EXIT.
      ENDIF.

      LV_BEGIN = LV_END + 1.
      LV_END = LV_END + IV_SPLIT_ROW.
      CLEAR LV_CONV_ROW.

    ENDDO.

  ENDMETHOD.  
  
  
* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_KSGRU_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KSGRU                        TYPE        RKSB1-KSGRU
* | [--->] I_KSGRU                        TYPE        RKSB1-KSGRU
* | [<-()] E_DESCRIPT                     TYPE        SETTEXT
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_KSGRU_TEXT.

		CLEAR: EV_SUBRC, E_DESCRIPT.
		
    SELECT SINGLE SETNAME
      FROM SETHEADER
     WHERE SETCLASS = '0101'
       AND SUBCLASS = @I_KOKRS
       AND SETNAME  = @I_KSGRU
      INTO @DATA(LV_SETNAME).

		IF SY-SUBRC = 0.
		
	    SELECT SINGLE DESCRIPT
	      FROM SETHEADERT
	     WHERE SETCLASS = '0101'
	       AND SUBCLASS = @I_KOKRS
	       AND SETNAME  = @I_KSGRU
	       AND LANGU    = @SY-LANGU
	      INTO @E_DESCRIPT.
	      
	  ELSE.
	  	
	  	EV_SUBRC = 4.
	  	
	  ENDIF.

  ENDMETHOD.

  
* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>BACKGROUND_JOB_PROCESS
* +-------------------------------------------------------------------------------------------------+
* | [--->] IV_CPROG                       TYPE        CPROG (DEFAULT =SY-CPROG)
* | [--->] IT_RSPARAMS                    TYPE        TY_RSPARAMS(OPTIONAL)
* | [<-->] CV_JOBNAME                     TYPE        BTCJOB(OPTIONAL)
* | [<-()] RV_SUBRC                       TYPE        SY-SUBRC
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD BACKGROUND_JOB_PROCESS.
*---------------------------------------------------------------------*
*IV_CPROG    : 기본값은 자기 자신 프로그램을 호출
*CV_JOBNAME  : JOBNAME을 지정 안할 경우 'JOB_'+IV_CPROG+'_SY-DATUM SY-UZEIT'로 생성
*IT_RSPARAMS : 프로그램 호출 시 파라미터 값 지정
*---------------------------------------------------------------------*

    DATA: LT_RSPARAMS TYPE TABLE OF RSPARAMS,
          LS_RSPARAMS TYPE RSPARAMS,
          LV_JOBCOUNT TYPE BTCJOBCNT.

    TRY.

        "입력된 파라미터가 없으면 프로그램 화면의 파라미터 값을 읽어온다.
        IF IT_RSPARAMS[] IS INITIAL.
          RV_SUBRC = ZCL_COC_COMM=>GET_PGM_PARAMETER( EXPORTING IV_REPID  = IV_CPROG
                                                      IMPORTING ET_SELTAB = LT_RSPARAMS ).
        ELSE.
          LT_RSPARAMS[] = IT_RSPARAMS[].
        ENDIF.

        IF LT_RSPARAMS[] IS INITIAL.
          RV_SUBRC = 2.
          EXIT.
        ENDIF.

        "JOB NAME이 없을 경우 'JOB_'+IV_CPROG+'_SY-DATUM SY-UZEIT'로 생성
        IF CV_JOBNAME IS INITIAL.
          CV_JOBNAME = 'JOB_' && IV_CPROG && '_' && SY-DATUM && SY-UZEIT.
        ENDIF.

        "JOB 생성
        CALL FUNCTION 'JOB_OPEN'
          EXPORTING
            JOBNAME          = CV_JOBNAME
            SDLSTRTDT        = SY-DATUM
            SDLSTRTTM        = SY-UZEIT
          IMPORTING
            JOBCOUNT         = LV_JOBCOUNT
          EXCEPTIONS
            CANT_CREATE_JOB  = 1
            INVALID_JOB_DATA = 2
            JOBNAME_MISSING  = 3
            OTHERS           = 4.
        IF SY-SUBRC <> 0.
          RV_SUBRC = SY-SUBRC.
          EXIT.
        ENDIF.

        SUBMIT (IV_CPROG) WITH SELECTION-TABLE LT_RSPARAMS
                          USER SY-UNAME
                          VIA JOB CV_JOBNAME
                          NUMBER LV_JOBCOUNT
                          AND RETURN.

        IF SY-SUBRC = 0.

          CALL FUNCTION 'JOB_CLOSE'
            EXPORTING
              JOBCOUNT             = LV_JOBCOUNT
              JOBNAME              = CV_JOBNAME
              STRTIMMED            = ABAP_TRUE
            EXCEPTIONS
              CANT_START_IMMEDIATE = 1
              INVALID_STARTDATE    = 2
              JOBNAME_MISSING      = 3
              JOB_CLOSE_FAILED     = 4
              JOB_NOSTEPS          = 5
              JOB_NOTEX            = 6
              LOCK_FAILED          = 7
              INVALID_TARGET       = 8
              OTHERS               = 9.

          IF SY-SUBRC <> 0.
            RV_SUBRC = SY-SUBRC.
            IF SY-BATCH IS NOT INITIAL.
              "
            ENDIF.
            EXIT.
          ENDIF.

        ENDIF.

      CATCH CX_ROOT INTO MO_ROOT.
        RV_SUBRC = 11.
    ENDTRY.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>BACKGROUND_JOB_PROCESS_STEP
* +-------------------------------------------------------------------------------------------------+
* | [--->] IT_BPJOB_LIST                  TYPE        TY_BP_JOB_STEP_T(OPTIONAL)
* | [<-()] RV_SUBRC                       TYPE        SY-SUBRC
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD BACKGROUND_JOB_PROCESS_STEP.
*---------------------------------------------------------------------*
*IV_CPROG    : 기본값은 자기 자신 프로그램을 호출
*CV_JOBNAME  : JOBNAME을 지정 안할 경우 'JOB_'+IV_CPROG+'_SY-DATUM SY-UZEIT'로 생성
*IT_RSPARAMS : 프로그램 호출 시 파라미터 값 지정
*---------------------------------------------------------------------*
* EX)
*    DATA IT_BPJOB_LIST TYPE ZCL_COC_COMM=>TY_BP_JOB_STEP_T.
*    IT_BPJOB_LIST = VALUE #( BASE IT_BPJOB_LIST ( CPROG = 'ZCOXXX1'
*                                                  T_RSPARAMS = VALUE #( ( SELNAME = 'P_XXX' KIND = 'P' LOW = P_XXX )
*                                                                        ( SELNAME = 'P_YYY' KIND = 'P' LOW = P_YYY ) ) )
*                                                ( CPROG = 'ZCOXXX2'
*                                                  T_RSPARAMS = VALUE #( ( SELNAME = 'P_XXX' KIND = 'P' LOW = P_XXX )
*                                                                        ( SELNAME = 'P_YYY' KIND = 'P' LOW = P_YYY ) ) )
*                                                ( CPROG = 'ZCOXXX3'
*                                                  T_RSPARAMS = VALUE #( ( SELNAME = 'P_XXX' KIND = 'P' LOW = P_XXX )
*                                                                        ( SELNAME = 'P_YYY' KIND = 'P' LOW = P_YYY ) ) ) ).
*    ZCL_COC_COMM=>BACKGROUND_JOB_PROCESS_STEP( IT_BPJOB_LIST ).
*---------------------------------------------------------------------*
    DATA: LT_RSPARAMS          TYPE TABLE OF RSPARAMS,
          LS_RSPARAMS          TYPE RSPARAMS,
          LV_JOBCOUNT          TYPE BTCJOBCNT,
          LV_JOBNAME           TYPE BTCJOB,

          LV_PRED_JOBCOUNT     TYPE BTCJOBCNT,
          LV_PRED_JOBNAME      TYPE BTCJOB,
          LV_PREDJOB_CHECKSTAT TYPE BTCCKSTAT,
          LV_STRTIMMED         TYPE CHAR01 VALUE ABAP_ON.

    TRY.

        "여러 건의 JOB을 순차적으로 SCHEDULING 한다.
        LOOP AT IT_BPJOB_LIST INTO DATA(LS_BPJOB_LIST).

          "입력된 파라미터가 없으면 프로그램 화면의 파라미터 값을 읽어온다.
          IF LS_BPJOB_LIST-T_RSPARAMS IS INITIAL.
            RV_SUBRC = ZCL_COC_COMM=>GET_PGM_PARAMETER( EXPORTING IV_REPID  = LS_BPJOB_LIST-CPROG
                                                        IMPORTING ET_SELTAB = LT_RSPARAMS ).
          ELSE.
            LT_RSPARAMS = LS_BPJOB_LIST-T_RSPARAMS.
          ENDIF.

          IF LT_RSPARAMS IS INITIAL.
            RV_SUBRC = 12.
            EXIT.
          ENDIF.

          "JOB NAME이 없을 경우 'JOB_'+IV_CPROG+'_SY-DATUM SY-UZEIT'로 생성
          IF LS_BPJOB_LIST-JOBNAME IS INITIAL.
            LV_JOBNAME = 'JOB_' && LS_BPJOB_LIST-CPROG && '_' && SY-DATUM && SY-UZEIT.
          ELSE.
          	LV_JOBNAME = LS_BPJOB_LIST-JOBNAME.
          ENDIF.

          "JOB 생성
          CALL FUNCTION 'JOB_OPEN'
            EXPORTING
              JOBNAME          = LV_JOBNAME
              SDLSTRTDT        = SY-DATUM
              SDLSTRTTM        = SY-UZEIT
            IMPORTING
              JOBCOUNT         = LV_JOBCOUNT
            EXCEPTIONS
              CANT_CREATE_JOB  = 1
              INVALID_JOB_DATA = 2
              JOBNAME_MISSING  = 3
              OTHERS           = 4.
          IF SY-SUBRC <> 0.
            RV_SUBRC = SY-SUBRC.
            EXIT.
          ENDIF.

          SUBMIT (LS_BPJOB_LIST-CPROG) WITH SELECTION-TABLE LT_RSPARAMS
                                       USER SY-UNAME
                                       VIA JOB LV_JOBNAME
                                       NUMBER LV_JOBCOUNT
                                       AND RETURN.

          IF SY-SUBRC = 0.

            CALL FUNCTION 'JOB_CLOSE'
              EXPORTING
                JOBCOUNT             = LV_JOBCOUNT
                JOBNAME              = LV_JOBNAME
                STRTIMMED            = LV_STRTIMMED
                PREDJOB_CHECKSTAT    = LV_PREDJOB_CHECKSTAT
                PRED_JOBCOUNT        = LV_PRED_JOBCOUNT
                PRED_JOBNAME         = LV_PRED_JOBNAME
              EXCEPTIONS
                CANT_START_IMMEDIATE = 1
                INVALID_STARTDATE    = 2
                JOBNAME_MISSING      = 3
                JOB_CLOSE_FAILED     = 4
                JOB_NOSTEPS          = 5
                JOB_NOTEX            = 6
                LOCK_FAILED          = 7
                INVALID_TARGET       = 8
                OTHERS               = 9.

            IF SY-SUBRC = 0.
              LV_PRED_JOBCOUNT     = LV_JOBCOUNT.
              LV_PRED_JOBNAME      = LV_JOBNAME.
              LV_STRTIMMED         = SPACE.
              LV_PREDJOB_CHECKSTAT = ABAP_ON.
            ELSE.
              RV_SUBRC = SY-SUBRC.
              IF SY-BATCH IS NOT INITIAL.
                "
              ENDIF.
              EXIT.
            ENDIF.

          ENDIF.

        ENDLOOP.

      CATCH CX_ROOT INTO MO_ROOT.
        RV_SUBRC = 11.
    ENDTRY.


  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>CALC_FORMULA
* +-------------------------------------------------------------------------------------------------+
* | [--->] IV_FORMULA                     TYPE        QEIFFORMEL
* | [--->] IT_DATA                        TYPE        TY_FORMULA_T(OPTIONAL)
* | [<-->] CV_SUBRC                       TYPE        SY-SUBRC(OPTIONAL)
* | [<-()] EV_RESULT                      TYPE        F
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD CALC_FORMULA.

*IV FORMULA : 계산식을 받아온다.
*IT_DATA    : 계산식 중 대체될 변수의 값을 지정한다.
*CV_SUBRC   : 계산식에 에러가 존재할 경우 SUBRC = 4
*EV_RESULT  : 계산식의 결과값을 리턴한다.


    DATA: LV_FORMULA    TYPE QEIFFORMEL,
          LT_PARA_VALUE TYPE QMT_FORM_PARAM_VALUE."ZQMT_FORM_PARAM_VALUE.

    CHECK IV_FORMULA IS NOT INITIAL.

    SPLIT IV_FORMULA AT SPACE INTO TABLE DATA(LT_FORMULA_FIELDS).

    IF IT_DATA IS NOT INITIAL.
      LOOP AT IT_DATA INTO DATA(LS_DATA).
        DATA(LV_INDEX) = CONV NUMC4( SY-TABIX ).
        LT_PARA_VALUE = VALUE #( BASE LT_PARA_VALUE ( MERKNR  = LV_INDEX
                                                      FORMPAR = COND #( WHEN LS_DATA-FIELD <> SPACE THEN 'VV' )
                                                      VALUE   = LS_DATA-VALUE ) ).

        READ TABLE LT_FORMULA_FIELDS ASSIGNING FIELD-SYMBOL(<FS_FORMULA>) WITH KEY TABLE_LINE = LS_DATA-FIELD.
        IF SY-SUBRC = 0.
          <FS_FORMULA> = 'VV' && LV_INDEX.
        ENDIF.
      ENDLOOP.
    ENDIF.

    LOOP AT LT_FORMULA_FIELDS INTO DATA(LS_FORMULA_FIELDS).
      CONCATENATE LV_FORMULA LS_FORMULA_FIELDS INTO LV_FORMULA SEPARATED BY SPACE.
    ENDLOOP.

    CALL FUNCTION 'QET4_EVAL_FORMULA'
      EXPORTING
        IV_FORMULA        = LV_FORMULA
        IT_PARA_VALUE     = LT_PARA_VALUE
      IMPORTING
        EV_RESULT         = EV_RESULT
      EXCEPTIONS
        CALCULATION_ERROR = 1
        OTHERS            = 2.

    IF SY-SUBRC <> 0.
      CV_SUBRC = 4.
    ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>CALL_TRANSACTION
* +-------------------------------------------------------------------------------------------------+
* | [--->] IV_TCODE                       TYPE        TCODE
* | [--->] IV_NEW_SESSION                 TYPE        CHAR01 (DEFAULT ='X')
* | [--->] IV_MODE                        TYPE        CHAR01 (DEFAULT ='N')
* | [--->] IV_UPDATE                      TYPE        CHAR01 (DEFAULT ='A')
* | [--->] IV_UPDATE                      TYPE        CHAR01 (DEFAULT ='A')
* | [--->] IT_BDCDATA                     TYPE        TAB_BDCDATA(OPTIONAL)
* | [--->] IT_PARAMETER_IDS               TYPE        TAB_BDCDATA(OPTIONAL)
* | [<-()] RT_BDCMESSAGES                 TYPE        TAB_BDCMSGCOLL
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD CALL_TRANSACTION.
*---------------------------------------------------------------------*
*IV_TCODE         : T-CODE
*IV_NEW_SESSION   : 새창으로 시작(기본 설정)
*IV_MODE          : BDC MODE
*IV_UPDATE        : UPDATE MODE
*IT_BDCDATA       : BDC 수행 코드
*IT_PARAMETER_IDS : SET PARAMETER 지정
*       ->        IT_BDCDATA OR IT_PARAMETER_IDS 등록.
*---------------------------------------------------------------------*
*EX)
*    DATA(LV_PARA) = VALUE TAB_BDCDATA( ( FNAM = 'BLN' FVAL = '1000000000' )
*                                       ( FNAM = 'BUK' FVAL = 'L000' )
*                                       ( FNAM = 'GJR' FVAL = '2020' ) ).
*    ZCL_COC_COMM=>CALL_TRANSACTION( IV_TCODE         = 'FB03'
*                                    IT_PARAMETER_IDS = LV_PARA ).
*---------------------------------------------------------------------*
* 새 창으로 프로그램 호출 시 CTU_PARAMS 파라미터를 모두 허용하도록 변경
*---------------------------------------------------------------------*

    "여분창이 존재하지 않을 경우, 현재 창으로 호출
    CALL FUNCTION 'RM_FREE_SESSION_CHECK'
      EXCEPTIONS
        NO_FREE_SESSION = 1
        OTHERS          = 2.
    IF SY-SUBRC <> 0.
      IV_NEW_SESSION = SPACE.
    ENDIF.

    IF IV_NEW_SESSION = ABAP_ON.

      MESSAGE S000(0K) WITH 'OPENING.......'.

*      CALL FUNCTION 'CALL_TRANSACTION_FROM_TABLE'
*        STARTING NEW TASK 'DEMO'
*        EXPORTING
*          I_TCODE         = IV_TCODE
*          I_MODE          = IV_MODE
*          I_UPDATE        = IV_UPDATE
*        TABLES
*          T_BDCDATA       = IT_BDCDATA
*          T_BDCMESSAGES   = RT_BDCMESSAGES
*          T_PARAMETER_IDS = IT_PARAMETER_IDS
*        EXCEPTIONS
*          ERROR_FOUND     = 1
*          OTHERS          = 2.
      CALL FUNCTION 'ZCOCCM_CALL_TRANSACTION'
        STARTING NEW TASK 'DEMO'
        EXPORTING
          I_TCODE         = IV_TCODE
          IS_CTU_PARAMS   = IS_CTU_PARAMS
        TABLES
          T_BDCDATA       = IT_BDCDATA
          T_BDCMESSAGES   = RT_BDCMESSAGES
          T_PARAMETER_IDS = IT_PARAMETER_IDS
        EXCEPTIONS
          ERROR_FOUND     = 1
          OTHERS          = 2.

      WAIT UP TO 3 SECONDS.

    ELSE.

      CALL FUNCTION 'CALL_TRANSACTION_FROM_TABLE'
        EXPORTING
          I_TCODE         = IV_TCODE
          I_MODE          = IV_MODE
          I_UPDATE        = IV_UPDATE
        TABLES
          T_BDCDATA       = IT_BDCDATA
          T_BDCMESSAGES   = RT_BDCMESSAGES
          T_PARAMETER_IDS = IT_PARAMETER_IDS
        EXCEPTIONS
          ERROR_FOUND     = 1
          OTHERS          = 2.

    ENDIF.


  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>CONVERSION_EXIT_VALUE
* +-------------------------------------------------------------------------------------------------+
* | [--->] IV_INPUT                       TYPE        ANY
* | [--->] IV_CONVEXIT                    TYPE        CONVEXIT(OPTIONAL)
* | [--->] IV_CONVERT_TYPE                TYPE        CHAR01 (DEFAULT ='I')
* | [--->] IV_DBFIELD                     TYPE        ROLLNAME(OPTIONAL)
* | [<---] EV_OUTPUT                      TYPE        ANY
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD CONVERSION_EXIT_VALUE.

    DATA: LV_FUNCNAME TYPE FUNCNAME,
          LV_TYPE     TYPE STRING.

    CONSTANTS: LC_OUTPUT TYPE STRING VALUE '_OUTPUT',
               LC_INPUT  TYPE STRING VALUE '_INPUT'.

    CHECK IV_INPUT IS NOT INITIAL.

    CASE IV_CONVERT_TYPE.
      WHEN 'I'.
        LV_TYPE = LC_INPUT.
      WHEN 'E'.
        LV_TYPE = LC_OUTPUT.
      WHEN OTHERS.
        EXIT.
    ENDCASE.

    IF IV_CONVEXIT IS NOT INITIAL.     "USE CONV. EXIT

      CONCATENATE 'CONVERSION_EXIT_' IV_CONVEXIT LV_TYPE INTO LV_FUNCNAME.

    ELSEIF IV_DBFIELD IS NOT INITIAL.  "USE VALUE FIELD ELEMENT INFO.

      SELECT SINGLE CONVEXIT INTO @DATA(LV_CONVEXIT)
        FROM DD04L
       WHERE ROLLNAME = @IV_DBFIELD
         AND AS4LOCAL = 'A'.

      IF LV_CONVEXIT IS NOT INITIAL.
        CONCATENATE 'CONVERSION_EXIT_' LV_CONVEXIT LV_TYPE INTO LV_FUNCNAME.
      ENDIF.

    ELSE.                              "USE VALUE OBJECT INFO.

      DATA(LO_STR)  = CL_ABAP_TYPEDESCR=>DESCRIBE_BY_DATA( IV_INPUT ).
      DATA(LT_OBJT) = LO_STR->GET_DDIC_OBJECT( ).
      DATA(LS_OBJT) = LT_OBJT[ 1 ].
      IF LS_OBJT-CONVEXIT IS NOT INITIAL.
        CONCATENATE 'CONVERSION_EXIT_' LS_OBJT-CONVEXIT LV_TYPE INTO LV_FUNCNAME.
      ENDIF.
    ENDIF.

    CHECK LV_FUNCNAME IS NOT INITIAL.

*-- CHECK VALID FUNCTION
    CALL FUNCTION 'OM_FUNC_MODULE_EXIST'
      EXPORTING
        FUNCTION_MODULE = LV_FUNCNAME
      EXCEPTIONS
        NOT_EXISTENT    = 1
        OTHERS          = 2.

    IF SY-SUBRC IS INITIAL.

*-- CALL FUNCTION
      CALL FUNCTION LV_FUNCNAME
        EXPORTING
          INPUT     = IV_INPUT
        IMPORTING
          OUTPUT    = EV_OUTPUT
        EXCEPTIONS
          NOT_FOUND = 1
          OTHER     = 2.
    ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>CONVERT_CELL_TO_TABLE
* +-------------------------------------------------------------------------------------------------+
* | [--->] IT_CELLS                       TYPE        YPJO_XXL_DW_T
* | [--->] IT_DFIES                       TYPE        DDFIELDS
* | [<---] EV_CONV_ROW                    TYPE        INT4
* | [<-->] CT_CONV_TABLE                  TYPE        STANDARD TABLE
* | [<-()] CT_RETURN                      TYPE        BAPIRET2_T
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD CONVERT_CELL_TO_TABLE.

    DATA: LS_DFIES    TYPE DFIES,
          LS_RETURN   TYPE BAPIRET2,
          LO_DREF     TYPE REF TO DATA,
          LO_SREF     TYPE REF TO DATA,
          LR_TABDESCR TYPE REF TO CL_ABAP_STRUCTDESCR.

    FIELD-SYMBOLS: <LT_ITAB> TYPE STANDARD TABLE,
                   <LS_ITAB> TYPE ANY.

*-- ASSIGN TARGET TABLE
    ASSIGN CT_CONV_TABLE[] TO <LT_ITAB>.
    IF <LT_ITAB> IS NOT ASSIGNED.
      EXIT.
    ELSE.
      CREATE DATA LO_SREF LIKE LINE OF <LT_ITAB>.
      ASSIGN LO_SREF->* TO <LS_ITAB>.
    ENDIF.

    DATA(LT_CELLS) = IT_CELLS.

    DATA(LV_TOTAL) = LINES( LT_CELLS ).

    LOOP AT LT_CELLS INTO DATA(LS_CELLS).
      DATA(LV_TABIX) = SY-TABIX.

      AT NEW ROW.
        ADD 1 TO MV_ROWNO.
      ENDAT.

      READ TABLE IT_DFIES INTO LS_DFIES INDEX LS_CELLS-COL.

      ASSIGN COMPONENT LS_DFIES-FIELDNAME OF STRUCTURE <LS_ITAB> TO FIELD-SYMBOL(<LV_VALUE>).

      IF <LV_VALUE> IS ASSIGNED AND LS_CELLS-VALUE IS NOT INITIAL.

        LS_RETURN = ZCL_COC_COMM=>CORRECT_FORMAT_CONVERSION(
                                  EXPORTING IV_SOURCE = LS_CELLS-VALUE
                                            IS_DESC   = LS_DFIES
                                  IMPORTING EV_TARGET = <LV_VALUE> ).

      ENDIF.

      IF LS_RETURN IS NOT INITIAL.
        LS_RETURN-TYPE = 'E'.
        LS_RETURN-ROW  = MV_ROWNO.
        CONCATENATE `| Column No. : ` LS_CELLS-COL ` | Column Value : ` LS_CELLS-VALUE
               INTO LS_RETURN-MESSAGE_V2.

        APPEND LS_RETURN TO CT_RETURN.
        CLEAR LS_RETURN.
      ENDIF.

      AT END OF ROW.

        IF <LS_ITAB> IS NOT INITIAL.

          ZCL_COC_COMM=>SHOW_PROGRESS_PERCENTAGE(
            IV_TOTAL_LINES = LV_TOTAL
            IV_COUNT       = LV_TABIX
            IV_TEXT        = CONV #( `Conversion in progress... ` ) ).

          CALL METHOD ZCL_COC_COMM=>CONVERT_DECIMALS_FOR_CURRENCY
            EXPORTING
              IT_DFIES = IT_DFIES
            CHANGING
              CS_ITEM  = <LS_ITAB>.

          APPEND <LS_ITAB> TO <LT_ITAB>.

        ENDIF.

        CLEAR <LS_ITAB>.

      ENDAT.

      EV_CONV_ROW = LS_CELLS-ROW.
      CLEAR LS_CELLS.

    ENDLOOP.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>CONVERT_DECIMALS_FOR_CURRENCY
* +-------------------------------------------------------------------------------------------------+
* | [--->] IT_DFIES                       TYPE        DDFIELDS
* | [<-->] CS_ITEM                        TYPE        ANY
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD CONVERT_DECIMALS_FOR_CURRENCY.

    STATICS: LT_TAB_DFIES TYPE DDFIELDS,
             LS_CURR      TYPE BAPI1090_1.

    DATA: LS_T001  TYPE T001,
          LS_DFIES TYPE DFIES,
          LV_WAERS TYPE WAERS.

    CONSTANTS LC_CUKY TYPE CHAR4 VALUE 'CUKY'.

*-- 1. CHECK CURRENCY FIELD
    READ TABLE IT_DFIES INTO LS_DFIES WITH KEY DATATYPE = LC_CUKY.
    IF SY-SUBRC IS INITIAL.
      ASSIGN COMPONENT LS_DFIES-FIELDNAME OF STRUCTURE CS_ITEM TO FIELD-SYMBOL(<LV_CUKY>).
      IF <LV_CUKY> IS ASSIGNED.
        LV_WAERS = <LV_CUKY>.
      ENDIF.
      CLEAR LS_DFIES.
    ENDIF.

    LOOP AT IT_DFIES INTO LS_DFIES.

      CASE LS_DFIES-DATATYPE.

*-- 2. CHECK REF. CURRENCY KEY
        WHEN 'CURR'.
          IF LV_WAERS IS INITIAL.
            IF LT_TAB_DFIES IS INITIAL.
              CALL FUNCTION 'LOAN_CHECK_STRUCTURE_INIT'
                EXPORTING
                  I_STRUCTURE_TABNAME   = LS_DFIES-TABNAME
                TABLES
                  IT_DFIES              = LT_TAB_DFIES
                EXCEPTIONS
                  FOREIGN_KEY_NOT_FOUND = 1
                  ERROR_FOUND           = 2
                  OTHERS                = 3.

              SORT LT_TAB_DFIES BY FIELDNAME.

            ENDIF.

            READ TABLE LT_TAB_DFIES INTO DATA(LS_TAB_DFIES) WITH KEY FIELDNAME = LS_DFIES-FIELDNAME BINARY SEARCH.
            IF LS_TAB_DFIES-REFFIELD IS NOT INITIAL.
              ASSIGN COMPONENT LS_TAB_DFIES-REFFIELD OF STRUCTURE CS_ITEM TO FIELD-SYMBOL(<LV_REF_WAERS>).
              IF <LV_REF_WAERS> IS ASSIGNED.
                LV_WAERS = <LV_REF_WAERS>.
              ENDIF.
            ENDIF.
          ENDIF.

*-- 3. COMPANY CODE CURRENCY
          IF LV_WAERS IS INITIAL.
            ASSIGN COMPONENT 'BUKRS' OF STRUCTURE CS_ITEM TO FIELD-SYMBOL(<LV_BUKRS>).
            IF <LV_BUKRS> IS ASSIGNED.
              CALL FUNCTION 'FI_COMPANY_CODE_DATA'
                EXPORTING
                  I_BUKRS      = <LV_BUKRS>
                IMPORTING
                  E_T001       = LS_T001
                EXCEPTIONS
                  SYSTEM_ERROR = 1
                  OTHERS       = 2.

              LV_WAERS = LS_T001-WAERS.
            ENDIF.
          ENDIF.

*-- GET CURRENCY DECIMAL PLACE
          IF LV_WAERS IS INITIAL.
            LS_CURR-CURDECIMALS = 2.
          ELSE.
            IF LV_WAERS <> LS_CURR-CURRENCY.
              LS_CURR-CURRENCY = LV_WAERS.
              SELECT SINGLE CURRDEC
                FROM TCURX
                INTO LS_CURR-CURDECIMALS
               WHERE CURRKEY = LV_WAERS.
              IF SY-SUBRC <> 0.
                LS_CURR-CURDECIMALS = 2.
              ENDIF.
            ENDIF.
          ENDIF.

*-- CONVERT DECIMAL PLACE
          ASSIGN COMPONENT LS_DFIES-FIELDNAME OF STRUCTURE CS_ITEM TO FIELD-SYMBOL(<LV_VALUE>).
          IF <LV_VALUE> IS ASSIGNED.
            DESCRIBE FIELD <LV_VALUE> DECIMALS DATA(LV_DECIMALS).
            LV_DECIMALS = LV_DECIMALS = LS_CURR-CURDECIMALS.
            IF LV_DECIMALS <> 0.
              <LV_VALUE> = <LV_VALUE> / ( 10 ** LV_DECIMALS ).
            ENDIF.
          ENDIF.

      ENDCASE.

      CLEAR LS_DFIES.

    ENDLOOP.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>CONVERT_STR_TO_LINE
* +-------------------------------------------------------------------------------------------------+
* | [--->] IS_STR                         TYPE        ANY
* | [--->] IT_DDFIELDS                    TYPE        DDFIELDS
* | [<-->] CS_ROW_DATA                    TYPE        USMD_CHARLINE
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD CONVERT_STR_TO_LINE.

    DATA: LS_DFIES TYPE DFIES,
          LV_VALUE TYPE TVARV_VAL.

*-- CONVERTING COLUMNS TO LINE
    LOOP AT IT_DDFIELDS INTO LS_DFIES.
      IF SY-TABIX <> 1.
        DATA(LV_TAB) = CL_ABAP_CHAR_UTILITIES=>HORIZONTAL_TAB.
      ENDIF.

      ASSIGN COMPONENT LS_DFIES-FIELDNAME OF STRUCTURE IS_STR TO FIELD-SYMBOL(<FS_VALUE>).
      IF <FS_VALUE> IS ASSIGNED.

        CASE LS_DFIES-INTTYPE.
*          WHEN 'C' OR 'N' OR 'D' OR 'T'.    "CHAR. TYPE
*            IF LS_DFIES-CONVEXIT IS NOT INITIAL.
*              LV_VALUE = <FS_VALUE>.
*            ELSE.
*              LV_VALUE = |="{ <FS_VALUE> }"|. "다운로드 시 코드 등 앞자리 '0' 을 유지하기 위함
*            ENDIF.
*            CONDENSE LV_VALUE.

          WHEN 'C' OR 'D'.    "CHAR. TYPE
            LV_VALUE = <FS_VALUE>.
            CONDENSE LV_VALUE.
          WHEN 'P'.

            CASE LS_DFIES-DATATYPE.
              WHEN 'CURR'.                  "CONVERT CURRENCY AMOUNT
                ASSIGN COMPONENT 'WAERS' OF STRUCTURE IS_STR TO FIELD-SYMBOL(<FS_WAERS>).
                IF <FS_WAERS> IS ASSIGNED.
                  DATA: LV_AMT(20).
                  WRITE <FS_VALUE> TO LV_AMT CURRENCY <FS_WAERS>.
                  IF SY-SUBRC IS INITIAL.
                    LV_VALUE = LV_AMT.
                  ENDIF.
                ELSE.                       "AMOUNT TYPE
                  LV_VALUE = <FS_VALUE>.
                ENDIF.

                IF <FS_VALUE> < 0.          "CONVERT SIGN
                  CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
                    CHANGING
                      VALUE = LV_VALUE.
                ENDIF.

              WHEN 'QUAN'.                  "CONVERT UNIT QTY.

                ASSIGN COMPONENT 'MEINS' OF STRUCTURE IS_STR TO FIELD-SYMBOL(<FS_MEINS>).
                IF <FS_MEINS> IS ASSIGNED.
                  DATA: LV_QTY(20).
                  WRITE <FS_VALUE> TO LV_QTY UNIT <FS_MEINS>.
                  IF SY-SUBRC IS INITIAL.
                    LV_VALUE = LV_QTY.
                  ENDIF.
                ELSE.                       "AMOUNT TYPE
                  LV_VALUE = <FS_VALUE>.
                ENDIF.

                IF <FS_VALUE> < 0.          "CONVERT SIGN
                  CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
                    CHANGING
                      VALUE = LV_VALUE.
                ENDIF.

              WHEN OTHERS.
                LV_VALUE = CONV STRING( <FS_VALUE> ).
            ENDCASE.

            CONDENSE LV_VALUE NO-GAPS.

          WHEN OTHERS.

            LV_VALUE = CONV STRING( <FS_VALUE> ).
            CONDENSE LV_VALUE.

        ENDCASE.

        IF LS_DFIES-CONVEXIT IS NOT INITIAL.   "CONVERSION EXIT
          CALL METHOD ZCL_COC_COMM=>CONVERSION_EXIT_VALUE
            EXPORTING
              IV_INPUT    = LV_VALUE
              IV_CONVEXIT = LS_DFIES-CONVEXIT
            IMPORTING
              EV_OUTPUT   = LV_VALUE.
        ENDIF.

        CS_ROW_DATA = CS_ROW_DATA && LV_TAB && LV_VALUE.

        CLEAR LV_VALUE.

      ENDIF.

      CLEAR LS_DFIES.

    ENDLOOP.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>CONV_ITAB_TO_DATA
* +-------------------------------------------------------------------------------------------------+
* | [--->] IT_ITAB                        TYPE        STANDARD TABLE
* | [--->] IV_WITH                        TYPE        STRING(OPTIONAL)
* | [<-()] RV_VALUE                       TYPE        STRING
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD CONV_ITAB_TO_DATA.

    LOOP AT IT_ITAB ASSIGNING FIELD-SYMBOL(<FS>).
      RV_VALUE = RV_VALUE && IV_WITH && <FS>.
    ENDLOOP.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>CORRECT_FORMAT_CONVERSION
* +-------------------------------------------------------------------------------------------------+
* | [--->] IV_SOURCE                      TYPE        TEXT4096
* | [--->] IS_DESC                        TYPE        DFIES
* | [<---] EV_TARGET                      TYPE        ANY
* | [<-()] RS_RETURN                      TYPE        BAPIRET2
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD CORRECT_FORMAT_CONVERSION.

    DATA: LV_FIELD_TYPE      TYPE C,
          LV_DECIMALS        TYPE I,
          LV_DECIMALS_TARGET TYPE I,
          LV_STRLEN          TYPE I,
          LV_LAST_DECIMAL    TYPE I,
          LV_HLPVZ           TYPE I.

    FIELD-SYMBOLS: <LV_TYPE_X> TYPE TEXT4096.

    CONSTANTS: LC_PTEXT(13)       TYPE C VALUE '1234567890 -+',
               LC_DARL_NUMBER(12) TYPE C VALUE '1234567890 ',
               LC_MINUS(1)        TYPE C VALUE '-',
               LC_NULL(8)         TYPE C VALUE '00:00:00'.

    DEFINE _PERPARE_NUMBER.

      CLEAR SY-SUBRC.
      WHILE SY-SUBRC = 0.

        IF &1 = '.'.
          IF IV_SOURCE CA &1.
            IF SY-FDPOS > LV_LAST_DECIMAL.
              LV_LAST_DECIMAL = SY-FDPOS + 1.
            ENDIF.
          ENDIF.
        ENDIF.

        REPLACE &1 WITH SPACE INTO IV_SOURCE.

      ENDWHILE.

    END-OF-DEFINITION.

    DEFINE _RETURN.
      IF SY-SUBRC IS NOT INITIAL.
        RS_RETURN = VALUE #( TYPE          = &1
                             ID            = &2
                             NUMBER        = &3
                             MESSAGE_V1    = &4
                             MESSAGE_V2    = &5
                             MESSAGE_V3    = &6
                             MESSAGE_V4    = &7 ).
        ENDIF.
    END-OF-DEFINITION.

    CHECK IV_SOURCE IS NOT INITIAL.

    IF IS_DESC IS INITIAL.
      DESCRIBE FIELD EV_TARGET TYPE LV_FIELD_TYPE.
    ELSE.
      LV_FIELD_TYPE = IS_DESC-INTTYPE.
    ENDIF.

    TRY.
        CASE LV_FIELD_TYPE.

*-- CHAR. TYPE
          WHEN 'C'.

            EV_TARGET = IV_SOURCE.
            IF IS_DESC-LOWERCASE EQ SPACE.
              EV_TARGET = |{ EV_TARGET CASE = UPPER }|.
            ENDIF.

*-- DATE TYPE
          WHEN 'D'.

            IV_SOURCE = REPLACE( VAL = IV_SOURCE PCRE = '[./-]' WITH = SPACE OCC = 0 ).
            IF IV_SOURCE = 0.
              IV_SOURCE = '00000000'.
            ENDIF.

            CALL FUNCTION 'CONVERT_DATE_TO_INTERNAL'
              EXPORTING
                DATE_EXTERNAL            = IV_SOURCE
                ACCEPT_INITIAL_DATE      = ABAP_TRUE
              IMPORTING
                DATE_INTERNAL            = EV_TARGET
              EXCEPTIONS
                DATE_EXTERNAL_IS_INVALID = 1
                OTHERS                   = 2.

            _RETURN SY-MSGTY SY-MSGID SY-MSGNO SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.

*-- TIME TYPE
          WHEN 'T'.

            IV_SOURCE = CONV CLNUMC6( |{ REPLACE( VAL = IV_SOURCE SUB = ':' WITH = SPACE OCC = 0 ) ALPHA = IN }| ).

            CALL FUNCTION 'CONVERT_TIME_INPUT'
              EXPORTING
                INPUT                     = IV_SOURCE
              IMPORTING
                OUTPUT                    = EV_TARGET
              EXCEPTIONS
                PLAUSIBILITY_CHECK_FAILED = 1
                WRONG_FORMAT_IN_INPUT     = 2
                OTHERS                    = 3.

            _RETURN SY-MSGTY SY-MSGID SY-MSGNO SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.

*-- TYPE X
          WHEN 'X'.

            ASSIGN IV_SOURCE TO <LV_TYPE_X>.
            IF SY-SUBRC <> 0.
              _RETURN 'E' '0K' '000' 'Numeric Type Error' '' '' ''.
            ENDIF.

            EV_TARGET = <LV_TYPE_X>.

*-- NUMERIC TYPE
          WHEN 'N'.

            REPLACE ALL OCCURRENCES OF '.' IN IV_SOURCE WITH SPACE.
            CONDENSE IV_SOURCE NO-GAPS.
            IF IV_SOURCE CN LC_DARL_NUMBER.
              _RETURN 'E' '0K' '000' 'Numeric Type Error' '' '' ''.
            ELSE.
              EV_TARGET = IV_SOURCE.
            ENDIF.

*-- INTEGER TYPE
          WHEN 'I'.

            DESCRIBE FIELD EV_TARGET DECIMALS LV_DECIMALS_TARGET.

            LV_STRLEN = STRLEN( IV_SOURCE ).
            _PERPARE_NUMBER : '.', ',', ';', '/'.

            IF LV_LAST_DECIMAL IS NOT INITIAL.
              LV_HLPVZ = LV_STRLEN - 1.
              IF IV_SOURCE+LV_HLPVZ(1) = LC_MINUS.
                LV_DECIMALS = LV_STRLEN - LV_LAST_DECIMAL - 1.
              ELSE.
                LV_DECIMALS = LV_STRLEN - LV_LAST_DECIMAL.
              ENDIF.
            ENDIF.

            CONDENSE IV_SOURCE NO-GAPS.

            IF STRLEN( IV_SOURCE ) > IS_DESC-LENG.
              _RETURN 'E' '0K' '000' 'Field length overflow' '' '' ''.
            ELSEIF IV_SOURCE CN LC_DARL_NUMBER.
              _RETURN 'E' '0K' '000' 'Integer Type Error' '' '' ''.
            ELSE.
              LV_DECIMALS_TARGET = LV_DECIMALS_TARGET - LV_DECIMALS.
              EV_TARGET = IV_SOURCE * ( 10 ** ( LV_DECIMALS_TARGET ) ).
            ENDIF.

*-- AMOUNT/QTY TYPE
          WHEN 'P'.

            IF IV_SOURCE(1) = LC_MINUS.
              DATA LV_MINUS TYPE XFELD.
              LV_MINUS = ABAP_TRUE.
              SHIFT IV_SOURCE BY 1 PLACES LEFT.
            ENDIF.

            IF IV_SOURCE EQ ' -'.
              CLEAR IV_SOURCE.
            ENDIF.

            DESCRIBE FIELD EV_TARGET DECIMALS LV_DECIMALS_TARGET.

            LV_STRLEN = STRLEN( IV_SOURCE ).
            _PERPARE_NUMBER : '.', ',', ';', '/'.

            IF LV_LAST_DECIMAL IS NOT INITIAL.
              LV_HLPVZ = LV_STRLEN - 1.
              IF IV_SOURCE+LV_HLPVZ(1) = LC_MINUS.
                LV_DECIMALS = LV_STRLEN - LV_LAST_DECIMAL - 1.
              ELSE.
                LV_DECIMALS = LV_STRLEN - LV_LAST_DECIMAL.
              ENDIF.
            ENDIF.

            CONDENSE IV_SOURCE NO-GAPS.

            IF STRLEN( IV_SOURCE ) > IS_DESC-LENG.
              _RETURN 'E' '0K' '000' 'Field length overflow' '' '' ''.
              RETURN.
            ENDIF.

            DESCRIBE FIELD EV_TARGET LENGTH DATA(LV_LEN_TARGET) IN BYTE MODE.
            LV_LEN_TARGET = ( LV_LEN_TARGET * 2 ) - 1.
            DATA(LV_LEN_SOURCE) = STRLEN( IV_SOURCE ).
            IF LV_LEN_SOURCE > LV_LEN_TARGET.
              LV_DECIMALS_TARGET = LV_DECIMALS_TARGET - LV_LEN_TARGET + LV_LEN_SOURCE.
              IV_SOURCE = IV_SOURCE(LV_LEN_TARGET).
            ENDIF.

            IF IV_SOURCE CN LC_PTEXT.
              CASE IS_DESC-DATATYPE.
                WHEN 'CURR'. _RETURN 'E' '0K' '000' 'Currency Type Error' '' '' ''.
                WHEN 'QUAN'. _RETURN 'E' '0K' '000' 'Quantity Type Error' '' '' ''.
                WHEN OTHERS. _RETURN 'E' '0K' '000' 'Only Number can be input' '' '' ''.
              ENDCASE.
            ELSE.
              EV_TARGET = IV_SOURCE / ( 10 ** ( LV_DECIMALS_TARGET ) ).

              LV_DECIMALS_TARGET = LV_DECIMALS_TARGET - LV_DECIMALS.
              EV_TARGET = EV_TARGET * ( 10 ** ( LV_DECIMALS_TARGET ) ).
            ENDIF.

            IF LV_MINUS IS NOT INITIAL.
              EV_TARGET = EV_TARGET * -1.
            ENDIF.

*-- FLIP TYPE
          WHEN 'F'.

            CALL FUNCTION 'CHAR_FLTP_CONVERSION'
              EXPORTING
                STRING             = IV_SOURCE
              IMPORTING
                FLSTR              = EV_TARGET
              EXCEPTIONS
                EXPONENT_TOO_BIG   = 1
                EXPONENT_TOO_SMALL = 2
                STRING_NOT_FLTP    = 3
                TOO_MANY_DECIM     = 4
                OTHERS             = 5.

            _RETURN SY-MSGTY SY-MSGID SY-MSGNO SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.

        ENDCASE.

        IF RS_RETURN IS INITIAL AND STRLEN( IV_SOURCE ) > IS_DESC-LENG.
*              WRITE 'ERROR'.
*              _RETURN 'E' '0K' '000' 'FIELD LENGTH OVERFLOW' '' '' ''.
        ENDIF.

*-- DYNAMIC CONVERSION EXIT
        IF IS_DESC-CONVEXIT IS NOT INITIAL AND RS_RETURN IS INITIAL.

          CALL METHOD ZCL_COC_COMM=>CONVERSION_EXIT_VALUE
            EXPORTING
              IV_INPUT        = EV_TARGET
              IV_CONVEXIT     = IS_DESC-CONVEXIT
              IV_CONVERT_TYPE = 'I'
            IMPORTING
              EV_OUTPUT       = EV_TARGET.

        ENDIF.

      CATCH CX_ROOT INTO MO_ROOT.
        DATA(LS_RETURN) = ZCL_COC_COMM=>MESSAGE_HEADLING( MO_ROOT->GET_TEXT( ) ).
        RS_RETURN = VALUE #( BASE RS_RETURN
                                  MESSAGE_V1 = LS_RETURN-MESSAGE_V1
                                  MESSAGE_V2 = LS_RETURN-MESSAGE_V2
                                  MESSAGE_V3 = LS_RETURN-MESSAGE_V3
                                  MESSAGE_V4 = LS_RETURN-MESSAGE_V4 ).
    ENDTRY.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>CREATE_TOP_OF_PAGE
* +-------------------------------------------------------------------------------------------------+
* | [--->] IO_PARENTS                     TYPE REF TO CL_GUI_CONTAINER
* | [--->] IO_DOCU                        TYPE REF TO CL_DD_DOCUMENT
* | [--->] IV_REPID                       TYPE        REPID (DEFAULT =SY-CPROG)
* | [--->] IT_EXCLU                       TYPE        MGV_LAMA_RSLDBSELOP_TT(OPTIONAL)
* | [--->] IT_INCLU                       TYPE        TY_HEADINFO_T(OPTIONAL)
* | [--->] IV_CONV                        TYPE        CHAR(OPTIONAL)
* | [<-->] CO_SPLITTER                    TYPE REF TO CL_GUI_SPLITTER_CONTAINER
* | [<-()] RV_SUBRC                       TYPE        SUBRC
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD CREATE_TOP_OF_PAGE.
*----------------------------------------------------------------------*
* DESCRIPTION      : TOP OF PAGE 자동 생성
* TECH. SCRIPT     : SCREEN 1000의 값을 읽어서 TOP OF PAGE를 자동 생성 한다.
*----------------------------------------------------------------------*
* IO_PARENTS  -> 상위 CONTAINTER
* IO_DOCU     -> CL_DD_DOCUMENT
* CO_SPLITTER -> CL_GUI_SPLITTER_CONTAINER
* IV_REPID    -> 프로그램 명
* IT_EXCLU    -> 라인을 삭제하고 싶을 경우, 변수명을 넣어준다.
*    DATA(LT_EXCLU) = VALUE MGV_LAMA_RSLDBSELOP_TT( NAME = 'P_PATH' ) ).
* IT_INCLU    -> 라인을 추가하고 싶을 경우, 라인을 추가 해 준다.
*    DATA LT_INCLU TYPE ZCL_COC_COMM=>TY_HEADINFO_T.
*    LT_INCLU = VALUE #( ( ICON = ICON_LED_INACTIVE
*                          SEQ  = 1 "라인을 안 넣을 경우 마지막으로 등록 됨.
*                          PARA = 'TEST PARA'
*                          VALU = 'TEST VALUE'
*                          TEXT = 'TEST TEXT' ) ).
*----------------------------------------------------------------------*

    DATA: LS_INFO    TYPE TY_HEADINFO_S,
          LT_INFO    LIKE TABLE OF LS_INFO,
          LS_INCL    TYPE TY_HEADINFO_S,
          LT_INCL    LIKE TABLE OF LS_INCL,
          LV_LENG    TYPE DDLENG,
          LS_SELTEXT TYPE TEXTPOOL,
          LT_SELTEXT LIKE TABLE OF LS_SELTEXT,
          LS_SELTAB  TYPE RSPARAMS,
          LT_SELTAB  LIKE TABLE OF LS_SELTAB,
          LS_SELINFO TYPE RSEL_INFO,
          LT_SELINFO LIKE TABLE OF LS_SELINFO,
          LS_EXCLU   TYPE RSLDBSELOP,
          LT_EXCLU   LIKE TABLE OF LS_EXCLU,
          LV_SUBRC   TYPE I,
          LV_TABIX   TYPE SY-TABIX,
          LV_CONVEXIT TYPE DD04L-CONVEXIT,
          LV_DATATYPE TYPE DD04L-DATATYPE,
          LV_DATUM    TYPE DATUM.

    IF IV_REPID IS INITIAL.
      RV_SUBRC = 1. RETURN.
    ENDIF.

    IF IO_DOCU IS INITIAL.
      RV_SUBRC = 2. RETURN.
    ENDIF.

    IF IO_PARENTS IS INITIAL.
      RV_SUBRC = 3. RETURN.
    ENDIF.

    LT_EXCLU = IT_EXCLU.
    LT_INCL  = IT_INCLU.

    TRY.

        "1. GET PARAMETER INFO
        LV_SUBRC = ZCL_COC_COMM=>GET_PGM_PARAMETER( IMPORTING ET_SELINFO = LT_SELINFO
                                                              ET_SELTAB  = LT_SELTAB
                                                              ET_SELTEXT = LT_SELTEXT ).

        IF LV_SUBRC <> 0.
          RV_SUBRC = LV_SUBRC.
          RETURN.
        ENDIF.

        "2. MAKE HEADER INFO
        SORT LT_SELTEXT BY KEY.
        SORT LT_EXCLU   BY NAME.
        SORT LT_SELTAB  BY SELNAME.

        LOOP AT LT_SELINFO INTO LS_SELINFO.

          CLEAR: LS_INFO,
                 LS_EXCLU.

          "CHECK EXCLUDING PARAMETER
          READ TABLE LT_EXCLU INTO LS_EXCLU WITH KEY NAME = LS_SELINFO-NAME
                                                     BINARY SEARCH.
          IF SY-SUBRC = 0.
            CONTINUE.
          ENDIF.

          "PARAMETER TEXT
          CLEAR: LS_SELTEXT.
          READ TABLE LT_SELTEXT INTO LS_SELTEXT WITH KEY KEY = LS_SELINFO-NAME
                                                         BINARY SEARCH.
          IF SY-SUBRC = 0.
            LS_INFO-PARA = LS_SELTEXT-ENTRY.
          ELSE.
            CONTINUE.
          ENDIF.

          "PARAMETER VALUE
          CLEAR: LS_SELTAB.
          READ TABLE LT_SELTAB INTO LS_SELTAB  WITH KEY SELNAME = LS_SELINFO-NAME
                                                        BINARY SEARCH.
          IF SY-SUBRC = 0.
            FIND ALL OCCURRENCES OF '-' IN LS_SELINFO-DBFIELD
                                           MATCH OFFSET DATA(LV_MOFF)
                                           MATCH LENGTH DATA(LV_MLEN).
            IF SY-SUBRC = 0.
              DATA(LV_LEN) = LV_MOFF + LV_MLEN.

              SELECT SINGLE ROLLNAME, LENG
                INTO (@LS_SELINFO-DBFIELD, @LV_LENG)
                FROM DD03L
               WHERE TABNAME   = @LS_SELINFO-DBFIELD(LV_MOFF)
                 AND FIELDNAME = @LS_SELINFO-DBFIELD+LV_LEN
                 AND AS4LOCAL  = 'A'.
            ENDIF.

						"CONVEXIT
						CLEAR: LV_CONVEXIT, LV_DATATYPE.
						IF IV_CONV = ABAP_ON AND LS_SELINFO-DBFIELD IS NOT INITIAL.
						  SELECT SINGLE CONVEXIT, DATATYPE
						    FROM DD04L
						   WHERE ROLLNAME = @LS_SELINFO-DBFIELD
						     AND AS4LOCAL = 'A'
						    INTO (@LV_CONVEXIT, @LV_DATATYPE).
						ENDIF.
						
						
            IF   LS_SELTAB-KIND   = 'P' OR
               ( LS_SELTAB-KIND   = 'S' AND LS_SELTAB-OPTION = 'EQ' ).

              "CONVEXIT
              IF LV_DATATYPE = 'DATS'.
                LV_DATUM = LS_SELTAB-LOW.
                WRITE LV_DATUM TO LS_SELTAB-LOW.
              ENDIF.
              
              IF LV_CONVEXIT IS NOT INITIAL.
                ZCL_COC_COMM=>CONVERSION_EXIT_VALUE( EXPORTING IV_INPUT        = LS_SELTAB-LOW
                                                               IV_CONVEXIT     = LV_CONVEXIT
                                                               IV_CONVERT_TYPE = 'E'
                                                     IMPORTING EV_OUTPUT       = LS_SELTAB-LOW ). 
							ENDIF.
							                                                     
                                                     
              LS_INFO-VALU = LS_SELTAB-LOW.

              DATA(LV_TOT) = REDUCE I( INIT S = 0 FOR <TOT> IN LT_SELTAB
                                                  NEXT S = S + COND #( WHEN <TOT>-SELNAME = LS_SELINFO-NAME THEN 1 ) ).

              IF LV_TOT > 1.
                LS_INFO-VALU = LS_INFO-VALU && '...'.
              ENDIF.

            ELSEIF LS_SELTAB-KIND   = 'S' AND
                   LS_SELTAB-OPTION = 'BT'.

							"CONVEXIT
							IF LV_DATATYPE = 'DATS'.
                LV_DATUM = LS_SELTAB-LOW.
                WRITE LV_DATUM TO LS_SELTAB-LOW.
							
                LV_DATUM = LS_SELTAB-HIGH.
                WRITE LV_DATUM TO LS_SELTAB-HIGH.
							ENDIF.

              IF LV_CONVEXIT IS NOT INITIAL.
                ZCL_COC_COMM=>CONVERSION_EXIT_VALUE( EXPORTING IV_INPUT        = LS_SELTAB-LOW
                                                               IV_CONVEXIT     = LV_CONVEXIT
                                                               IV_CONVERT_TYPE = 'E'
                                                     IMPORTING EV_OUTPUT       = LS_SELTAB-LOW ). 

                ZCL_COC_COMM=>CONVERSION_EXIT_VALUE( EXPORTING IV_INPUT        = LS_SELTAB-HIGH
                                                               IV_CONVEXIT     = LV_CONVEXIT
                                                               IV_CONVERT_TYPE = 'E'
                                                     IMPORTING EV_OUTPUT       = LS_SELTAB-HIGH ). 
							ENDIF.

              LS_INFO-VALU = LS_SELTAB-LOW && '~' && LS_SELTAB-HIGH.
              
              LV_TOT = REDUCE I( INIT S = 0 FOR <TOT> IN LT_SELTAB
                                            NEXT S = S + COND #( WHEN <TOT>-SELNAME = LS_SELINFO-NAME THEN 1 ) ).
                                            
              IF LV_TOT > 1.
              	LS_INFO-VALU = LS_INFO-VALU && '....'.
              ENDIF.

            ENDIF.

            IF LS_INFO-VALU IS INITIAL.
              CONTINUE.
            ENDIF.

          ELSE.
            CONTINUE.
          ENDIF.

          "PARAMETER TEXT
          LS_INFO-TEXT = CONV #( ZCL_COC_COMM=>GET_TEXT_ELEMENT( IV_FIELD = CONV #( LS_SELINFO-NAME+2(6) )
                                                                 IV_VALUE = LS_INFO-VALU ) ).

          "SET HEADER INDEX
          ADD 1 TO LV_TABIX.
          LS_INFO-SEQ = LV_TABIX.

          APPEND LS_INFO TO LT_INFO.

        ENDLOOP.

        "INDLUDE DATE
        IF LT_INCL IS NOT INITIAL.

          LOOP AT LT_INCL INTO LS_INCL.
            IF LS_INCL-SEQ IS INITIAL.
              LS_INCL-SEQ = LINES( LT_INFO ) + 1.
              APPEND LS_INCL TO LT_INFO.
            ELSE.
              INSERT LS_INCL INTO LT_INFO INDEX LS_INCL-SEQ.
            ENDIF.
          ENDLOOP.
        ENDIF.

        "TOP SPLITTER SET HEIGHT.
        IF CO_SPLITTER IS BOUND.
          DATA(LV_LINE_CNT) = LINES( LT_INFO ) * 2 + 3.
          CO_SPLITTER->SET_ROW_HEIGHT( ID = 1 HEIGHT = LV_LINE_CNT ) .
        ENDIF.

        "DISPLAY HEADER WITH CREATION BOX INFO
        CLEAR LV_SUBRC.
        LV_SUBRC = ZCL_COC_COMM=>MAKE_TOP_OF_PAGE( IO_DOCU    = IO_DOCU
                                                   IO_PARENTS = IO_PARENTS
                                                   IT_INFO    = LT_INFO ).

        IF LV_SUBRC <> 0.
          RV_SUBRC = LV_SUBRC.
          RETURN.
        ENDIF.

      CATCH CX_ROOT INTO MO_ROOT.
        RV_SUBRC = 8.
        RETURN.

    ENDTRY.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>DYNAMIC_SQL
* +-------------------------------------------------------------------------------------------------+
* | [--->] IV_SOURCE_TAB                  TYPE        STRING
* | [--->] IV_SQL_FIELDS                  TYPE        STRING
* | [--->] IV_SQL_COND                    TYPE        STRING(OPTIONAL)
* | [--->] IV_SQL_GROUPBY                 TYPE        STRING(OPTIONAL)
* | [--->] IV_SQL_HAVING                  TYPE        STRING(OPTIONAL)
* | [<---] ET_DATA                        TYPE        STANDARD TABLE
* | [<-()] RV_SUBRC                       TYPE        SY-SUBRC
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD DYNAMIC_SQL.

    DATA: LT_ADBC_FIELD TYPE TABLE OF ADBC_NAME.

*---------------------------------------------------------------------*
* MAKE SQL
*---------------------------------------------------------------------*
		DATA(LV_SQL) = |SELECT { IV_SQL_FIELDS } | &&
		               |  FROM { IV_SOURCE_TAB } | &&
		               | WHERE { IV_SQL_COND }   | &&
		               |{ COND #( WHEN IV_SQL_GROUPBY IS INITIAL THEN ` ` ELSE ` GROUP BY ` && IV_SQL_GROUPBY ) && IV_SQL_HAVING }|.

*---------------------------------------------------------------------*
* EXECUTE SQL
*---------------------------------------------------------------------*
    TRY.

        "OPEN A CONNECTION TO A DATABASE
        DATA(LR_CONECT) = CL_SQL_CONNECTION=>GET_CONNECTION( ).
        
        "EXECUTE SQL QUERY
        DATA(LR_STATMT) = NEW CL_SQL_STATEMENT( CON_REF = LR_CONECT ).
        DATA(LR_RESULT) = LR_STATMT->EXECUTE_QUERY( LV_SQL ).

        "GET RESULT COLUMN NAME
        DATA(LT_MATA) = LR_RESULT->GET_METADATA( ).
        IF SY-SUBRC IS INITIAL.
          LOOP AT LT_MATA ASSIGNING FIELD-SYMBOL(<LS_MATA>).
            APPEND <LS_MATA>-COLUMN_NAME TO LT_ADBC_FIELD.
          ENDLOOP.
        ENDIF.

        "ASSIGN RESULT DATA TO OUTPUT TABLE
        LR_RESULT->SET_PARAM_TABLE( ITAB_REF = REF #( ET_DATA ) CORRESPONDING_FIELDS = LT_ADBC_FIELD ).

        "READ NEXT SET OF DATA RECORDS INTO THE INTERNAL TABLE
        LR_RESULT->NEXT_PACKAGE( ).

        LR_RESULT->CLOSE( ).
        LR_CONECT->CLOSE( ).

      CATCH CX_SQL_EXCEPTION INTO DATA(LO_ROOT).
        RV_SUBRC = 4.
        MESSAGE LO_ROOT->GET_TEXT( ) TYPE 'E'.

    ENDTRY.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>FILE_SAVE_DIALOG
* +-------------------------------------------------------------------------------------------------+
* | [--->] IV_FILENAME                    TYPE        STRING
* | [--->] IV_FILE_FILTER                 TYPE        STRING(OPTIONAL)
* | [--->] IV_INITIAL_DIRECTORY           TYPE        STRING(OPTIONAL)
* | [<-()] RV_FULLPATH                    TYPE        STRING
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD FILE_SAVE_DIALOG.

    DATA: LV_TITLE       TYPE STRING,
          LV_LOC_FN      TYPE STRING,
          LV_LOC_DIR     TYPE STRING,
          LV_USER_ACTION TYPE I,
          LV_SUBRC       TYPE SY-SUBRC.

    DATA LV_MASK TYPE CHAR255.

*-- SET FIELD FILTER
    IF IV_FILE_FILTER IS INITIAL.
      DATA(LT_XML_CHOICE) = CL_SALV_EXPORT_XML_DIALOG=>GET_GUI_SPREADSHEET_FORMATS( ).
      DATA(LS_XML_CHOICE) = LT_XML_CHOICE[ XML_TYPE = '10' ].

      CALL METHOD CL_ALV_BDS=>CREATE_MASK_FOR_FILEFILTER
        EXPORTING
          I_FRONTEND          = LS_XML_CHOICE-FRONTEND
        IMPORTING
          E_DEFAULT_EXTENSION = DATA(LV_DEFAULT_EXTENSION)
        CHANGING
          C_MASK              = LV_MASK.

      IV_FILE_FILTER = LV_MASK.
    ENDIF.

*-- OPEN FILE SELECT DIALOG
    CALL METHOD CL_GUI_FRONTEND_SERVICES=>FILE_SAVE_DIALOG
      EXPORTING
        WINDOW_TITLE         = LV_TITLE
        DEFAULT_EXTENSION    = LV_DEFAULT_EXTENSION
        DEFAULT_FILE_NAME    = IV_FILENAME
        FILE_FILTER          = IV_FILE_FILTER
        INITIAL_DIRECTORY    = IV_INITIAL_DIRECTORY
      CHANGING
        FILENAME             = LV_LOC_FN
        PATH                 = LV_LOC_DIR
        FULLPATH             = RV_FULLPATH
        USER_ACTION          = LV_USER_ACTION
      EXCEPTIONS
        CNTL_ERROR           = 1
        ERROR_NO_GUI         = 2
        NOT_SUPPORTED_BY_GUI = 3
        OTHERS               = 4.

    IF SY-SUBRC IS NOT INITIAL.
      MESSAGE E162(ALVHT).
      EXIT.
    ENDIF.

    IF LV_USER_ACTION = CL_GUI_FRONTEND_SERVICES=>ACTION_CANCEL.
      MESSAGE S161(ALVHT).
      EXIT.
    ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_BUKRS_FROM_KOKRS
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_BUKRS                        TYPE        BUKRS
* | [<-()] E_BTEXT                        TYPE        BUTXT
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_BUKRS_FROM_KOKRS.

    CHECK IV_KOKRS IS NOT INITIAL.
    
    "회사코드 = 관리회계영역과 1:1
    SELECT SINGLE BUKRS
      FROM TKA02
      INTO RV_BUKRS
     WHERE KOKRS = IV_KOKRS.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_BUKRS_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_BUKRS                        TYPE        BUKRS
* | [<-()] E_BTEXT                        TYPE        BUTXT
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_BUKRS_TEXT.

    CHECK I_BUKRS IS NOT INITIAL.
    SELECT SINGLE BUTXT
      INTO E_BTEXT
      FROM T001
     WHERE BUKRS = I_BUKRS.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_CURTP_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_CURTP                        TYPE        FINS_CURTYPE
* | [<-()] E_NAME                         TYPE        FINS_CURTYPET
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_CURTP_TEXT.

    CHECK I_CURTP IS NOT INITIAL.
    SELECT SINGLE NAME
      INTO E_NAME
      FROM FINSC_CURTYPET
     WHERE LANGU   = SY-LANGU
       AND CURTYPE = I_CURTP.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_DOMAIN_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_DOMNAME                      TYPE        DD07L-DOMNAME
* | [--->] I_DOMVALUE                     TYPE        ANY
* | [--->] I_DOMVALUE                     TYPE        ANY
* | [<-()] E_DDTEXT                       TYPE        DDTEXT
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_DOMAIN_TEXT.

		CLEAR: EV_SUBRC, RV_DDTEXT.
		
    SELECT SINGLE DOMVALUE_L
      FROM DD07L
     WHERE DOMNAME    = @IV_DOMNAME
       AND AS4LOCAL   = 'A'
       AND DOMVALUE_L = @IV_DOMVALUE
      INTO @DATA(LV_DOMNAME).
      
    IF SY-SUBRC = 0.
    	
	    SELECT SINGLE DDTEXT
	      FROM DD07T
	     WHERE DOMNAME    = @IV_DOMNAME
	       AND AS4LOCAL   = 'A'
	       AND DDLANGUAGE = @SY-LANGU
	       AND DOMVALUE_L = @IV_DOMVALUE
	      INTO @RV_DDTEXT.

		ELSE.
		
			EV_SUBRC = 4.
			
		ENDIF.
		
		
  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_DYNP_VALUE
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_FIELD                        TYPE        DYNPREAD-FIELDNAME
* | [--->] I_REPID                        TYPE        SYST-REPI2 (DEFAULT =SY-CPROG)
* | [--->] I_DYNNR                        TYPE        SYST-DYNNR (DEFAULT =SY-DYNNR)
* | [<-()] E_VALUE                        TYPE        DYNPREAD-FIELDVALUE
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_DYNP_VALUE.

    DATA(LV_FIELD) = I_FIELD.
    DATA(LV_REPID) = I_REPID.
    DATA(LV_DYNNR) = I_DYNNR.

    IF I_FIELD IS INITIAL.
      MESSAGE E000(0K) WITH 'Fill Out Required parameter field' '(I_FIELD)'.
      RETURN.
    ENDIF.

    TRY.

        CALL FUNCTION 'GET_DYNP_VALUE'
          EXPORTING
            I_FIELD = LV_FIELD
            I_REPID = LV_REPID
            I_DYNNR = LV_DYNNR
          CHANGING
            O_VALUE = E_VALUE.

        IF E_VALUE IS INITIAL AND
           LV_REPID NE '1000'.

          "화면번호가 '1000'이 아닌 경우,
          "EXTENSION 기능으로 인해 값을 못 가져올 가능성이 있어
          "화면번호 '1000'을 다시 한번 조회

          DATA: LS_DYNPREAD TYPE DYNPREAD,
                LT_DYNPREAD TYPE TABLE OF DYNPREAD.

          LT_DYNPREAD = VALUE #( ( FIELDNAME = I_FIELD ) ).

          CALL FUNCTION 'DYNP_VALUES_READ'
            EXPORTING
              DYNAME               = LV_REPID
              DYNUMB               = '1000'
            TABLES
              DYNPFIELDS           = LT_DYNPREAD
            EXCEPTIONS
              INVALID_ABAPWORKAREA = 1
              INVALID_DYNPROFIELD  = 2
              INVALID_DYNPRONAME   = 3
              INVALID_DYNPRONUMMER = 4
              INVALID_REQUEST      = 5
              NO_FIELDDESCRIPTION  = 6
              INVALID_PARAMETER    = 7
              UNDEFIND_ERROR       = 8
              DOUBLE_CONVERSION    = 9
              STEPL_NOT_FOUND      = 10
              OTHERS               = 11.
          IF LT_DYNPREAD IS NOT INITIAL.

            READ TABLE LT_DYNPREAD INTO LS_DYNPREAD INDEX 1.
            E_VALUE = LS_DYNPREAD-FIELDVALUE.

          ENDIF.

        ENDIF.

      CATCH CX_ROOT INTO DATA(LX_ROOT).

        DATA(LV_ERROR_TEXT) = LX_ROOT->GET_TEXT( ).
        MESSAGE E000(0K) WITH LV_ERROR_TEXT.

    ENDTRY.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_ELEHK_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_ELEHK                        TYPE        CK_ELESMHK
* | [<-()] E_TXT                          TYPE        CK_TXSCH
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_ELEHK_TEXT.

    CHECK I_ELEHK IS NOT INITIAL.

    SELECT SINGLE TXSCH
      INTO E_TXT
      FROM TCKH5
     WHERE SPRAS = SY-LANGU
       AND ELEHK = I_ELEHK.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_ERKRS_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_ERKRS                        TYPE        ERKRS
* | [<-()] E_TEXT                         TYPE        ERKRS_BZ
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_ERKRS_TEXT.

    SELECT SINGLE ERKRS_BZ
      INTO E_TEXT
      FROM TKEBT
     WHERE SPRAS = SY-LANGU
       AND ERKRS = I_ERKRS.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_FUNC_AREA
* +-------------------------------------------------------------------------------------------------+
* | [--->] IV_KOKRS                       TYPE        KOKRS(OPTIONAL)
* | [<-()] RV_SETID                       TYPE        SETID
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_FUNC_AREA.

    CHECK IV_KOSAR IS NOT INITIAL.

		SELECT SINGLE KOSAR, FUNC_AREA
		  FROM TKA05
		  INTO @DATA(LS_TKA05)
		 WHERE KOSAR = @IV_KOSAR.
		 
		"기능영역은 코스트센터 범주에 의해 결정
		IF SY-SUBRC = 0.
		  RV_FKBER = LS_TKA05-FUNC_AREA.
		ENDIF.
	
  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_HIERARCHY_GROUP_CODE
* +-------------------------------------------------------------------------------------------------+
* | [--->] IV_KOKRS                       TYPE        KOKRS(OPTIONAL)
* | [--->] IV_SETCLASS                    TYPE        SETCLASS
* | [--->] IV_GROUP_CODE                  TYPE        ANY
* | [<-()] RV_SETID                       TYPE        SETID
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_HIERARCHY_GROUP_CODE.

    CHECK IV_GROUP_CODE IS NOT INITIAL.

    CALL FUNCTION 'G_SET_ENCRYPT_SETID'
      EXPORTING
        SETCLASS             = IV_SETCLASS
        SHORTNAME            = CONV SETID( IV_GROUP_CODE )
        KOKRS                = IV_KOKRS
      IMPORTING
        SETID                = RV_SETID
      EXCEPTIONS
        NO_CO_AREA_SPECIFIED = 1
        ILLEGAL_SETCLASS     = 2
        OTHERS               = 3.
  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_HIERARCHY_GROUP_LIST
* +-------------------------------------------------------------------------------------------------+
* | [--->] IV_KOKRS                       TYPE        KOKRS(OPTIONAL)
* | [--->] IV_SETCLASS                    TYPE        SETCLASS(OPTIONAL)
* | [--->] IV_SETID                       TYPE        SETID(OPTIONAL)
* | [--->] IV_GROUP_CODE                  TYPE        ANY(OPTIONAL)
* | [<---] ET_RANGE                       TYPE        STANDARD TABLE
* | [<---] ET_NODES                       TYPE        GSETH_NODE_TAB
* | [<---] ET_VALUES                       TYPE       GSETH_VAL_TAB
* | [<-()] RT_RANGEVALUE                  TYPE        DRF_T_SELOPT
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_HIERARCHY_GROUP_LIST.
*---------------------------------------------------------------------*
* IV_SETID OR IV_GROUP_CODE 둘중에 하나만 입력하면 된다.
*---------------------------------------------------------------------*
* EX) ZCL_COC_COMM=>GET_HIERARCHY_GOUP_LIST( EXPORTING IV_SETCLASS   = '0109'
*                                                      IV SETID      = '0109SK00TEST_001'
*                                                      IV_GROUP_CODE = 'TEST_001'
*                                            IMPORTING ET_RANGE = LT_RACCT
*                                                      ET_NODES = LT_NODES
*                                                      ET_VALUES = LT_VALUES ).
*---------------------------------------------------------------------*

    DATA: LV_SETID     TYPE SETHIER-SETID,
          LV_INFO      TYPE GRPHINFO,
          LV_OVERWRITE TYPE SY-DATAR,
          LT_NODES     TYPE GSETH_NODE_TAB,
          LT_VALUES    TYPE GSETH_VAL_TAB,
          LS_RANGE     TYPE RSDSSELOPT,
          LT_D_VALUES  TYPE TABLE OF SETVALUES,
          LO_DREF      TYPE REF TO DATA,
          LO_SREF      TYPE REF TO DATA.

    FIELD-SYMBOLS <LT_RANGE> TYPE STANDARD TABLE.

    CONSTANTS LC_U TYPE C VALUE 'U'.

*- DEREFERENCE DYNAMIC EXPORT PARAMETER
    CREATE DATA LO_DREF LIKE ET_RANGE.
    ASSIGN LO_DREF->* TO <LT_RANGE>.
    CREATE DATA LO_SREF LIKE LINE OF <LT_RANGE>.
    ASSIGN LO_SREF->* TO FIELD-SYMBOL(<LS_RANGE>).
    DESCRIBE FIELD <LS_RANGE> TYPE DATA(LV_TYPE).

    "그룹이 들어 온 경우, 그룹 추출 메소드 호출
    IF IV_SETID IS INITIAL AND IV_GROUP_CODE IS NOT INITIAL.
      LV_SETID = ZCL_COC_COMM=>GET_HIERARCHY_GROUP_CODE( IV_KOKRS      = IV_KOKRS
                                                         IV_SETCLASS   = IV_SETCLASS
                                                         IV_GROUP_CODE = IV_GROUP_CODE ).

    ELSE.
      LV_SETID = IV_SETID.
    ENDIF.

    IF LV_SETID IS INITIAL.
      EXIT.
    ENDIF.

    CALL FUNCTION 'K_HIERARCHY_TABLES_READ'
      EXPORTING
        E_CLASS                     = IV_SETCLASS
        E_SETID                     = LV_SETID
        E_KOKRS                     = IV_KOKRS
      TABLES
        T_NODES                     = LT_NODES
        T_VALUES                    = LT_VALUES
      CHANGING
        C_INFO                      = LV_INFO
        C_OVERWRITE                 = LV_OVERWRITE
      EXCEPTIONS
        NO_CONTROLLING_AREA         = 1
        NO_CHART_OF_ACCOUNT         = 2
        DIFFERENT_CONTROLLING_AREAS = 3
        DIFFERENT_CHART_OF_ACCOUNTS = 4
        SET_NOT_FOUND               = 5
        ILLEGAL_FIELD_REPLACEMENT   = 6
        ILLEGAL_TABLE_REPLACEMENT   = 7
        FM_RAISE                    = 8
        CONVERT_ERROR               = 9
        NO_OVERWRITE_STANDARD_HIER  = 10
        NO_BUKRS_FOR_KOKRS          = 11
        OTHERS                      = 12.
    IF SY-SUBRC IS NOT INITIAL.
    	APPEND 'IEQNOT_FOUND' TO ET_RANGE.
    	APPEND 'IEQNOT_FOUND' TO RT_RANGEVALUE.
      EXIT.
    ENDIF.

    ET_NODES[] = LT_NODES.

*---------------------------------------------------------------------*
    IF LT_VALUES IS NOT INITIAL. "MAKE VALUE RANGE TABLE
*---------------------------------------------------------------------*

      LOOP AT LT_VALUES INTO DATA(LS_VALUES).

        IF LS_VALUES-VTO IS INITIAL OR LS_VALUES-VFROM = LS_VALUES-VTO.
          LS_RANGE = VALUE #( SIGN = 'I' OPTION = 'EQ' LOW = LS_VALUES-VFROM ).
        ELSE.
          LS_RANGE = VALUE #( SIGN = 'I' OPTION = 'BT' LOW = LS_VALUES-VFROM HIGH = LS_VALUES-VTO ).
        ENDIF.

        APPEND LS_RANGE TO RT_RANGEVALUE.

        IF <LS_RANGE> IS ASSIGNED AND LV_TYPE = LC_U.
          MOVE-CORRESPONDING LS_RANGE TO <LS_RANGE>.
          APPEND <LS_RANGE> TO <LT_RANGE>.
          CLEAR <LS_RANGE>.
        ENDIF.

				"ET_VALUES 값 담기
				CASE IV_SETCLASS.
				  WHEN ZCOC_SETCLASS_CC.
				  
				    SELECT @LS_VALUES-SETID AS SETID,
				    	     A~KOSTL AS VFROM,
				    	     A~KOSTL AS VTO,
				    	     B~LTEXT AS DESCRIPT
				    	FROM CSKS AS A
				    	LEFT JOIN CSKT AS B ON B~KOKRS = A~KOKRS
				    		                 AND B~KOSTL = A~KOSTL
				    		                 AND B~DATBI = A~DATBI
				    		                 AND B~SPRAS = @SY-LANGU
				 APPENDING CORRESPONDING FIELDS OF TABLE @ET_VALUES
				     WHERE A~KOKRS = @IV_KOKRS
				       AND A~KOSTL BETWEEN @LS_VALUES-VFROM AND @LS_VALUES-VTO.
				       
				  WHEN ZCOC_SETCLASS_CE.
				  
				    SELECT @LS_VALUES-SETID AS SETID,
				    	     A~KSTAR AS VFROM,
				    	     A~KSTAR AS VTO,
				    	     B~LTEXT AS DESCRIPT
				    	FROM CSKB AS A
				    	LEFT JOIN CSKU AS B ON B~KTOPL = @ZCOC_KTOPL
				    		                 AND B~KSTAR = A~KSTAR
				    		                 AND B~SPRAS = @SY-LANGU
				 APPENDING CORRESPONDING FIELDS OF TABLE @ET_VALUES
				     WHERE A~KOKRS = @IV_KOKRS
				       AND A~KSTAR BETWEEN @LS_VALUES-VFROM AND @LS_VALUES-VTO.
				  
				ENDCASE.
				
        CLEAR: LS_VALUES, LS_RANGE.

      ENDLOOP.

      IF <LT_RANGE> IS ASSIGNED AND <LT_RANGE> IS NOT INITIAL.
        ET_RANGE = <LT_RANGE>.
      ENDIF.

			"Range 값이 NULL일 경우, dummy 값 지정
			IF ET_RANGE IS INITIAL.
			  APPEND 'IEQNOT_FOUND' TO ET_RANGE.
			ENDIF.
			IF RT_RANGEVALUE IS INITIAL.
			  RT_RANGEVALUE = VALUE #( ( SIGN = 'I' OPTION = 'EQ' LOW = 'NOT_FOUND' ) ).
			ENDIF.
			
      EXIT.

    ENDIF.

*---------------------------------------------------------------------*
    IF LT_NODES IS NOT INITIAL. "GET VARIATION GROUP VALUE
*---------------------------------------------------------------------*
      LOOP AT LT_NODES INTO DATA(LS_NODE).

        CALL FUNCTION 'G_SET_DYNAMIC_GET_VALUES'
          EXPORTING
            SETID                 = LS_NODE-SETID
          TABLES
            SET_VALUES            = LT_D_VALUES
          EXCEPTIONS
            SET_IS_NOT_DYNAMIC    = 1
            DYNAMIC_SET_NOT_FOUND = 2
            NO_CO_AREA_SPECIFIED  = 3
            OTHERS                = 4.

        IF LT_D_VALUES[] IS NOT INITIAL.

          LOOP AT LT_D_VALUES INTO DATA(LS_DVAL).

            IF LS_DVAL-TO IS INITIAL OR LS_DVAL-FROM = LS_DVAL-TO.
              LS_RANGE = VALUE #( SIGN = 'I' OPTION = 'EQ' LOW = LS_DVAL-FROM ).
            ELSE.
              LS_RANGE = VALUE #( SIGN = 'I' OPTION = 'BT' LOW = LS_DVAL-FROM HIGH = LS_DVAL-TO ).
            ENDIF.

            APPEND LS_RANGE TO RT_RANGEVALUE.

            IF <LS_RANGE> IS ASSIGNED AND LV_TYPE = LC_U.
              MOVE-CORRESPONDING LS_RANGE TO <LS_RANGE>.
              APPEND <LS_RANGE> TO <LT_RANGE>.
              CLEAR <LS_RANGE>.
            ENDIF.

            CLEAR: LS_DVAL, LS_RANGE.

          ENDLOOP.

        ENDIF.

        CLEAR LS_NODE.

      ENDLOOP.

      IF <LT_RANGE> IS ASSIGNED AND <LT_RANGE> IS NOT INITIAL.
        ET_RANGE = <LT_RANGE>.
      ENDIF.

			"Range 값이 NULL일 경우, dummy 값 지정
			IF ET_RANGE IS INITIAL.
			  APPEND 'IEQNOT_FOUND' TO ET_RANGE.
			ENDIF.
			IF RT_RANGEVALUE IS INITIAL.
			  RT_RANGEVALUE = VALUE #( ( SIGN = 'I' OPTION = 'EQ' LOW = 'NOT_FOUND' ) ).
			ENDIF.

    ENDIF.


  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_KOKRS_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [<-()] E_KTEXT                        TYPE        BEZEI
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_KOKRS_TEXT.

    CHECK I_KOKRS IS NOT INITIAL.

    SELECT SINGLE BEZEI
      INTO E_KTEXT
      FROM TKA01
     WHERE KOKRS = I_KOKRS.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_BNAME_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [<-()] E_KTEXT                        TYPE        BEZEI
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_BNAME_TEXT.

		CLEAR RV_BNAMET.
		
    CHECK IV_BNAME IS NOT INITIAL.

    SELECT SINGLE CONCAT( NAME_LAST, NAME_FIRST )
      FROM USER_ADDR
     WHERE BNAME = @IV_BNAME
      INTO @RV_BNAMET.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_BNAME_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD DEL_IF_ITEM.

		"Get I/F info
		ZCL_COC_COMM=>GET_IF_INFO( IV_ZIFID = IV_ZIFID ).
		
		"데이터 유지 일자 확인
		CHECK ZCL_COC_COMM=>MS_IF_INFO-KEEPD > 0.
		
		"Select INFNO from Header TABLE
		DATA(LV_DATE) = CONV DATS( SY-DATUM - ZCL_COC_COMM=>MS_IF_INFO-KEEPD ).
		
		DATA(LV_DATE_CHAR) = CONV STRING( '''' && LV_DATE  && '''' ).
		DATA(LV_IFID_CHAR) = CONV STRING( '''' && IV_ZIFID && '''' ).
		
		CONCATENATE 'ZIFID = ' LV_IFID_CHAR ' AND ' ZCL_COC_COMM=>MS_IF_INFO-IFDAT ' < ' LV_DATE_CHAR
		       INTO DATA(LV_WHERE) SEPARATED BY SPACE.
		       
   "Delete Header table 
	 DELETE 
	   FROM (ZCL_COC_COMM=>MS_IF_INFO-HDTAB)
	  WHERE (LV_WHERE).
	 
   "Delete Item table 
	 DELETE 
	   FROM (ZCL_COC_COMM=>MS_IF_INFO-ITTAB)
	  WHERE (LV_WHERE).
	 
	 COMMIT WORK.
	 
  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_BNAME_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD POPUP_ATTACH.

    CALL FUNCTION 'ZCOCCM_POPUP_ATTACH'
      EXPORTING
        I_INSTID = IV_INSTID
        I_TYPEID = IV_TYPEID
        I_MODE   = IV_MODE
        I_COMMIT = IV_COMMIT.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_BNAME_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD SAVE_IF_HEADER.
* +--------------------------------------------------------------------------------------</SIGNATURE>
* IV_ZIFID : I/F ID
* IV_IFSYS : I/F 상대 시스템 
* IV_LOGTY : I/F 로그 업데이트 여부
* IV_IFDAT : I/F 생성일
* IV_INFNO : I/F 헤더 순번
* IV_IFRLT : I/F 결과
* IV_IFMSG : I/F 메시지
* IV_IFCNT : I/F 아이템 건수
* +--------------------------------------------------------------------------------------</SIGNATURE>
* 인터페이스 시작 시 IV_LOGTY = 'C'로 생성 후,
*         종료 후 IV_LOGTY = 'U'로 업데이트 한다.
* +--------------------------------------------------------------------------------------</SIGNATURE>
* ex)
*  "인터페이스 헤더 정보 생성
*  ZCL_COC_COMM=>SAVE_IF_HEADER( EXPORTING IV_ZIFID = 'IF_002'
*                                          IV_IFSYS = 'HR_100'
*                                          IV_LOGTY = 'C'       "로그 생성
*                                IMPORTING EV_IFDAT = DATA(LV_IFDAT)
*                                          EV_INFNO = DATA(LV_INFNO) ).
*
*  "인터페이스 헤더 정보 업데이트
*  ZCL_COC_COMM=>SAVE_IF_HEADER( EXPORTING IV_ZIFID = 'IF_002'
*                                          IV_IFSYS = 'HR_100'
*                                          IV_LOGTY = 'U'       "로그 업데이트
*                                          IV_IFDAT = LV_IFDAT
*                                          IV_INFNO = LV_INFNO
*                                          IV_IFRLT = LS_RETURN-TYPE
*                                          IV_IFMSG = LS_RETURN-MESSAGE
*                                          IV_IFCNT = LINES( GT_ALV1 )
*                               ).
* +--------------------------------------------------------------------------------------</SIGNATURE>
  DATA: LS_HEADER TYPE ZCOCT009.
  	
  CLEAR: EV_IFDAT, EV_INFNO.
  
  "Check Logging Activation
  ZCL_COC_COMM=>GET_IF_INFO( IV_ZIFID = IV_ZIFID ).
  
  CHECK ZCL_COC_COMM=>MS_IF_INFO-DEACT EQ SPACE.
  
  DATA(LV_IFDAT) = SY-DATUM.
  
  CASE IV_LOGTY.
  	
  	WHEN ZCOC_C.
  	
  	  "다음 순번 추출
  	  SELECT MAX( INFNO )
  	  	FROM ZCOCT009
  	   WHERE ZIFID = @IV_ZIFID
  	     AND IFDAT = @LV_IFDAT
  	  	INTO @DATA(LV_MAX_CNT).
 
      IF SY-SUBRC = 0.
      	LV_MAX_CNT = LV_MAX_CNT + 1.
      ELSE.
      	LV_MAX_CNT = 1.
      ENDIF.
      
      "테이블 반영 전 동일한 MAX SEQNO를 가져갈 수 있는 문제로 LOCK 설정
*      DO 100 TIMES.
*      	
*      	CALL FUNCTION 'ENQUEUE_EZCOCT009'
*          EXPORTING 
*            ZIFID          = IV_ZIFID
*            IFDAT          = LV_IFDAT
*            IFSYS          = IV_IFSYS
*            INFNO          = LV_MAX_CNT
*          EXCEPTIONS
*            FOREIGN_LOCK   = 1
*            SYSTEM_FAILURE = 2
*            OTHERS         = 3.
*            
*        IF SY-SUBRC = 0.
*        	EXIT.
*        ELSE.
*        	LV_MAX_CNT = LV_MAX_CNT + 1.
*        ENDIF.
*        
*      ENDDO.

      LS_HEADER = VALUE #( ZIFID = IV_ZIFID
                           IFSYS = ZCL_COC_COMM=>MS_IF_INFO-IFSYS
                           IFDAT = LV_IFDAT
                           INFNO = LV_MAX_CNT
                           IFNAM = SY-UNAME
                           XFLAG = ZCOC_X
                           ERDAT = SY-DATUM
                           ERZET = SY-UZEIT
                           ERNAM = SY-UNAME
                         ).
                       
      EV_IFDAT = LV_IFDAT.
      EV_INFNO = LV_MAX_CNT.
    
    WHEN ZCOC_U.
    
      IF IV_INFNO < 1.
      	EXIT.
      ENDIF.
      
      SELECT SINGLE *
      	FROM ZCOCT009
      	INTO LS_HEADER
       WHERE ZIFID = IV_ZIFID
         AND IFDAT = IV_IFDAT
         AND INFNO = IV_INFNO.
         
      LS_HEADER = VALUE #( BASE LS_HEADER
                           SUBRC = IV_IFRLT
                           MESSG = IV_IFMSG
                           IFCNT = IV_IFCNT
                           AEDAT = SY-DATUM
                           AEZET = SY-UZEIT
                           AENAM = SY-UNAME
                         ).  
                         
    ENDCASE.
    
    MODIFY ZCOCT009 FROM LS_HEADER.
		COMMIT WORK.
		
  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_BNAME_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD SAVE_IF_ITEM.
* +--------------------------------------------------------------------------------------</SIGNATURE>
* IV_ZIFID : I/F ID
* IV_IFSYS : I/F 상대 시스템 
* IV_IFDAT : I/F 생성일
* IV_INFNO : I/F 헤더 순번
* IV_IFRLT : I/F 결과
* IV_IFMSG : I/F 메시지
* IV_IFCNT : I/F 아이템 건수
* +--------------------------------------------------------------------------------------</SIGNATURE>
* 아이템 테이블 생성 시 아래 필드 필수
* ZIFID : I/F ID
* IFDAT : I/F 생성일
* IFSYS : I/F 상대 시스템
* INFNO : I/F 헤더 순번
* SEQNO : I/F 로그 순번
* SUBRC : I/F 결과('S' or 'E')
* MESSG : I/F 메시지
* +--------------------------------------------------------------------------------------</SIGNATURE>
* ex)
*  "인터페이스 아이템 데이터 저장
*  ZCL_COC_COMM=>SAVE_IF_ITEM( EXPORTING IV_ZIFID = 'IF_002'
*                                        IV_IFSYS = 'HR_100'
*                                        IV_IFDAT = LV_IFDAT
*                                        IV_INFNO = LV_INFNO
*                                        IV_IFRLT = LS_RETURN-TYPE
*                                        IV_IFMSG = LS_RETURN-MESSAGE
*                                        IT_DATA  = GT_ALV1 
*                            ).
* +--------------------------------------------------------------------------------------</SIGNATURE>
  "Create Dynamic Table
  DATA: L_DATA_WA  TYPE REF TO DATA,
  	    L_DATA_TAB TYPE REF TO DATA,
  	    LV_SEQNO   TYPE I.
  	    
  FIELD-SYMBOLS: <FS_IT> TYPE STANDARD TABLE.
  
  "Check Logging Actication
  ZCL_COC_COMM=>GET_IF_INFO( IV_ZIFID = IV_ZIFID ).
  
  CHECK ZCL_COC_COMM=>MS_IF_INFO-DEACT EQ SPACE.
  
  CREATE DATA L_DATA_TAB TYPE STANDARD TABLE OF (ZCL_COC_COMM=>MS_IF_INFO-ITTAB).
  ASSIGN L_DATA_TAB->* TO <FS_IT>.
  
  "I/F data
  LOOP AT IT_DATA ASSIGNING FIELD-SYMBOL(<FS_DATA>).
  	
  	APPEND INITIAL LINE TO <FS_IT> ASSIGNING FIELD-SYMBOL(<FS_WA>).
  	MOVE-CORRESPONDING <FS_DATA> TO <FS_WA>.
  	
  	ASSIGN COMPONENT 'ZIFID' OF STRUCTURE <FS_WA> TO FIELD-SYMBOL(<FS_FIELDS>).
  	<FS_FIELDS> = IV_ZIFID.
    ASSIGN COMPONENT 'IFSYS' OF STRUCTURE <FS_WA> TO <FS_FIELDS>.
    IF SY-SUBRC = 0.
  	  <FS_FIELDS> = ZCL_COC_COMM=>MS_IF_INFO-IFSYS.
    ENDIF.
    ASSIGN COMPONENT 'IFDAT' OF STRUCTURE <FS_WA> TO <FS_FIELDS>.
  	<FS_FIELDS> = IV_IFDAT.
    ASSIGN COMPONENT 'INFNO' OF STRUCTURE <FS_WA> TO <FS_FIELDS>.
  	<FS_FIELDS> = IV_INFNO.
    ASSIGN COMPONENT 'SEQNO' OF STRUCTURE <FS_WA> TO <FS_FIELDS>.
    IF <FS_FIELDS> IS INITIAL. "외부에서 seqno를 지정하여 들어온 경우 업데이트 안함
      LV_SEQNO += 1.
  	  <FS_FIELDS> = LV_SEQNO.
    ENDIF.

    IF IV_DO_NOT_UPDATE_MESSAGE IS INITIAL.
      ASSIGN COMPONENT 'SUBRC' OF STRUCTURE <FS_WA> TO <FS_FIELDS>.
      <FS_FIELDS> = IV_IFRLT.
      ASSIGN COMPONENT 'MESSG' OF STRUCTURE <FS_WA> TO <FS_FIELDS>.
      <FS_FIELDS> = IV_IFMSG.
    ENDIF.
      
    ZCL_COC_COMM=>SET_TIMESTAMP( EXPORTING IV_TYPE = ZCOC_I
                                 CHANGING  CS_WA   = <FS_WA> ).
                                 
  ENDLOOP.
  
  MODIFY (ZCL_COC_COMM=>MS_IF_INFO-ITTAB) FROM TABLE <FS_IT>.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_BNAME_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_NEXT_NUMBER.

    "번호 채번
    CALL FUNCTION 'NUMBER_GET_NEXT'
      EXPORTING
        NR_RANGE_NR           = IV_NR_RANGE_NR
        OBJECT                = IV_OBJECT
        SUBOBJECT             = IV_BUKRS
        TOYEAR                = IV_GJAHR
      IMPORTING
        NUMBER                = RV_NUMBER
      EXCEPTIONS
        INTERVAL_NOT_FOUND      = 1
        NUMBER_RANGE_NOT_INTERN = 2
        OBJECT_NOT_FOUND        = 3
        QUANTITY_IS_0           = 4
        QUANTITY_IS_NOT_1       = 5
        INTERNAL_OVERFLOW       = 6
        BUFFER_OVERFLOW         = 7
        OTHERS                  = 8.
        
    IF SY-SUBRC <> 0.
    	MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
    	      WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
    ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_KOSTL_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_KOSTL_TEXT.

		CLEAR: EV_SUBRC, RV_KOSTLT.
		
		SELECT SINGLE KOSTL
		  FROM CSKS
		 WHERE KOKRS = @IV_KOKRS
		   AND KOSTL = @IV_KOSTL
		   AND DATBI = @IV_DATBI
		  INTO @DATA(LV_KOSTL).
		  
		IF SY-SUBRC = 0.
			
			SELECT SINGLE LTEXT
			  FROM CSKT
		 WHERE KOKRS = @IV_KOKRS
		   AND KOSTL = @IV_KOSTL
		   AND DATBI = @IV_DATBI
		   AND SPRAS = @SY-LANGU
		  INTO @RV_KOSTLT.
		  
		ELSE.
		
			EV_SUBRC = 4.
			
		ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_IF_INFO
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_IF_INFO.

		CLEAR: MS_IF_INFO.
		  
		SELECT SINGLE *
		  FROM ZCOCT005
		  INTO @RS_IF_INFO
		 WHERE ZIFID = @IV_ZIFID.
		 		  
		IF SY-SUBRC <> 0.
			MESSAGE S000 WITH '해당 IF에 대한 정보가 존재하지 않습니다.' DISPLAY LIKE ZCOC_E.
			EXIT.		  
		ELSE.
			MS_IF_INFO = RS_IF_INFO.
		ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_SAKNR_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_SAKNR_TEXT.

		CLEAR: EV_SUBRC, RV_SAKNRT.
		
		SELECT SINGLE SAKNR
		  FROM SKA1
		 WHERE KTOPL = @IV_KTOPL
		   AND SAKNR = @IV_SAKNR
		  INTO @DATA(LV_SAKNR).
		  
		IF SY-SUBRC = 0.
			
			SELECT SINGLE TXT20
			  FROM SKAT
		 WHERE SPRAS = @SY-LANGU
		   AND KTOPL = @IV_KTOPL
		   AND SAKNR = @IV_SAKNR
		  INTO @RV_SAKNRT.
		  
		ELSE.
		
			EV_SUBRC = 4.
			
		ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_PLAN_ACC
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_PLAN_ACC.

		"5*, 6* 계정
    
    "비용계획 계정 추가
    DATA: LR_SAKNR TYPE RANGE OF SAKNR.

    IF IV_KOKRS = '1000'. "SK매직

      LR_SAKNR = VALUE #( ( SIGN = 'I' OPTION = 'EQ' LOW = '004101411' )
                          ( SIGN = 'I' OPTION = 'EQ' LOW = '004101411' )
                          ( SIGN = 'I' OPTION = 'EQ' LOW = '004101411' )
                          ( SIGN = 'I' OPTION = 'EQ' LOW = '004101411' )
                          ( SIGN = 'I' OPTION = 'EQ' LOW = '004101411' )
                          ( SIGN = 'I' OPTION = 'EQ' LOW = '004101411' )
                          ( SIGN = 'I' OPTION = 'EQ' LOW = '004101411' )
                          ( SIGN = 'I' OPTION = 'EQ' LOW = '004101411' )
                          ( SIGN = 'I' OPTION = 'EQ' LOW = '004101411' )
                          ( SIGN = 'I' OPTION = 'EQ' LOW = '004101411' )
                          ( SIGN = 'I' OPTION = 'EQ' LOW = '004101411' )
                          ( SIGN = 'I' OPTION = 'EQ' LOW = '004101411' )
                          ( SIGN = 'I' OPTION = 'EQ' LOW = '004101411' )
                          ( SIGN = 'I' OPTION = 'EQ' LOW = '004101411' )
                          ( SIGN = 'I' OPTION = 'EQ' LOW = '004101411' )
                        ).
    ENDIF.

		SELECT 'I'     AS SIGN,
		       'EQ'    AS OPTION,
		       A~SAKNR AS LOW
		  FROM SKA1 AS A
		 INNER JOIN SKB1 AS B ON B~SAKNR = A~SAKNR
		 WHERE A~KTOPL = @ZCOC_KTOPL
		   AND ( A~SAKNR LIKE '005%' 
          OR A~SAKNR LIKE '006%'
          OR A~SAKNR IN @LR_SAKNR )
		   AND B~BUKRS = @IV_KOKRS
		  INTO CORRESPONDING FIELDS OF TABLE @RT_SAKNR.
		  
		"RANGE 값이 NULL일 경우, DUMMY 지정
		IF RT_SAKNR IS INITIAL.
			APPEND 'IEQNOT_FOUND' TO RT_SAKNR.
	  ENDIF.		  
		   
  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>DATA_COUNT_MESSAGE
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_AUTHO                        TYPE        C
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD DATA_COUNT_MESSAGE.

		EV_COUNT = LINES( IT_TABLE ).
		
		IF EV_COUNT = 0.
      IF IV_AUTHO = ABAP_ON.
        MESSAGE S039 DISPLAY LIKE ZCOC_E.
      ELSE.
        MESSAGE S001 DISPLAY LIKE ZCOC_E.
      ENDIF.
	  ELSE.
	    MESSAGE S003 WITH EV_COUNT.
	  ENDIF.
		   
  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_AWTYP_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_AWTYP_TEXT.

		CLEAR: EV_SUBRC, RV_AWTYPT.
		
		SELECT SINGLE AWTYP
		  FROM TTYP
		 WHERE AWTYP = @IV_AWTYP
		  INTO @DATA(LV_AWTYP).
		  
		IF SY-SUBRC = 0.
			
			SELECT SINGLE OTEXT
			  FROM TTYPT
		 WHERE SPRAS = @SY-LANGU
		   AND AWTYP = @IV_AWTYP
		  INTO @RV_AWTYPT.
		  
		ELSE.
		
			EV_SUBRC = 4.
			
		ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_BKLAS_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_BKLAS_TEXT.

		CLEAR: EV_SUBRC, RV_BKLAST.
		
		SELECT SINGLE BKLAS
		  FROM T025
		 WHERE BKLAS = @IV_BKLAS
		  INTO @DATA(LV_BKLAS).
		  
		IF SY-SUBRC = 0.
			
			SELECT SINGLE BKBEZ
			  FROM T025T
		 WHERE SPRAS = @SY-LANGU
		   AND BKLAS = @IV_BKLAS
		  INTO @RV_BKLAST.
		  
		ELSE.
		
			EV_SUBRC = 4.
			
		ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_PTYP_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_PTYP_TEXT.

		CLEAR: EV_SUBRC, RV_PTYPT.
		
		SELECT SINGLE PTYP
		  FROM CKMLMV009
		 WHERE PTYP = @IV_PTYP
		  INTO @DATA(LV_PTYP).
		  
		IF SY-SUBRC = 0.
			
			SELECT SINGLE KTEXT
			  FROM CKMLMV009T
		 WHERE SPRAS = @SY-LANGU
		   AND PTYP = @IV_PTYP
		  INTO @RV_PTYPT.
		  
		ELSE.
		
			EV_SUBRC = 4.
			
		ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_BWART_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_BWART_TEXT.

		CLEAR: EV_SUBRC, RV_BWARTT.
		
		SELECT SINGLE BWART
		  FROM T156
		 WHERE BWART = @IV_BWART
		  INTO @DATA(LV_BWART).
		  
		IF SY-SUBRC = 0.
			
			SELECT SINGLE BTEXT
			  FROM T156T
		 WHERE SPRAS = @SY-LANGU
		   AND BWART = @IV_BWART
		  INTO @RV_BWARTT.
		  
		ELSE.
		
			EV_SUBRC = 4.
			
		ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_MON_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_MON_TEXT.

		CLEAR: RV_TXT.
		
		SELECT SINGLE LTX
		  FROM T247
		 WHERE SPRAS = @SY-LANGU
		   AND MNR   = @IV_MON
		  INTO @RV_TXT.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_PLAN_VERSN
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_PLAN_VERSN.

		CLEAR: RV_VERSN.
		
		SELECT MAX( FIELD07 )
		  FROM ZCOCT003
		 WHERE ZMODULE = 'CO'
		   AND CLASS   = @IV_CLASS
		   AND FIELD05 = @IV_KOKRS
*		   AND FIELD06 = @IV_GJAHR
       AND DELFLAG = @ZCOC_X
      INTO @RV_VERSN.
      
		IF SY-SUBRC <> 0.
*			MESSAGE S009 WITH IV_KOKRS IV_GJAHR DISPLAY LIKE ZCOC_E.
			MESSAGE S009 WITH IV_KOKRS DISPLAY LIKE ZCOC_E.
		ENDIF.		      
		   
  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>CURRENCY_CONV_TO_INTERNAL
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD CURRENCY_CONV_TO_INTERNAL.

		DATA: LV_AMT_EXT TYPE BAPICURR_D,
		      LS_RETURN  TYPE BAPIRETURN.
		      
*		LV_AMT_EXT = IV_AMT_EXT. "콤마 에러
		LV_AMT_EXT = REPLACE( VAL = IV_AMT_EXT PCRE = ',' WITH = SPACE OCC = 0 ).
		
		
		CALL FUNCTION 'BAPI_CURRENCY_CONV_TO_INTERNAL'
			EXPORTING
			  CURRENCY             = IV_CURR
			  AMOUNT_EXTERNAL      = LV_AMT_EXT
			  MAX_NUMBER_OF_DIGITS = 23
			IMPORTING
				AMOUNT_INTERANL      = RV_AMT_INT
				RETURN               = LS_RETURN.
				
		EV_AMT_INT = RV_AMT_INT.				
		   
  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_MATNR_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_MATNR_TEXT.

		CLEAR: EV_SUBRC, RV_MAKTX.
		
		SELECT SINGLE MATNR
		  FROM MARA
		 WHERE MATNR = @IV_MATNR
		  INTO @DATA(LV_MATNR).
		  
		IF SY-SUBRC = 0.
			
			SELECT SINGLE MAKTX
			  FROM MAKT
		 WHERE SPRAS = @SY-LANGU
		   AND MATNR = @IV_MATNR
		  INTO @RV_MAKTX.
		  
		ELSE.
		
			EV_SUBRC = 4.
			
		ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_MATKL_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_MATKL_TEXT.

		CLEAR: EV_SUBRC, RV_WGBEZ.
		
		SELECT SINGLE MATKL
		  FROM T023
		 WHERE MATKL = @IV_MATKL
		  INTO @DATA(LV_MATKL).
		  
		IF SY-SUBRC = 0.
			
			SELECT SINGLE WGBEZ
			  FROM T023T
		 WHERE SPRAS = @SY-LANGU
		   AND MATKL = @IV_MATKL
		  INTO @RV_WGBEZ.
		  
		ELSE.
		
			EV_SUBRC = 4.
			
		ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_CHNNL_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_CHNNL_TEXT.

		CLEAR: EV_SUBRC, RV_CHNNL_T.
		
		SELECT SINGLE CHNNL_T
		  FROM ZCOVSIM01
		 WHERE CHNNL = @IV_CHNNL
		  INTO @RV_CHNNL_T.
		  
		IF SY-SUBRC <> 0.
			EV_SUBRC = 4.
		ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_MATNR_TEXT2
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_MATNR_TEXT2.

		CLEAR: EV_SUBRC, RV_MAKTX.
		
    "제품 추출 로직 변경
*		SELECT SINGLE MATNR, MAKTX
*		  FROM ZCOMT004
*		 WHERE KOKRS = @ZCOC_KOKRS_M
*		   AND GJAHR = @IV_GJAHR
*		   AND MATNR = @IV_MATNR
*		  INTO ( @DATA(LV_MATNR), @RV_MAKTX ).
    SELECT SINGLE MATNR, MAKTX
      FROM ZCOVSIM05
     WHERE MATNR = @IV_MATNR
      INTO ( @DATA(LV_MATNR), @RV_MAKTX ).

		IF SY-SUBRC = 0.
			"OK
		ELSE.
			EV_SUBRC = 4.
		ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>CURRENCY_CONV_TO_EXTERNAL
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD CURRENCY_CONV_TO_EXTERNAL.

		DATA: LV_AMT_EXT TYPE BAPICURR_D.
		      
		CALL FUNCTION 'BAPI_CURRENCY_CONV_TO_EXTERNAL'
			EXPORTING
			  CURRENCY             = IV_CURR
			  AMOUNT_INTERNAL      = IV_AMT_INT
			IMPORTING
				AMOUNT_EXTERANL      = LV_AMT_EXT.
				
		EV_AMT_EXT = LV_AMT_EXT.
		RV_AMT_EXT = LV_AMT_EXT.
		   
  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_AVACP_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_AVACP_TEXT.

		CLEAR: EV_SUBRC, RV_AVACP_T.
		
		SELECT SINGLE AVACP_T
		  FROM ZCOVBDG01
		 WHERE AVACP = @IV_AVACP
		  INTO @RV_AVACP_T.
		  
		IF SY-SUBRC <> 0.
			EV_SUBRC = 4.
		ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_SALTY_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_SALTY_TEXT.

		CLEAR: EV_SUBRC, RV_SALTY_T.
		
		SELECT SINGLE SALTY_T
		  FROM ZCOVPLN03
		 WHERE SALTY = @IV_SALTY
		  INTO @RV_SALTY_T.
		  
		IF SY-SUBRC <> 0.
			EV_SUBRC = 4.
		ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_CHNNL_TEXT2
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_CHNNL_TEXT2.

		CLEAR: EV_SUBRC, RV_CHNNL_T.
		
		SELECT SINGLE CHNNL_T
		  FROM ZCOVPLN04
		 WHERE CHNNL = @IV_CHNNL
		  INTO @RV_CHNNL_T.
		  
		IF SY-SUBRC <> 0.
			EV_SUBRC = 4.
		ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_NEXT_YYYYMM
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_NEXT_YYYYMM.

		CLEAR: RV_SPMON.
		
		IF IV_SPMON+4(2) = '12'.
			RV_SPMON = |{ IV_SPMON(4) + 1 }| && '01'.
	  ELSE.
	  	RV_SPMON = IV_SPMON(4) && CONV NUMC2( |{ IV_SPMON+4(2) + 1 }| ).
	  ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_MONTH_COUNT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_MONTH_COUNT.

		CLEAR: RV_COUNT.
		
		CHECK IV_SPMON_FR < IV_SPMON_TO.
		
		IF ( IV_SPMON_TO+4(2) - IV_SPMON_FR+4(2) ) < 0.
		
			RV_COUNT = ( IV_SPMON_TO(4) - IV_SPMON_FR(4) - 1 ) * 12 + ( IV_SPMON_TO+4(2) - IV_SPMON_FR+4(2) + 12 ).
			
		ELSE.

			RV_COUNT = ( IV_SPMON_TO(4) - IV_SPMON_FR(4) ) * 12 + ( IV_SPMON_TO+4(2) - IV_SPMON_FR+4(2) ).
		
		ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>PV
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD PV.

		RV_RESULT = IV_AMT_DEC * ( 1 - 1 / ( 1 + IV_RATE / 100 ) ** IV_EXPPR ) / ( IV_RATE / 100 ).

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_AVAC_PRIOD_INFO
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_AVAC_PRIOD_INFO.

		CHECK I_MONAT BETWEEN '01' AND '12'.
		
		"통제유부 및 통제주기 확인
		SELECT SINGLE AVACT,
		              AVACP
		  FROM ZCOCT023
		 WHERE KOKRS = @I_KOKRS
		   AND SAKNR = @I_SAKNR
		  INTO (@E_AVACT, @E_AVACP).
		  
		"입력기간의 통제기간 확인
		IF E_AVACT IS INITIAL.
			CLEAR E_AVACP.
			E_MONFR = '01'.
			E_MONTO = '12'.
		ELSE.
			CASE E_AVACP.
				WHEN 'Y'. "연통제
					DATA(LV_DEVIDER) = 12.
				WHEN 'H'. "반기통제
					LV_DEVIDER = 6.
				WHEN 'Q'. "분기통제
					LV_DEVIDER = 3.
				WHEN 'M'. "월통제
					LV_DEVIDER = 1.
			ENDCASE.
			E_AVAPR = E_AVACP && |{ ( ( I_MONAT - 1 ) DIV LV_DEVIDER ) + 1 }|.
			E_MONFR = ( ( ( I_MONAT - 1 ) DIV LV_DEVIDER ) ) * LV_DEVIDER + 1.
			E_MONTO = ( ( ( I_MONAT - 1 ) DIV LV_DEVIDER ) + 1 ) * LV_DEVIDER.
		ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>CURRENCY_CONV_TO_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD CURRENCY_CONV_TO_TEXT.

		WRITE IV_AMT_INT TO RV_AMT_EXT CURRENCY IV_CURR LEFT-JUSTIFIED.
		
		IF IV_AMT_INT < 0.
			CALL FUNCTION 'CLOI_PUT_SIGN_IN_FRONT'
				CHANGING
					VALUE = RV_AMT_EXT.
		ENDIF.
		
		IF IV_WITH_COMMA IS INITIAL.
			RV_AMT_EXT = REPLACE( VAL = RV_AMT_EXT PCRE = ',' WITH = SPACE OCC = 0 ).
		ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_DSTTY_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_DSTTY_TEXT.

		CLEAR: EV_SUBRC, RV_DSTTY_T.
		
		SELECT SINGLE DSTTY_T
		  FROM ZCOVBP002
		 WHERE DSTTY = @IV_DSTTY
		  INTO @RV_DSTTY_T.
		  
		IF SY-SUBRC <> 0.
			EV_SUBRC = 4.
		ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>CALL_TRANSACTION2
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD CALL_TRANSACTION2.
		CALL TRANSACTION IV_TCODE AND SKIP FIRST SCREEN.
  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_CHARACTERISTIC_TEXT
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_CHARACTERISTIC_TEXT.
  
  	DATA: LT_CHARACTVA TYPE TABLE OF BAPI1161_CHARACT_VALUES.
  	
  	DATA(LT_SELECTION) = VALUE BAPI_COPA_SELTAB( ( FIELDNAME = IV_CHARACTERISTIC
  	                                               SIGN      = 'I'
  	                                               OPTION    = 'EQ'
  	                                               LOW       = CONV #( IV_VALUE ) ) ).
  	                                               
		CALL FUNCTION 'BAPI_COPA_WW_GET_VALUES'
			EXPORTING
				CHARACTERISTIC = IV_CHARACTERISTIC
			TABLES
				SELECTION      = LT_SELECTION
				CHARACT_VALUES = LT_CHARACTVA.
				
		IF LT_CHARACTVA IS NOT INITIAL.
			RV_TEXT = LT_CHARACTVA[ 1 ]-NAME.
	  ENDIF.				  	                                               
  
  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>MOVE_SERVER_FILE
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD MOVE_SERVER_FILE.
  
  	"외부명령어 파일 MOVE/COPY
  	DATA(LV_CMND) = CONV SXPGLOGCMD( SWITCH #( IV_COPY WHEN ABAP_ON THEN |ZCOPY| ELSE |ZMOVE| ) ).
  	
  	"외부명령어 파라미터
  	DATA(LV_PARA) = CONV BTCXPGPAR( |{ IV_FROM && ` ` && IV_TO }| ).
  	
  	"외부명렁어 실행
		CALL FUNCTION 'SXPG_COMMAND_EXECUTE'
			EXPORTING
				COMMANDNAME               = LV_CMND
				ADDITIONAL_PARAMETERS     = LV_PARA
			EXCEPTIONS
				NO_PERMISSION             = 1
				COMMAND_NOT_FOUND         = 2
				PARAMETERS_TOO_LONG       = 3
				SECURITY_RISK             = 4
				WRONG_CHECK_CALL_INTERFACE = 5
				PROGRAM_START_ERROR        = 6
				PROGRAM_TERMINATION_ERROR  = 7
				X_ERROR                    = 8
				PARAMETER_EXPECTED         = 9
				TOO_MANY_PARAMETERS        = 10
				ILLEGAL_COMMAND            = 11
				WRONG_ASYNCHRONOUS_PARAMETERS = 12
				CANT_ENQ_TBTCO_ENTRY          = 13
				JOBCOUNT_GENERATION_ERROR     = 14
				OTHERS                        = 15.
		IF SY-SUBRC <> 0.
			MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
			        WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.				
		ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_IF_PATH_FILENAME
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_IF_PATH_FILENAME.
  
  
  	"코드 클래스 등록정보 추출
  	SELECT SINGLE FIELD17, FIELD13
  	  FROM ZCOCT003
  	 WHERE ZMODULE = 'CO'
  	   AND CLASS   = 'D00'
  	   AND FIELD03 = @IV_IF_ID
  	   AND DELFLAG = ''
  	  INTO ( @EV_PATH, @EV_FILE ).
  	  
		"파일명 생성
		REPLACE ALL OCCURRENCES OF '&1' IN EV_FILE WITH IV_PARAM1.
		REPLACE ALL OCCURRENCES OF '&2' IN EV_FILE WITH IV_PARAM2.
		
		CONCATENATE EV_PATH EV_FILE INTO RV_FULLPATH.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_INCREMENTAL_TIMESTAMP
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_INCREMENTAL_TIMESTAMP.
  
  	IF C_TIMESTAMP IS INITIAL.
  	
  		CONVERT DATE SY-DATLO TIME SY-TIMLO DAYLIGHT SAVING TIME ' '
  		        INTO TIME STAMP C_TIMESTAMP TIME ZONE 'UTC'.
  		        
		ELSE.
		
			CALL FUNCTION 'TIMESTAMP_DURATION_ADD'
				EXPORTING
				  TIMESTAMP_IN   = C_TIMESTAMP
				  TIMEZONE       = 'UTC'
				  DURATION       = 1
				  UNIT           = 'S'
				IMPORTING
				  TIMESTAMP_OUT  = C_TIMESTAMP
				EXCEPTIONS
				  TIMESTAMP_ERROR = 1
				  OTHERS          = 2.  		        
				  
		ENDIF.				  
  
  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_MATNR_TEXT3
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_MATNR_TEXT3.

		CLEAR: EV_SUBRC, RV_MAKTX.
		
		SELECT SINGLE MATNR, MAKTX
		  FROM ZCOMT021
		 WHERE KOKRS = @ZCOC_KOKRS_M
		   AND MATNR = @IV_MATNR
		  INTO ( @DATA(LV_MATNR), @RV_MAKTX ).
		  
		IF SY-SUBRC = 0.
			"OK
		ELSE.
			EV_SUBRC = 4.
		ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_SALTY_TEXT2
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_SALTY_TEXT2.

		CLEAR: EV_SUBRC, RV_SALTY_T.
		
		SELECT SINGLE SALTY_T
		  FROM ZCOVSIM02
		 WHERE SALTY = @IV_SALTY
		  INTO @RV_SALTY_T.
		  
		IF SY-SUBRC <> 0.
			EV_SUBRC = 4.
		ENDIF.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>CLEAR_SELECTION_SCREEN
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD CLEAR_SELECTION_SCREEN.

    DATA: LV_SUBRC TYPE SY-SUBRC,
    	    LR_KIND  TYPE RANGE OF RSSCR_KIND.
    	    
    "Selections 추출
    ZCL_COC_COMM=>GET_PGM_PARAMETER( IMPORTING ET_SELINFO = DATA(LT_SELINFO) ).
    
    "Selections 삭제
    IF IV_KIND IS NOT INITIAL.
    	LR_KIND = VALUE #( ( SIGN = 'I' OPTION = 'EQ' LOW = IV_KIND ) ).
    ENDIF.
    
    LOOP AT LT_SELINFO ASSIGNING FIELD-SYMBOL(<FS_SELINFO>) WHERE KIND IN LR_KIND.
    	DATA(LV_FORMNAME) = CONV CHAR50( |%_LINK_|   && <FS_SELINFO>-NAME ).
    	DATA(LV_KIND)     = CONV CHAR50( |RSSELTAB_| && <FS_SELINFO>-KIND ).
    	PERFORM (LV_FORMNAME) IN PROGRAM (IV_CPROG) USING 'SAPLSVAR' LV_KIND LV_SUBRC IF FOUND.
    ENDLOOP.

  ENDMETHOD.


* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>SET_FIELDS_STYLE
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD SET_FIELDS_STYLE.

    DATA: LR_DATA TYPE REF TO DATA,
          LT_CELLTAB TYPE LVC_T_STYL,
    	    LR_TABDESCR TYPE REF TO CL_ABAP_STRUCTDESCR.
    	    
    "INTERNAL TABLE FIELDS
    CREATE DATA LR_DATA LIKE LINE OF CT_TABLE.
    LR_TABDESCR ?= CL_ABAP_STRUCTDESCR=>DESCRIBE_BY_DATA_REF( LR_DATA ).
    DATA(LT_DFIES) = CL_SALV_DATA_DESCR=>READ_STRUCTDESCR( LR_TABDESCR ).
    
    "구조에 포함된 필드 대상으로만 속성 지정
    LOOP AT IT_FIELDS ASSIGNING FIELD-SYMBOL(<FS_FIELDS>).
    	IF LINE_EXISTS( LT_DFIES[ FIELDNAME = <FS_FIELDS> ] ).
    	  LT_CELLTAB = VALUE #( BASE LT_CELLTAB ( FIELDNAME = <FS_FIELDS> STYLE = IV_STYLE ) ).
    	ENDIF.
    ENDLOOP.
    
    "테이블에 반영
    LOOP AT CT_TABLE ASSIGNING FIELD-SYMBOL(<FS_TABLE>).
    	ASSIGN COMPONENT 'CELLTAB' OF STRUCTURE <FS_TABLE> TO FIELD-SYMBOL(<FS_CELLTAB>).
    	<FS_CELLTAB> = LT_CELLTAB.
    ENDLOOP.

  ENDMETHOD.
  
  
* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>GET_KEY_FIELDS
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD GET_KEY_FIELDS.


    IF IV_WITH_MANDT IS INITIAL.

      SELECT FIELDNAME
        FROM DD03L
       WHERE TABNAME   EQ @IV_TABNAME
         AND FIELDNAME NOT LIKE '.%'
         AND KEYFLAG   EQ @ABAP_TRUE
         AND DATATYPE  NE 'CLNT'
        INTO TABLE @RT_FIELDS.
		  
    ELSE.

      SELECT FIELDNAME
        FROM DD03L
       WHERE TABNAME   EQ @IV_TABNAME
         AND FIELDNAME NOT LIKE '.%'
         AND KEYFLAG   EQ @ABAP_TRUE
        INTO TABLE @RT_FIELDS.

    ENDIF.
    
  ENDMETHOD.  
  
  
* <SIGNATURE>---------------------------------------------------------------------------------------+
* | STATIC PUBLIC METHOD ZCL_COC_COMM=>CALL_RESTFUL_SERVICE
* +-------------------------------------------------------------------------------------------------+
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* | [--->] I_KOKRS                        TYPE        KOKRS
* +--------------------------------------------------------------------------------------</SIGNATURE>
  METHOD CALL_RESTFUL_SERVICE.

		TRY.
		
			"1. 연결
			IF DESTINATION IS NOT INITIAL.
			  CL_HTTP_CLIENT=>CREATE_BY_DESTINATION( EXPORTING DESTINATION = DESTINATION IMPORTING CLIENT = DATA(LO_HTTP_CLIENT) ).
			ELSE.
			  CL_HTTP_CLIENT=>CREATE_BY_URL( EXPORTING URL = URL IMPORTING CLIENT = LO_HTTP_CLIENT ).
			ENDIF.
			LO_HTTP_CLIENT->REQUEST->SET_VERSION( IF_HTTP_REQUEST=>CO_PROTOCOL_VERSION_1_0 ).
			LO_HTTP_CLIENT->REQUEST->SET_HEADER_FIELD( NAME = '~request_method'  VALUE = 'POST' ).
			LO_HTTP_CLIENT->REQUEST->SET_HEADER_FIELD( NAME = '~server_protocol' VALUE = 'HTTP/1.1' ).
			LO_HTTP_CLIENT->REQUEST->SET_HEADER_FIELD( NAME = 'content-type'     VALUE = 'application/json; charset=utf-8' ).
			
			DATA(LO_REST_CLIENT) = NEW CL_REST_HTTP_CLIENT( IO_HTTP_CLIENT = LO_HTTP_CLIENT ).
			
			IF LO_HTTP_CLIENT IS BOUND AND LO_REST_CLIENT IS BOUND.
			 	
			 	"요청
			 	" - ABAP->JSON
			 	DATA(LV_BODY) = /UI2/CL_JSON=>SERIALIZE( DATA = I_DATA COMPRESS = ABAP_TRUE ).
			 	
			 	" - SET SEND DATA
			 	DATA(LO_REQUEST) = LO_REST_CLIENT->IF_REST_CLIENT~CREATE_REQUEST_ENTITY( ).
			 	LO_REQUEST->SET_CONTENT_TYPE( IV_MEDIA_TYPE = IF_REST_MEDIA_TYPE=>GC_APPL_JSON ).
			 	LO_REQUEST->SET_STRING_DATA( LV_BODY ).
			 	
			 	" = CALL URL(POST)
			 	LO_REST_CLIENT->IF_REST_RESOURCE~POST( LO_REQUEST ).
			 	
			 	"3. 수신
			 	DATA(LO_RESPONSE)    = LO_REST_CLIENT->IF_REST_CLIENT~GET_RESPONSE_ENTITY( ).
			 	DATA(HTTP_STATUS)    = LO_RESPONSE->GET_HEADER_FIELD( '~status_code' ).
			 	DATA(REASON)         = LO_RESPONSE->GET_HEADER_FIELD( '~status_reason' ).
			 	DATA(CONTENT_LENGTH) = LO_RESPONSE->GET_HEADER_FIELD( 'content-length' ).
			 	DATA(LOCATION)       = LO_RESPONSE->GET_HEADER_FIELD( 'location' ).
			 	DATA(CONTENT_TYPE)   = LO_RESPONSE->GET_HEADER_FIELD( 'content-type' ).
			 	
			 	"DATA RETURN
			 	IF HTTP_STATUS = '200'. "SUCCESS
			 	
			 		" - JSON->ABAP
			 		DATA(RESPONSE) = LO_RESPONSE->GET_STRING_DATA( ).
			 		/UI2/CL_JSON=>DESERIALIZE( EXPORTING JSON = RESPONSE ASSOC_ARRAYS = ABAP_TRUE 
			 		                           CHANGING  DATA = E_DATA ).

				ELSE.
					RETURN = VALUE #( TYPE = 'E' MESSAGE = |결과값 수신 중 오류가 발생했습니다. 에러코드 : { HTTP_STATUS } - { REASON }| ).
			  ENDIF.
			ELSE.
				RETURN = VALUE #( TYPE = 'E' MESSAGE = |HTTP 연결 중 오류가 발생했습니다.| ).
			ENDIF.
			
			CATCH CX_ROOT INTO DATA(LR_ROOT).
				RETURN = VALUE #( TYPE = 'E' MESSAGE = CONV #( LR_ROOT->GET_TEXT( ) ) ).
		ENDTRY.

	ENDMETHOD.


* <SIGNATURE>------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
* / Static Public Method ZCL_COC_COMM=>GET_DD_INFO
* ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
* / [--->] IV_OBJNM TYPE TABNAME(optional)
* / [<-()] RT_DD03P TYPE DD03PTAB
* ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 
METHOD GET_DD_INFO.     

    DATA : LS_DD02V TYPE DD02V.

    CALL FUNCTION 'DD_INT_TABL_GET'
      EXPORTING
        TABNAME = IV_OBJNM
      IMPORTING
        DD02V_N = LS_DD02V.

    CALL FUNCTION 'DD_TABL_EXPAND'
      EXPORTING
        DD02V_WA = LS_DD02V
        MODE = 46
      TABLES
        DD03P_TAB = RT_DD03P.

ENDMETHOD.


* <SIGNATURE>------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
* Static Public Method ZCL_COC_COMM=>DISPLAY_TABLE_DATA3
* ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
* [--->] IV_TABNAME  TYPE TABNAME(optional)
* [--->] IV_TITLE        TYPE LVC_TITLE(optional)
* [--->] IT_DEFAULT3  TYPE FINB_T_FIELD_VAL(optional)
* ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 
METHOD DISPLAY_TABLE_DATA3.

    TYPES : BEGIN OF TY_COND, 
               FIELD   TYPE STRING, 
               RANGE TYPE STRING, 
             END OF TY_COND.

    DATA: LV_MESS  TYPE BAPI_MSG, 
             LV_LIN     TYPE BAPI_MSG, 
             LV_WRD   TYPE BAPI_MSG, 
             LT_PROGRAM TYPE TABLE OF BAPI_MSG, 
             LT_TEXTPOOL TYPE TABLE OF TEXTPOOL, 
             LT_COND       TYPE TABLE OF TY_COND.

    DATA(LV_PROG) = CONV SY-REPID( |{ SY-UNAME }_{ IV_TABNAME }_{ SY-UZEIT }| ).
    DATA(LT_DD03P) = ZCL_COC_COMM=>GET_DD_INFO( IV_TABNAME ).

    APPEND | REPORT { LV_PROG } MESSAGE-ID OK.                                                                                             | TO LT_PROGRAM.
    APPEND |                                                                                                                                | TO LT_PROGRAM.
    APPEND | TABLES { IV_TABNAME }.                                                                                                               | TO LT_PROGRAM.
    APPEND |                                                                                                                                               | TO LT_PROGRAM.
    APPEND | SELECTION-SCREEN BEGIN OF BLOCK BL1 WITH FRAME TITLE G_BL1.                                                      | TO LT_PROGRAM.

    LOOP AT LT_DD03P ASSIGNING FIELD-SYMBOL(<FS_DD03P>) WHERE DATATYPE NE 'CLNT'
                                                                                     AND INTTYPE NE ''.
      APPEND | SELECTION-SCREEN BEGIN OF LINE.                                                                                             | TO LT_PROGRAM.
      APPEND | SELECTION-SCREEN COMMENT (30) G_{ CONV NUMC4( <FS_DD03P>-POSITION ) } FOR FIELD S_{ CONV NUMC4( <FS_DD03P>-POSITION ) }.  | TO LT_PROGRAM.
      READ TABLE IT_DEFAULTS INTO DATA(LS_DEFAULTS) WITH KEY FIELDNAME = <FS_DD03P>-FIELDNAME.
      IF SY-SUBRC = 0.
       APPEND | SELECT-OPTIONS : S_{ CONV NUM4( <FS_DD03P>-POSITION ) } FOR { <FS_DD03P>-TABNAME }-{ <FS_DD03P>-FIELDNAME  } DEFAULT '{ LS_DEFAULTS-VALUE }'.  |  TO LT_PROGRAM.
      ELSE. 
        APPEND | SELECT-OPTIONS : S_{ CONV NUM4( <FS_DD03P>-POSITION ) } FOR { <FS_DD03P>-TABNAME }-{ <FS_DD03P>-FIELDNAME  }.   | TO LT_PROGRAM.
      ENDIF.
      APPEND | SELECTION-SCREEN END OF LINE.                                                                                               | TO LT_PROGRAM.
      LT_COND = VALUE #( BASE LT_COND ( FIELD = <FS_DD03P>-FIELDNAME RANGE = |S_{ CONV NUM4( <FS_DD03P>-POSITION ) }[]| ) ) .
    ENDLOOP.
    APPEND | SELECTION-SCREEN END OF BLOCK BL1.                                                                                          | TO LT_PROGRAM.
    APPEND |                                                                                                                                | TO LT_PROGRAM.
    APPEND |  INITIALIZATION.                                                                                                                         | TO LT_PROGRAM.
    APPEND |                                                                                                                                | TO LT_PROGRAM.
    APPEND | SY-TITLE = '{ IV_TITLE }'.                                                                                                                 | TO LT_PROGRAM.
    APPEND |  G_BL1 = '선택'.                                                                                                                           | TO LT_PROGRAM.
    APPEND |                                                                                                                                | TO LT_PROGRAM.
*    LOOP AT LT_DD03P ASSIGNING <FS_DD03P> WHERE KEYFLAG = 'X' AND DATATYPE NE 'CLNT'
    LOOP AT LT_DD03P ASSIGNING <FS_DD03P> WHERE DATATYPE NE 'CLNT'
                                            AND INTTYPE  NE ''.
      APPEND | G_{ CONV NUMC4( <FS_DD03P>-POSITION ) } = \|{ <FS_DD03P>-DDTEXT }\|.                                         | TO LT_PROGRAM.
    ENDLOOP.
    APPEND |                                                                                                                                | TO LT_PROGRAM.
    APPEND | START-OF-SELECTION.                                                                                                                 | TO LT_PROGRAM. 
    APPEND |                                                                                                                                | TO LT_PROGRAM.
    APPEND | DATA: LT_AGGR_RULE TYPE IF_SALV_GUI_TYPES_IDA=>YT_AGGREGATION_RULE,                                       | TO LT_PROGRAM.
    APPEND |          LT_SORT         TYPE IF_SALV_GUI_TYPES_IDA=>YT_SORT_RULE,                                                    | TO LT_PROGRAM.
    APPEND |          LT_FIELD_NAMES TYPE IF_SALV_GUI_TYPES_IDA=>YTS_FIELD_NAME,                                              | TO LT_PROGRAM.
    APPEND |          LS_FIELD_NAMES LIKE LINE OF LT_FIELD_NAMES.                                                                     | TO LT_PROGRAM.
    APPEND |                                                                                                                                | TO LT_PROGRAM.
    APPEND | " 조회                                                                                                                                     | TO LT_PROGRAM.
    APPEND | TRY.                                                                                                                                       | TO LT_PROGRAM.
    APPEND |     " create object ALV on HANA                                                                                                   | TO LT_PROGRAM.
    SELECT SINGLE DDLNAME FROM DDLDEPENDENCY WHERE OBJECTNAME = @IV_TABNAME AND OBJECTTYPE = 'VIEW' INTO @DATA(LV_DDLNAME).
    IF SY-SUBRC = 0.
     APPEND |   DATA(LO_ALV_DISPLAY) = CL_SALV_GUI_TABLE_IDA=>CREATE_FOR_CDS_VIEW( '{ LV_DDLNAME }' ).          | TO LT_PROGRAM.
    ELSE.
       APPEND |  DATA(LO_ALV_DISPLAY) = CL_SALV_GUI_TABLE_IDA=>CREATE( '{ IV_TABNAME }' ).                               | TO LT_PROGRAM.
    ENDIF.
    APPEND |                                                                                                                                             | TO LT_PROGRAM.
    APPEND |     LO_ALV_DISPLAY->DISPLAY_OPTIONS( )->SET_TITLE( '{ IV_TITLE }').                                                   | TO LT_PROGRAM.
    APPEND |                                                                                                                                             | TO LT_PROGRAM.
    APPEND |     "hand over the select-options. | TO LT_PROGRAM.
    APPEND |     DATA(LO_COLLECTOR) = NEW CL_SALV_RANGE_TAB_COLLECTOR( ).                                                | TO LT_PROGRAM.
    LOOP AT LT_COND INTO DATA(LS_COND).
       APPEND |     LO_COLLECTOR->ADD_RANGES_FOR_NAME( IV_NAME = '{ LS_COND-FIELD }' IT_RANGES = { LS_COND-RANGE } ).    | TO LT_PROGRAM.
    ENDLOOP.
    APPEND |                                                                                                                                             | TO LT_PROGRAM.
    APPEND |     LO_COLLECTOR->GET_COLLECTED_RANGES( IMPORTING ET_NAMED_RANGES = DATA(LT_SELECT_OPTIONS) ).    | TO LT_PROGRAM.
    APPEND |     LO_ALV_DISPLAY->SET_SELECT_OPTIONS( IT_RANGES = LT_SELECT_OPTIONS ).                                   | TO LT_PROGRAM.
    APPEND |                                                                                                                                             | TO LT_PROGRAM.
    APPEND |    "define list of available fields                                                                                                      | TO LT_PROGRAM.
    APPEND |     DATA(LT_DD03P) = ZCL_COC_COMM=>GET_DD_INFO( '{ IV_TABNAME }' ).                                       | TO LT_PROGRAM.
    APPEND |     LOOP AT LT_DD03P INTO DATA(LS_DD03P) WHERE INTTYPE NE ''                                                    | TO LT_PROGRAM.
    APPEND |                                                               AND DATATYPE NE 'CLNT'.                                             | TO LT_PROGRAM.
    APPEND |                                                                                                                                              | TO LT_PROGRAM.
    APPEND |       " SET FIELDS SHOW/HIDE                                                                                                      | TO LT_PROGRAM.
    APPEND |       LS_FIELD_NAMES = LS_DD03P-FIELDNAME.                                                                               | TO LT_PROGRAM.
    APPEND |       INSERT LS_FIELD_NAMES INTO TABLE LT_FIELD_NAMES.                                                               | TO LT_PROGRAM.
    APPEND |                                                                                                                                              | TO LT_PROGRAM.
    APPEND |       LO_ALV_DISPLAY->FIELD_CATALOG( )->SET_FIELD_HEADER_TEXTS( IV_FIELD_NAME = LS_DD03P-FIELDNAME | TO LT_PROGRAM.
    APPEND |                                                                           IV_HEADER_TEXT = CONV #( LS_DD03P-DDTEXT ) ).    | TO LT_PROGRAM.
    APPEND |       " SET CURRENCY/QUANTITY                                                                                                                       | TO LT_PROGRAM.
    APPEND |       CASE LS_DD03P-DATATYPE.                                                                                                                        | TO LT_PROGRAM.
    APPEND |         WHEN 'CURR'.                                                                                                                                       | TO LT_PROGRAM.
    APPEND |           LO_ALV_DISPLAY->FIELD_CATALOG( )->SET_CURRENCY_REFERENCE_FIELD( IV_AMOUNT_FIELD_NAME = CONV #( LS_DD03P-FIELDNAME )  | TO LT_PROGRAM.
    APPEND |                                                  IV_CURRENCY_FIELD_NAME = CONV #( LS_DD03P-REFFIELD ) ). | TO LT_PROGRAM.
    APPEND |         WHEN 'QUAN'.                                                                                                                                       | TO LT_PROGRAM.
    APPEND |           LO_ALV_DISPLAY->FIELD_CATALOG( )->SET_UNIT_REFERENCE_FIELD( IV_QUANTITY_FIELD_NAME = CONV #( LS_DD03P-FIELDNAME )         | TO LT_PROGRAM.
    APPEND |                                                 IV_UNIT_FIELD_NAME = CONV #( LS_DD03P-REFFIELD ) ).                  | TO LT_PROGRAM.
    APPEND |         ENDCASE.                                                                                                                                             | TO LT_PROGRAM.
    APPEND |                                                                                                                                                                   | TO LT_PROGRAM.
    APPEND |         IF LS_DD03P-INTTYPE = 'P'.                                                                                                                       | TO LT_PROGRAM.
    APPEND |           LT_AGGR_RULE = VALUE #( BASE LT_AGGR_RULE ( FIELD_NAME = LS_DD03P-FIELDNAME FUNCTION = 'SUM' ) ) .        | TO LT_PROGRAM.
    APPEND |         ENDIF.                                                                                                                                                 | TO LT_PROGRAM.
    APPEND |                                                                                                                                                                  | TO LT_PROGRAM.
    APPEND |     ENDLOOP.                                                                                                                                               | TO LT_PROGRAM.
    APPEND |     LO_ALV_DISPLAY->FIELD_CATALOG( )->SET_AVAILABLE_FIELDS( ITS_FIELD_NAMES = LT_FIELD_NAMES ).                         | TO LT_PROGRAM.
    APPEND |                                                                                                                                                                 | TO LT_PROGRAM.
    APPEND |     "AGGREGATION - TOTAL/SUB TOTAL                                                                                                             | TO LT_PROGRAM.
    APPEND |     LO_ALV_DISPLAY->DEFAULT_LAYOUT( )->SET_AGGREGATIONS( IT_AGGREGATIONS = LT_AGGR_RULE ).                         | TO LT_PROGRAM.
    APPEND |     LO_ALV_DISPLAY->DEFAULT_LAYOUT( )->SET_SORT_ORDER( IT_SORT_ORDER = LT_SORT ).                                         | TO LT_PROGRAM.
    APPEND |                                                                                                                                                                   | TO LT_PROGRAM.
    APPEND |     "set table display options                                                                                                                               | TO LT_PROGRAM.
    APPEND |     LO_ALV_DISPLAY->DISPLAY_OPTIONS( )->ENABLE_ALTERNATING_ROW_PATTERN( ).                                                  | TO LT_PROGRAM.
    APPEND |                                                                                                                                                                   | TO LT_PROGRAM.
    APPEND |     "activate single selection                                                                                                                              | TO LT_PROGRAM.
    APPEND |     LO_ALV_DISPLAY->SELECTION( )->SET_SELECTION_MODE( IF_SALV_GUI_SELECTION_IDA=>CS_SELECTION_MODE-SINGLE ).  | TO LT_PROGRAM.
    APPEND |                                                                                                                                                                | TO LT_PROGRAM.
    APPEND |     " display result| TO LT_PROGRAM.
    APPEND |     LO_ALV_DISPLAY->FULLSCREEN( )->DISPLAY( ).                                                                                              | TO LT_PROGRAM.
    APPEND |                                                                                                                                                                | TO LT_PROGRAM.
    APPEND |   CATCH CX_SALV_IDA_UNKNOWN_NAME INTO DATA(LR_EX).                                                                                | TO LT_PROGRAM.
    APPEND |     MESSAGE E202(SALV_IDS) WITH LR_EX->FIELD_NAME.                                                                                      | TO LT_PROGRAM.
    APPEND | ENDTRY.                                                                                                                                                    | TO LT_PROGRAM.

*-- MODIFY PROGRAM
     CLEAR : LV_MESS.
     SYNTAX-CHECK FOR LT_PROGRAM MESSAGE LV_MESS LINE LV_LIN WORD LV_WRD.

     INSERT REPORT LV_PROG FROM LT_PROGRAM.

     TRY. 
       SUBMIT (LV_PROG) VIA SELECTION-SCREEN AND RETURN.
      CATCH CX_ROOT INTO DATA(LO_ROOT).
       MESSAGE S000 WITH LO_ROOT->GET_TEXT( ) DISPLAY LIKE 'E'.
     ENDTRY.

     DELETE REPORT LV_PROG.

ENDMETHOD.


* <SIGNATURE>------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
* Static Public Method ZCL_COC_COMM=>DISPLAY_TABLE_DATA2
* ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
* [--->] IV_TABNAME TYPE TABNAME
* [--->] IV_TITLE       TYPE LVC_TITLE(optional)
* ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 
METHOD DISPLAY_TABLE_DATA2.

    DATA: LV_MESS  TYPE BAPI_MSG, 
             LV_LIN     TYPE BAPI_MSG, 
             LV_WRD   TYPE BAPI_MSG, 
             LT_PROGRAM TYPE TABLE OF BAPI_MSG, 
             LT_TEXTPOOL TYPE TABLE OF TEXTPOOL.

    DATA(LV_PROG) = CONV SY-REPID( |'{ IV_TITLE }'{ SY-UZEIT }| ).

    APPEND | PEPORT { LV_PROG } MESSAGE-ID OK.                                                                                             | TO LT_PROGRAM.
    APPEND |                                                                                                                                               | TO LT_PROGRAM.
    APPEND | TABLES { IV_TABNAME }.                                                                                                               | TO LT_PROGRAM.

    DATA(LT_DD03P) = ZCL_COC_COMM=>GET_DD_INFO( IV_TABNAME ).

    APPEND | SELECTION-SCREEN BEGIN OF BLOCK BL1 WITH FRAM TITLE G_BL1.                                                       | TO LT_PROGRAM.
    LOOP AT LT_DD03P ASSIGNING FIELD-SYMBOL(<FS_DD03P>) WHERE KEYFLAG = 'X' AND DATATYPE NE 'CLNT'. 
      APPEND | SELECTION-SCREEN BEGIN OF LINE.                                                                                               | TO LT_PROGRAM.
      APPEND | SELECTION-SCREEN COMMENT (30) G_{ CONV NUMC4( <FS_DD03P>-POSITION ) } FOR FIELD S_{ CONV NUMC4( <FS_DD03P>-POSITION ) }.  | TO LT_PROGRAM.
      APPEND | SELECT-OPTIONS : S_{ CONV NUM4( <FS_DD03P>-POSITION ) } FOR { <FS_DD03P>-TABNAME }-{ <FS_DD03P>-FIELDNAME  }.                      |  TO LT_PROGRAM.
      APPEND | SELECTION-SCREEN END OF LINE.                                                                                                 | TO LT_PROGRAM.
    ENDLOOP.
    APPEND | SELECTION-SCREEN END OF BLOCK BL1.                                                                                          | TO LT_PROGRAM.
    APPEND |                                                                                                                                               | TO LT_PROGRAM.
    APPEND |  INITIALIZATION.                                                                                                                         | TO LT_PROGRAM.
    APPEND |                                                                                                                                                | TO LT_PROGRAM.
    APPEND | SY-TITLE = '{ IV_TITLE }'.                                                                                                                 | TO LT_PROGRAM.
    APPEND |  G_BL1 = '선택'.                                                                                                                           | TO LT_PROGRAM.
    APPEND |                                                                                                                                                | TO LT_PROGRAM.
    LOOP AT LT_DD03P ASSIGNING <FS_DD03P> WHERE KEYFLAG = 'X' AND DATATYPE NE 'CLNT'.
      APPEND | G_{ CONV NUMC4( <FS_DD03P>-POSITION ) } = '{ <FS_DD03P>-DDTEXT }'.                                          | TO LT_PROGRAM.
    ENDLOOP.
    APPEND |                                                                                                                                               | TO LT_PROGRAM.
    APPEND | START-OF-SELECTION.                                                                                                                 | TO LT_PROGRAM. 
    APPEND |                                                                                                                                               | TO LT_PROGRAM.
    APPEND | DATA: LT_WHERE TYPE TABLE OF STRING.                                                                                         | TO LT_PROGRAM.
    APPEND | DATA: LT_HDTXT TYPE TABLE OF STIRNG.                                                                                         | TO LT_PROGRAM.
    APPEND | DATA: LO_DATA TYPE REF TO DATA.                                                                                               | TO LT_PROGRAM.
    APPEND | FIELD-SYMBOLS : <FS_DATA> TYPE STANDARD TABLE .                                                                      | TO LT_PROGRAM.
    APPEND |                                                                                                                                              | TO LT_PROGRAM.
    LOOP AT LT_DD03P ASSIGNING <FS_DD03P> WHERE KEYFLAG = 'X' AND DATATYPE NE 'CLNT'.
      APPEND | GIF LT_WHERE IS NOT INITIAL. APPEND ' AND ' TO LT_WHERE . ENDIF.                                                | TO LT_PROGRAM.
      APPEND | APPEND ' { <FS_DD03P>-FIELDNAME } IN @S_{ CONV NUMC4( <FS_DD03P>-POSITION ) } TO LT_WHERE.  | TO LT_PROGRAM.
    ENDLOOP.
    APPEND |                                                                                                                                              | TO LT_PROGRAM.
    APPEND | TRY.                                                                                                                                        | TO LT_PROGRAM.
    APPEND |  CREATE DATA LO_DATA TYPE STANDARD TABLE OF ('{ IV_TABNAME }' ).                                                | TO LT_PROGRAM.
    APPEND |  ASSIGN LO_DATA->* TO <FS_DATA>.                                                                                           | TO LT_PROGRAM.
    APPEND |                                                                                                                                             | TO LT_PROGRAM.
    APPEND |   SELECT *                                                                                                                               | TO LT_PROGRAM.
    APPEND |      FROM { IV_TABNAME }                                                                                                           | TO LT_PROGRAM.
    APPEND |    WHERE (LT_WHERE)                                                                                                                  | TO LT_PROGRAM.
    APPEND |     INTO TABLE @<FS_DATA>.                                                                                                       | TO LT_PROGRAM.
    APPEND |                                                                                                                                               | TO LT_PROGRAM.
    APPEND | CATCH CX_ROOT INTO DATA(LO_ROOT).                                                                                          | TO LT_PROGRAM.
    APPEND |    MESSAGE S000 WITH LO_ROOT->GET_TEXT( ) DISPLAY LIKE 'E'.                                                          | TO LT_PROGRAM.
    APPEND | ENDTRY.                                                                                                                                   | TO LT_PROGRAM.
    APPEND |                                                                                                                                               | TO LT_PROGRAM.
    APPEND |  SORT <FS_DATA>.                                                                                                                     | TO LT_PROGRAM.
    APPEND |                                                                                                                                               | TO LT_PROGRAM.
    APPEND |  ZCL_COC_COMM=>DATA_COUNT_MESSAGE( EXPORTING IT_TAGBLE = <FS_DATA>.).                              | TO LT_PROGRAM.
    APPEND |                                                                                                                                               | TO LT_PROGRAM.
    APPEND | DATA(LT_DD03P) = ZCL_COC_COMM=>GET_DD_INFO( '{ IV_TABNAME }').                                                | TO LT_PROGRAM.
    APPEND | LT_HDTXT = VALUE #( BASE LT_HDTXT FOR WA IN LT_DD03P WHERE ( INTTYPE NE '' ) ( CONV #(  WA-DDTEXT ) ) ).   | TO LT_PROGRAM.
    APPEND | DATA(LT_NO_OUT) = VALUE FIELDNAME_T( ( CONV #( 'MANDT' ) )                                                         | TO LT_PROGRAM.
    APPEND |                                                         ( CONV #( 'KOKRS' ) )                                                           | TO LT_PROGRAM.
    APPEND |                                                         ( CONV #( 'AEDAT' ) )                                                           | TO LT_PROGRAM.
    APPEND |                                                         ( CONV #( 'AEZET' ) )                                                            | TO LT_PROGRAM.
    APPEND |                                                         ( CONV #( 'AENAM' ) ) ).                                                       | TO LT_PROGRAM.
    APPEND |  ZCL_COC_COMM=>SIMPLE_ALV( IV_TITLE = CONV #( '{ IV_TITLE }' )                                                    | TO LT_PROGRAM.
    APPEND |      IV_TOOLBAR = ABAP_ON                                                                                                        | TO LT_PROGRAM.
    APPEND |      IT_HDTXT = LT_HDTXT                                                                                                             | TO LT_PROGRAM.
    APPEND |      IT_NOOUT = LT_NO_OUT                                                                                                        | TO LT_PROGRAM.
    APPEND |      IT_ITAB = <FS_DATA> ).                                                                                                         | TO LT_PROGRAM.

*-- MODIFY PROGRAM
    CLEAR : LV_MESS.
     SYNTAX-CHECK FOR LT_PROGRAM MESSAGE LV_MESS LINE LV_LIN WORD LV_WRD.

     INSERT REPORT LV_PROG FROM LT_PROGRAM.

     TRY. 
       SUBMIT (LV_PROG) VIA SELECTION-SCREEN AND RETURN.
      CATCH CX_ROOT INTO DATA(LO_ROOT).
       MESSAGE S000 WITH LO_ROOT->GET_TEXT( ) DISPLAY LIKE 'E'.
     ENDTRY.

     DELETE REPORT LV_PROG.

ENDMETHOD.


* <SIGNATURE>------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
* Static Public Method ZCL_COC_COMM=>DISPLAY_TABLE_DATA
* ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
* [--->] IV_TABNAME TYPE TABNAME
* [--->] IV_TITLE       TYPE LVC_TITLE(optional)
* ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 
METHOD DISPLAY_TABLE_DATA.

* ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 
* 1. 동적 선택
* ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 
 
    TYPES : BEGIN OF TS_SEL_RANGE, 
                 TABNM TYPE TABNAME, 
                SELID    TYPE DYNSELID, 
                TRANGE TYPE RSDS_TRANGE, 
                TEXPR    TYPE RSDS_TEXPR, 
                TWHERE TYPE RSDS_TWHERE, 
               END OF TS_SEL_RANGE.

      DATA : LT_RESTRICTION TYPE SSCR_RESTRICT_DS, 
                LT_TEXPR          TYPE RSDS_TEXPR, 
                LT_TABX           TYPE TABLE OF RSDSTABS, 
                LT_FIELDS         TYPE TABLE OF RSDSFIELDS, 
                LT_FIELD_TEXTS  TYPE TABLE OF RSDSTEXTS.

    STATICS : LT_SEL_RANGE TYPE TABLE OF TS_SEL_RANGE.

" 조건 생성
    DATA(LT_DD03P) = ZCL_COC_COMM=>GET_DD_INFO( IV_TABNAME ).

    CLEAR : LT_TABX.
    LT_TABX = VALUE #( ( PRIM_TAB = IV_TABNAME ) ) .

    LT_FIELDS = VALUE #( FOR WA IN LT_DD03P WHERE ( KEYFLAG = 'X' AND DATATYPE NE 'CLNT' ) 
                                 ( TABLENAME = WA-TABNAME
                                   FIELDNAME = WA-FIELDNAME ) ).
    LT_FIELD_TEXTS = VALUE #( FOR WA IN LT_DD03P WHERE ( KEYFLAG = 'X' AND DATATYPE NE 'CLNT' ) 
                                  ( TABLENAME = WA-TABNAME
                                  FIELDNAME = WA-FIELDNAME
                                  TEXT           = WA-DDTEXT ) ).
 
   IF LT_FIELDS[] IS INITIAL.
      EXIT.
    ENDIF.

" Set selection content 
    READ TABLE LT_SEL_RANGE INTO DATA(LS_SEL_RANGE) WITH KEY TABNM = IV_TABNAME.

    IF SY-SUBRC = 0.
      DATA(LV_TABIX) = SY-TABIX.
    ELSE.  

      LT_RESTRICTION = VALUE #( OPT_LIST_TAB = VALUE #( ( NAME = IV_TABNAME
                                                                                OPTIONS = 'XXXXXXXXXX' ) )
*                                           ASS_TAB        = VALUE #( FOR WA IN LT_DD02P WHERE ( KEYFIELD = 'X' AND DATATYP NE 'CLNT' ) 
*                                                                               ( KIND         = 'S'
*                                                                                TABNAME     = WA-TABNAME
*                                                                                FIELDNAME = WA-FIELDNAME
*                                                                                SG_MAIN    = 'I'
*                                                                                SG_ADDY    = 'N'
*                                                                                OP_MAIN    = GV_IF_TAB
*                                                                                OP_ADDY    = GV_IF_TAB ) )
*                                                                            ).
                                                                                 ).
      CALL FUNCTION 'FREE_SELECTIONS_INIT'
        EXPORTING
           EXPRESSIONS = LT_TEXPR
           KIND            = 'T'
           RESTRICTION = LT_RESTRICTION
       IMPORTING
          SELECTION_ID  = LS_SEL_RANGE-SELID
          EXPORSSIONS  = LS_SEL_RANGE-TEXPR
          WHERE_CLAUSES = LS_SEL_RANGE-TWHERE
          FIELD_RANGES    = LS_SEL_RANGE-TRANGE
       TABLES
          TABLES_TAB        = LT_TABX
         FIELDS_TAB         = LT_FIELDS
*         FIELDS_TEXTS       = LT_FIELD_TEXTS
      EXCEPTIONS
         FIELD_INCOMPLETE               = 01
         FIELDS_NO_JOIN                   = 02
         FIELD_NOT_FOUND                = 03
         NO_TABLBES                        = 04
        TABLE_NOT_FOUND                = 05
        EXPRESSION_NOT_SUPOORTED = 06
         INCORRECT_EXPRESSION        = 07
         ILLEGAL_KIND                       = 08
         AREA_NOT_FIUHND                = 09
         INCONSISTENT_AREA              = 10
         KIND_F_NO_FIELDS_LEFT          = 11
         KIND_F_NO_FIELD                   = 12
         TOO_MANY_FIELDS                = 13.

    CHECK SY-TABIX IS INITIAL.
    DATA(LV_APPEND_SELECTION) = 'X'.

    ENDIF.

    CALL FUNCTION 'FREE_SELECTION_DIALOG'
      EXPORTING
           SELECTION_ID = LS_SEL_RANGE-SELID
           TITLE            = CONV SYST_TITLE( IV_TITLE )
           AS_WINDOW  = 'X'
           START_ROW   = 10
           START_COL    = 70
           TREE_VISIBLE = ' '
      IMPORTING
           WHERE_CLAUSE = LS_SEL_RANGE-TWHERE
           EXPORESSIONS = LS_SEL_RANGE-TEXPR
           FEILD_RANGES  = LS_SEL_RANGE-TRANGE
     TABLES
           FEILD_TAB              = LT_FIELDS
     EXCEPTIONS
           INTERNAL_ERROR    = 01
           NO_ACTION            = 02
           SELID_NOT_FOUND  = 03
           ILLEGAL_STATUS      = 04
          OTHERS                 = 99.
       
    CHECK SY-SUBRC IS INITIAL.

" SO FAR OK
     IF LV_APPEND_SELECTION EQ 'X'.
         LS_SEL_RANGE-TABNM = IV_TABNAME.
        APPEND LS_SEL_RANGE TO LT_SEL_RANGE.
     ELSE.
        MODIFY LT_SEL_RANGE FROM LS_SEL_RANGE INDEX LV_TABIX.
    ENDIF.

* ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 
* 2. 조회 
* ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 

    DATA : LT_HDTXT TYPE TABLE OF STRING, 
             LO_DATA TYPE REF TO DATA, 
             LT_WHERE TYPE RSDS_WHERE_TAB.

    FIELD-SYMBOLS <FS_DATA> TYPE STANDARD TABLE.

    READ TABLE LT_SEL_RANGE INTO LS_SEL_RANGE WITH KEY TABNM = IV_TABNAME.
    CHECK SY-SUBRC = 0.

    LOOP AT LS_SEL_RANGE-TWHERE INTO DATA(LS_TWHERE).
          LT_WHERE = VALUE #( BASE LT_WHERE FOR WA_1 IN LS_TWHERE-WHERE_TAB ( LINE = WA_1-LINE ) ) .
    ENDLOOP.
    TRY. 
      CREATE DATA LO_DATA TYPE STANDARD TABLE OF (IV_TABNAME).
      ASSIGN LO_DATA->* TO <FS_DATA>.

      SELECT *
         FROM (IV_TABNAME)
      WHERE (LT_WHERE)
       INTO TABLE @<FS_DATA>.

     CATCH CX_ROOT INTO DATA(LO_ROOT).
      MESSAGE S000 WITH LO_ROOT->GET_TEXT( ) DISPLAY LIKE 'E'.
    ENDTRY.

    SORT <FS_DATA>.

    ZCL_COC_COMM=>DATA_COUNT_MESSAGE( EXPORTING IT_TABLE = <FS_DATA> ) .

    LT_HDTXT = VALUE #( BASE LT_HDTXT FOR WA IN LT_DD03P WHERE ( INTTYPE NE '' ) ( CONV #( WA-DDTEXT ) ) ) .

    DATA(LT_NO_OUT) = VALUE FIELDNAME_T( ( |MANDT| ) 
                                         ( |KOKRS| ) 
                                         ( |AEDAT| ) 
                                         ( |AEZET| ) 
                                         ( |AENAM| ) ). 

     ZCL_COC_COMM=>SIMPLE_ALV( IV_TITLE      = IV_TITLE  
                                                IV_TOOLBAR = ABAP_ON                                                                                                                                          
                                                IT_HDTXT     = LT_HDTXT                                                                                                                                               
                                                IT_NOOUT    = LT_NO_OUT                                                                                                                                          
                                                IT_ITAB         = <FS_DATA> ).                                                                                                                                            
      
ENDMETHOD.


* <SIGNATURE>------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
* Static Public Method ZCL_COC_COMM=>GET_IF_LATEST_FIELDANME
* -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
* [--->] IV_IF_ID        TYPE CHAR02
* [<---] EV_PATH       TYPE STRING
* [<---] EV_FILE         TYPE STRING
* [<-()] RV_FULLPATH  TYPE STRING
* ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
METHOD GET_IF_LATEST_FIELDANME.

" 코드 클래스 등록 정보 추출
    SELECT SINGLE FIELD17, FIELD13
      FROM ZCOCT003
    WHERE ZMODULE = 'CO'
       AND CLASS = 'D00'
      AND FIELD03 = @IV_IF_ID
      AND DELFLAG = ''
      INTO ( @EV_PATH, @EV_FILE ) .

  " 가장 회근 파일 = 권한 문제로 함수 변경
* DATA(LV_DIR) = CONV EPSDIRNAM( EV_PATH).
* DATA LT_FILES TYPE TABL OF EPSFILI.

* CALL FUNCTION 'EPS_GET_DIRECTORY_LISTING'
*    EXPORTING
*      DIR_NAME = LV_DIR
*    TABLES
*      DIR_LIST = LT_FILES
*    EXCEPTIONS
*      INVALID_EPS_SUBDIR = 1
*      SAPGPARAM_FAILED = 2
*     BUILD_DIRECTORY_FAILED = 3
*     NO_AUTHORIZATION = 4
*     READ_DIRECTORY_FAILED = 5
*     TOO_MANY_READ_ERRORS = 6
*     EMPTY_DIRECTORY_LIST = 7
*     OTHERS = 8.
    DATA(LV_DIR) = CONV PFEFLNAMEL( EV_PATH ).
    DATA LT_FILES TYPE TABLE OF SALFLDIR.

    CALL FUNCTION 'RZL_READ_DIR_LOCAL'
      EXPORTING
         NAME             = LV_DIR
         TABLES 
          FILE_TBL          = LT_FILES
      EXCEPTIONS
         ARGUMENT_ERROR        = 1
         NOT_FOUND                = 2
         NOT_ADMIN_AUTHORITY = 3
         OTHERS                      = 4.

    IF SY-SUBRC <> 0.
      MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
               WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
    ENDIF.

    CHECK LT_FILES IS NOT INITIAL.

    SORT LT_FILES BY NAME DESCENDING.
     RV_FULLPATH = |{ EV_PATH }{ LT_FILES[ 1 ]-NAME }|.

ENDMETHOD.


* <SIGNATURE>------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
* Static Public Method ZCL_COC_COMM=>GET_ERKRS_FROM_KOKRS
* -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
* [--->] IV_KOKRS       TYPE KOKRS
* [<-()] RV_ERKRS       TYPE ERKRS
* ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
METHOD GET_ERKRS_FROM_KOKRS.

    CHECK IV_KOKRS IS NOT INITIAL.

 " 경영단위
    SELECT SINGLE ERKRS
       FROM TKA01
       INTO RV_ERKRS
      WHERE KOKRS = IV_KOKRS.

ENDMETHOD.


* <SIGNATURE>------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
* Static Public Method ZCL_COC_COMM=>CALL_S_M_3_7
* -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
* [--->] IV_PRRAMS        TYPE BTCSELECT(optional)
* ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
METHOD CALL_S_M_3_7.

   DATA LV_FNAME TYPE CHAR30.

     SELECT SINGLE FIELD13
       FROM ZCOCT003
     WHERE ZMODULE = 'CO'
        AND CLASS = 'Z03'
       AND FIELD09 = '0002'
       AND DELFLAG = ''
     INTO @LV_FNAME.

    IF IV_PRRAMS IS NOT INITIAL.
         DATA(LV_JOB_PARAMS) = IV_PRRAMS.
    ELSE.
         LV_JOB_PARAMS = VALUE #( JOBNAME = 'Z*'
                                  USERNAME = SY-UNAME
                                  FROM_DATE = SY-DATUM
                                  TO_DATE = SY-DATUM
                                  SCHEDUL = 'X'
                                  READY    = 'X'
                                  RUNNING = 'X'
                                  FINISHED = 'X'
                                  ABORTED = 'X' ) .
    ENDIF.

    CALL FUNCTION LV_FNAME
        EXPORTING
           O_JOBSEL_PARAMS       = LV_JOB_PARAMS
        EXCEPTIONS 
            UNKNOWN_SELECTION_ERROR = 1
             OTHERS                              = 2.

        IF SY-SUBRC <> 0.
          MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
                      WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
        ENDIF.

ENDMETHOD.


* <SIGNATURE>------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
* Static Public Method ZCL_COC_COMM=>ET_PRE_PERIOD
* -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
* [--->] I_SPMON        TYPE SPMON(optional)
* [--->] I_PERIO          TYPE JAHRPER(optional)
* [<-()] R_PERIOD        TYPE CHAR7
* ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
METHOD GET_PRE_PERIOD.

      CHECK I_SPMON IS NOT INITIAL OR I_PERIO IS NOT INITIAL.

      IF I_SPMON IS NOT INITIAL.
     
         IF I_SPMON+4(2) = '01'.
           R_PERIOD = |{ I_SPMON(4) - 1 }12|.
         ELSE.
          R_PERIOD = |{ I_SPMON(6) - 1 }|.
        ENDIF.

      ENDIF.

      IF I_PERIO IS NOT INITIAL.
     
         IF I_PERIO+5(2) = '01'.
           R_PERIOD = |{ I_PERIO(4) - 1 }012|.
        ELSE.
         R_PERIOD = |{ I_PERIO(7) - 1 }|.
       ENDIF.

      ENDIF.

ENDMETHOD.


* <SIGNATURE>------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
* Static Public Method ZCL_COC_COMM=>REPLACE_NUM_FIELD
* -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
* [--->] IV_FIELD        TYPE ANY
* [<---] EV_FIELD       TYPE ANY
* ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
METHOD REPLACE_NUM_FIELD.
* ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
* 엑셀 업로드 시 금액 또는 수량 필드의 콤마(,) 삭제
* 회계 설정에 따라 금액이 '-'로 채워지는 경우 '-' 삭제
* 단, 마이너스 금액 및 수량의 '-'는 삭제하지 않음 
* ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

     EV_FIELD = REPLACE( VAL = IV_FIELD PCRE = '^-@|,' WITH = SPACE OCC = 0 ).

ENDMETHOD.


* <SIGNATURE>------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
* Static Public Method ZCL_COC_COMM=>XXL_UPLOAD2
* -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
* [--->] IV_FILENAME                     TYPE STRING
* [--->] IV_SHEETNO                      TYPE INT4(default = 1)
* [--->] IV_START_ROW                   TYPE INT4(default = 2)
* [--->] IV_SPLIT_ROW                    TYPE INT4(efault = 20000)
* [<---] ET_TAB_CONVERTED_DATA     TYPE  STANDARD TABLE 
* [<-()] RT_RETURN                         TYPE BAPIRET2_1
* ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
METHOD XXL_UPLOAD2.
* ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
* Description : Excel upload
* Developer 
* Creation dat e
* Tech script
* ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
* IV_FILENAME : 파일경로
* IV_START_ROW : 시작라인 지정
* IV_SPLIT_ROW : 양이 많을 경우, 잘려서 읽어오는 라인 수  
* ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    DATA :  LT_FILE TYPE FILETABLE, 
              LT_DFIES  TYPE DDFIELDS, 
              LS_FILE     TYPE LINE OF FILETABLE, 
              LV_USER_ACTION TYPE I, 
              LV_BEGIN  TYPE I VALUE 2,  
              LV_END TYPE I, 
              LO_SREF TYPE REF TO DATA, 
              LR_DESCR TYPE REF TO CL_ABAP_STRUCTDESCR, 
  
             EXCEL_TAB TYPE P99SG_SENDER, 
             EMP_TAB  TYPE P99SG_SENDER, 
             APPLICATION TYPE OLE2_OBJECT, 
             WORKBOOK  TYPE OLE2_OBJECT, 
             RANGE        TYPE OLE2_OBJECT, 
             WORKSHEET  TYPE OLE2_OBJECT, 
             H_CELL         TYPE OLE2_OBJECT, 
             H_CELL1        TYPE OLE2_OBJECT, 
             SEPARATOR   TYPE C.

    FIELD-SYMBOLS <LT_DATA> TYPE STANDARD TABLE.

" Get fieldname 
    IF IV_FILENAME IS INITIAL.

*     CALL METHOD CL_GUI_FRONTEND_SERVICES=>FILE_OPEN_DIALOG
*        EXPROTING
*          WINDOW_TITLE  = 'Select File'
*          DEFAULT_EXTENSION = '*.XLSX, *.XLS'
*          FILE_FILTER = CL_GUI_FRONTEND_SERVICES=>FILETYPE_EXCEL
*          MULTISELECTION = SPACE
*       CHANGING
*         FILE_TABLE = LT_FILE
*         RC = LV_SUBRC
*         USER_ACTION = LV_USER_ACTION
*       EXTENTIONS
*          FILE_OPEN_DIALOG_FAILED = 1
*          CONL_ERROR = 2
*          ERROR_NO_GUI = 3
*           NOT_SUPPORTED_BY_GUI = 4 
*          OTHERS = 5.

*      IF SY-SUBRC IS NOT INITIAL.
*        EXIT.
*      ENDIF.

*     IF LV_USER_ACTION = CL_GUI+FRONTEND_SERVICES=>ACTION_CANCEL.
*        MESSAGE S161(ALVHT).
*        RETURN
*     ENDIF.

*     LS_FILE = LT_FILE[ 1 ].
       LS_FILE-FILENAME = CONV #( ZCL_COC_ONF4=>F4_IFILE( IV_FILE_FILTER = 'Microsoft Excel(*.xlsx;*.xls)|*.xlsx;*.xls' ) ) .

    ELSE.

      LS_FILE-FILENAME = IV_FILENAME.

    ENDIF.

     APPEND SPACE TO EMP_TAB.

    CHECK LS_FILE-FILENAME IS NOT INITIAL.

" Get table ddic info
      ASSIGN ET_TAB_CONVERTED_DATA TO <LT_DATA>.
     IF <LT_DATA> IS ASSIGNED.
       CREATE DATA LO_SREF LIKE LINE OF <LT_DATA>.
      LR_DESCR ?= CL_ABAP_STRUCTDESCR=>DESCRIBE_BY_DATA_REF( LO_SREF ).
      LT_DFIES = CL_SALV_DATA_DESCR=>READ_STRUCTDESCR( LR_DESCR ).
    ELSE.
       EXIT.
     ENDIF.

 " Column COUNT
      DATA(LV_COL) = LINES( LT_DFIES ).

" Set split row
     IF IV_SPLIT_ROW > 50000.
      DATA(LV_SPLIT_ROW) = 50000.
     ELSE.
     LV_SPLIT_ROW = IV_SPLIT_ROW.
     ENDIF.

    TRY.

       DATA(LV_FILENAME) = CONV STRING( LS_FILE-FILENAME ).

  " Progress
      ZCL_COC_COMM=>SHOW_PROGRESS_PERCENTAGE( IV_TEXT = CONV #( '엑셀 파일을 읽는 중 입니다... ' ) ).
 
     IF APPLICATION-HEADER = SPACE AND APPLICATION-HANDLE = -1.
     CREATE OBJECT APPLICATION 'Excel.application'.
     ENDIF.

      CALL METHOD OF APPLICATION 'Workbooks' = WORKBOOK.
      CALL METHOD OF WORKBOOK 'Open' EXPORTING #1 = LV_FILENAME.
       GET PROPERTY OF APPLICATION 'ACTIVESHEET' = WORKSHEET.

      DO.

       CLEAR : EXCEL_TAB[].

  " Set row, column range
     IF SY-INDEX = 1.
          LV_BEGIN = IV_START_ROW.
     ELSE.
          LV_BEGIN = ( SY-INDEX - 1 ) * LV_SPLIT_ROW + 1.
     ENDIF.

     LV_END = SY-INDEX && LV_SPLIT_ROW.

     CALL METHOD OF WORKSHEET 'Cells' = H_CELL EXPORTING #1 = LV_BEGIN #2 = 1.
     CALL METHOD OF WORKSHEET 'Cells' = H_CELL1 EXPORTING #1 = LV_END #2 = LV_COL.
     CALL METHOD OF WORKSHEET 'Cells' = RANGE EXPORTING #1 = H_CELL #2 = H_CELL1.
     CALL METHOD OF RANGE 'SELECT'.
     CALL METHOD OF RANGE 'COPY'.

 " Without flush. CLPS_IMPORT does not find the data
     CALL FUNCTION 'CONTROL_FLUSH'
         EXCEPTIONS
            OTHERS = 3.

     CALL FUNCTION 'CLPB_IMPORT'
          TABLES 
                DATA_TAB = EXCEL_TAB
          EXCEPTIONS
              CLPB_ERROR = 1
              OTHERS       = 2.

     IF SY-SUBRC <> 0.
          MESSAGE X006(HR99S00_STATUS_HANDL).
          EXIT.
    ENDIF.

 " Check end of file
    IF EMP_TAB[] = EXCEL_TAB[].
          EXIT.
    ENDIF.

    IF EXCEL_TAB[] IS INITIAL.
         EXIT.
    ELSE.
 
" Check end of file
    IF LINES( EXCEL_TAB ) = 1.
          SPLIT EXCEL_TAB[ 1 ] AT CL_ABAP_CHAR_UTILITIES=>HORIZONTAL_TAB INTO TABLE DATA(LT_TEMP).
          DELETE LT_TEMP WHERE TABLE_LINE IS INITIAL.
          IF LT_TEMP IS INITIAL.
            EXIT.
          ENDIF.
    ENDIF.

" Split time data to field and Append lines
    LOOP AT EXCEL_TAB ASSIGNING FIELD-SYMBOL(<FS_EXCEL_TAB>).

          SPLIT <FS_EXCEL_TAB> AT CL_ABAP_CHAR_UTILITIES=>HORIZONTAL_TAB INTO TABLE DATA(RESULT_TAB).

  "OUTPUT DATA
         APPEND INITIAL LINE TO <LT_DATA> ASSIGNING FIELD-SYMBOL(<FS_DATA>).
 
         LOOP AT RESULT_TAB ASSIGNING FIELD-SYMBOL(<RESULT_TAB>).
              ASSIGN COMPONENT SY-TABIX OF STRUCTURE <FS_DATA> TO FIELD-SYMBOL(<FS_FIELD>).
              IF SY-SUBRC = 0.
                   <FS_FIELD> = <RESULT_TAB>.
              ENDIF.
        ENDLOOP.

      CLEAR RESULT_TAB.
    ENDLOOP.

    ENDIF.

ENDDO.

 " CLEAR CLIPBOARD
    CLEAR EXCEL_TAB[].
    CALL FUNCTION 'CLPB_EXPORT'
         TABLES 
              DATA_TAB = EXCEL_TAB.

    SET PROPERTY OF APPLICATION 'CutCopyMode' = 0.
    CALL METHOD OF APPLICATION 'QUIT'.
    FREE OBJECT APPLICATION.

    CATCH CX_ROOT INTO DATA(LO_ROOT).
          MESSAGE S000 WITH LO_ROOT->GET_TEXT(  ) DISPLAY LIKE 'E'.

    ENDTRY.

ENDMETHOD.
ENDCLASS.








 




















